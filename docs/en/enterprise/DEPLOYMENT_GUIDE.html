<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: Enterprise Deployment">
  <meta name="keywords" content="CodeGraph, documentation, enterprise">

  <meta property="og:title" content="Enterprise Deployment - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: Enterprise Deployment">
  <meta property="og:type" content="article">

  <title>Enterprise Deployment - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Problems</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Solution</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Features</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Integrations</a></li>
        <li><a href="../index.html" class="nav-link active">Documentation</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/enterprise/DEPLOYMENT_GUIDE.html" class="active">EN</a>
          <a href="../../ru/enterprise/DEPLOYMENT_GUIDE.html" class="">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Toggle theme">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Request Demo</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Problems</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Solution</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Features</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Integrations</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Documentation</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Request Demo</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Getting Started</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../getting-started/index.html">Overview</a></li>
        <li><a href="../getting-started/CONFIGURATION.html">Configuration Guide</a></li>
        <li><a href="../getting-started/INSTALLATION.html">Installation Guide</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">User Guides</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Overview</a></li>
        <li><a href="../guides/BENCHMARK_GUIDE.html">Benchmark Framework Guide</a></li>
        <li><a href="../guides/CLI_GUIDE.html">CLI Guide</a></li>
        <li><a href="../guides/CODE_REVIEW.html">Automated Code Review</a></li>
        <li><a href="../guides/CPG_EXPORT.html">CPG Export Guide</a></li>
        <li><a href="../guides/MONITORING.html">Monitoring Guide</a></li>
        <li><a href="../guides/PROGRAMMATIC_GUIDE.html">User Guide</a></li>
        <li><a href="../guides/PROJECT_IMPORT.html">Importing a New Codebase</a></li>
        <li><a href="../guides/QUICK_REFERENCE.html">CodeGraph Quick Reference</a></li>
        <li><a href="../guides/REFACTORING.html">Refactoring Analysis Guide</a></li>
        <li><a href="../guides/SCENARIOS.html">Workflow Scenarios Guide</a></li>
        <li><a href="../guides/TROUBLESHOOTING.html">Troubleshooting Guide</a></li>
        <li><a href="../guides/TUI_USER_GUIDE.html">CodeGraph User Guide</a></li>
        <li><a href="../guides/01-onboarding.html">Scenario 01: Developer Onboarding</a></li>
        <li><a href="../guides/02-security-audit.html">Scenario 02: Security Audit</a></li>
        <li><a href="../guides/03-documentation.html">Scenario 03: Documentation Generation</a></li>
        <li><a href="../guides/04-feature-development.html">Scenario 04: Feature Development</a></li>
        <li><a href="../guides/05-refactoring.html">Scenario 05: Refactoring</a></li>
        <li><a href="../guides/06-performance.html">Scenario 06: Performance Analysis</a></li>
        <li><a href="../guides/07-test-coverage.html">Scenario 07: Test Coverage</a></li>
        <li><a href="../guides/08-compliance.html">Scenario 08: Compliance Checking</a></li>
        <li><a href="../guides/09-code-review.html">Scenario 09: Code Review</a></li>
        <li><a href="../guides/10-cross-repo.html">Scenario 10: Cross-Repository Analysis</a></li>
        <li><a href="../guides/11-architecture.html">Scenario 11: Architecture Analysis</a></li>
        <li><a href="../guides/12-tech-debt.html">Scenario 12: Tech Debt Assessment</a></li>
        <li><a href="../guides/13-mass-refactoring.html">Scenario 13: Mass Refactoring</a></li>
        <li><a href="../guides/14-incident-response.html">Scenario 14: Security Incident Response</a></li>
        <li><a href="../guides/15-debugging.html">Scenario 15: Debugging Assistance</a></li>
        <li><a href="../guides/16-entry-points.html">Scenario 16: Entry Point Discovery</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Reference</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../api/index.html">Overview</a></li>
        <li><a href="../api/REST_API.html">CodeGraph REST API Documentation</a></li>
        <li><a href="../api/WEBSOCKET_API.html">WebSocket API Reference</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Integrations</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../integrations/index.html">Overview</a></li>
        <li><a href="../integrations/GIGACHAT.html">GigaChat Integration Guide</a></li>
        <li><a href="../integrations/YANDEX_AI_STUDIO.html">Yandex AI Studio Integration Guide</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Technical Reference</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../reference/index.html">Overview</a></li>
        <li><a href="../reference/AGENTS.html">Agents Reference</a></li>
        <li><a href="../reference/ANALYSIS_MODULES.html">Analysis Modules Reference</a></li>
        <li><a href="../reference/API.html">API Reference</a></li>
        <li><a href="../reference/HYPOTHESIS_SYSTEM.html">Hypothesis System Reference</a></li>
        <li><a href="../reference/SCHEMA.html">DuckDB CPG Schema Design (CPG Spec v1.1)</a></li>
        <li><a href="../reference/SECURITY.html">Enterprise Security Module</a></li>
        <li><a href="../reference/SQL_QUERY_COOKBOOK.html">SQL Query Cookbook for DuckDB CPG</a></li>
        <li><a href="../reference/WORKFLOWS.html">Workflows Reference</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Overview</a></li>
        <li><a href="COMPETITIVE_MATRIX.html">CodeGraph Competitive Matrix</a></li>
        <li><a href="DEPLOYMENT_GUIDE.html" class="active">Enterprise Deployment</a></li>
        <li><a href="DLP_SECURITY.html">DLP: Data Loss Prevention</a></li>
        <li><a href="HYPOTHESIS_WHITEPAPER.html">Security Hypothesis Validation</a></li>
        <li><a href="LLM_SECURITY.html">LLM Integration Security</a></li>
        <li><a href="RBAC.html">RBAC and Authorization</a></li>
        <li><a href="SECURITY_BRIEF.html">Enterprise Security Brief</a></li>
        <li><a href="SIEM.html">SIEM Integration</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Documentation</a>
        <span>/</span>
        <a href="index.html">Enterprise</a>
        <span>/</span>
        <span>Enterprise Deployment</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>Enterprise Deployment</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="enterprise-deployment">Enterprise Deployment<a class="heading-anchor" href="#enterprise-deployment" title="Link to this section">&para;</a></h1>
<blockquote class="callout">
<p>Architecture Guide for DevOps and Infrastructure Teams</p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="heading-anchor" href="#table-of-contents" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#1-system-requirements">1. System Requirements</a></li>
<li><a href="#11-hardware-requirements">1.1 Hardware Requirements</a></li>
<li><a href="#12-software-requirements">1.2 Software Requirements</a></li>
<li><a href="#13-network-ports">1.3 Network Ports</a></li>
<li><a href="#2-docker-compose-development">2. Docker Compose (Development)</a></li>
<li><a href="#21-file-structure">2.1 File Structure</a></li>
<li><a href="#22-docker-composeyml">2.2 docker-compose.yml</a></li>
<li><a href="#23-environment-variables-env">2.3 Environment Variables (.env)</a></li>
<li><a href="#24-startup">2.4 Startup</a></li>
<li><a href="#3-kubernetes-production">3. Kubernetes (Production)</a></li>
<li><a href="#31-architecture">3.1 Architecture</a></li>
<li><a href="#32-namespace-and-configmap">3.2 Namespace and ConfigMap</a></li>
<li><a href="#33-secrets">3.3 Secrets</a></li>
<li><a href="#34-deployment">3.4 Deployment</a></li>
<li><a href="#35-service-and-ingress">3.5 Service and Ingress</a></li>
<li><a href="#36-horizontalpodautoscaler">3.6 HorizontalPodAutoscaler</a></li>
<li><a href="#37-networkpolicy">3.7 NetworkPolicy</a></li>
<li><a href="#4-air-gapped-deployment">4. Air-Gapped Deployment</a></li>
<li><a href="#41-isolated-environment-characteristics">4.1 Isolated Environment Characteristics</a></li>
<li><a href="#42-air-gapped-configuration">4.2 Air-Gapped Configuration</a></li>
<li><a href="#43-preparing-artifacts-for-air-gapped">4.3 Preparing Artifacts for Air-Gapped</a></li>
<li><a href="#44-installation-in-air-gapped-environment">4.4 Installation in Air-Gapped Environment</a></li>
<li><a href="#5-deployment-security">5. Deployment Security</a></li>
<li><a href="#51-tlsssl-configuration">5.1 TLS/SSL Configuration</a></li>
<li><a href="#52-pod-security-standards">5.2 Pod Security Standards</a></li>
<li><a href="#53-secrets-encryption">5.3 Secrets Encryption</a></li>
<li><a href="#6-monitoring-and-observability">6. Monitoring and Observability</a></li>
<li><a href="#61-prometheus-servicemonitor">6.1 Prometheus ServiceMonitor</a></li>
<li><a href="#62-grafana-dashboard">6.2 Grafana Dashboard</a></li>
<li><a href="#63-alertmanager-rules">6.3 Alertmanager Rules</a></li>
<li><a href="#7-backup-and-recovery">7. Backup and Recovery</a></li>
<li><a href="#71-postgresql-backup">7.1 PostgreSQL Backup</a></li>
<li><a href="#72-duckdb-backup">7.2 DuckDB Backup</a></li>
<li><a href="#73-disaster-recovery">7.3 Disaster Recovery</a></li>
<li><a href="#8-migration-and-upgrades">8. Migration and Upgrades</a></li>
<li><a href="#81-rolling-update">8.1 Rolling Update</a></li>
<li><a href="#82-database-migration">8.2 Database Migration</a></li>
<li><a href="#related-documents">Related Documents</a></li>
</ul>
<h2 id="overview">Overview<a class="heading-anchor" href="#overview" title="Link to this section">&para;</a></h2>
<p>CodeGraph supports multiple deployment modes for different security and scaling requirements:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
<th>Recommended For</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Docker Compose</strong></td>
<td>Single node, simple setup</td>
<td>Development, testing</td>
</tr>
<tr>
<td><strong>Kubernetes</strong></td>
<td>Clustered, HA, auto-scaling</td>
<td>Production</td>
</tr>
<tr>
<td><strong>Air-Gapped</strong></td>
<td>Isolated network, local LLM</td>
<td>High-security environments</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="1-system-requirements">1. System Requirements<a class="heading-anchor" href="#1-system-requirements" title="Link to this section">&para;</a></h2>
<h3 id="11-hardware-requirements">1.1 Hardware Requirements<a class="heading-anchor" href="#11-hardware-requirements" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Component</th>
<th>Minimum</th>
<th>Recommended</th>
<th>Production</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CPU</strong></td>
<td>4 cores</td>
<td>8 cores</td>
<td>16+ cores</td>
</tr>
<tr>
<td><strong>RAM</strong></td>
<td>8 GB</td>
<td>16 GB</td>
<td>32+ GB</td>
</tr>
<tr>
<td><strong>SSD</strong></td>
<td>50 GB</td>
<td>100 GB</td>
<td>500+ GB</td>
</tr>
<tr>
<td><strong>GPU</strong></td>
<td>-</td>
<td>NVIDIA 8GB+</td>
<td>NVIDIA 24GB+</td>
</tr>
</tbody>
</table></div>
<p><strong>Note:</strong> GPU is only required for local LLM (air-gapped mode).</p>
<h3 id="12-software-requirements">1.2 Software Requirements<a class="heading-anchor" href="#12-software-requirements" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Component</th>
<th>Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Python</strong></td>
<td>3.11+</td>
<td>Main runtime environment</td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>14+</td>
<td>User, session, audit storage</td>
</tr>
<tr>
<td><strong>DuckDB</strong></td>
<td>1.0+</td>
<td>CPG graph storage</td>
</tr>
<tr>
<td><strong>Docker</strong></td>
<td>24+</td>
<td>Containerization (optional)</td>
</tr>
<tr>
<td><strong>Kubernetes</strong></td>
<td>1.28+</td>
<td>Orchestration (production)</td>
</tr>
</tbody>
</table></div>
<blockquote class="callout">
<p><strong>Note:</strong> Joern (4.0+) is only required for initial CPG generation from source code. Once the CPG is exported to DuckDB, Joern is no longer needed for regular operation.</p>
</blockquote>
<h3 id="13-network-ports">1.3 Network Ports<a class="heading-anchor" href="#13-network-ports" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Port</th>
<th>Service</th>
<th>Protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td>8000</td>
<td>CodeGraph API</td>
<td>HTTP/HTTPS</td>
</tr>
<tr>
<td>5432</td>
<td>PostgreSQL</td>
<td>TCP</td>
</tr>
<tr>
<td>8080</td>
<td>Joern Server</td>
<td>HTTP</td>
</tr>
<tr>
<td>514</td>
<td>SIEM (Syslog)</td>
<td>UDP/TCP</td>
</tr>
<tr>
<td>8200</td>
<td>HashiCorp Vault</td>
<td>HTTP/HTTPS</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="2-docker-compose-development">2. Docker Compose (Development)<a class="heading-anchor" href="#2-docker-compose-development" title="Link to this section">&para;</a></h2>
<h3 id="21-file-structure">2.1 File Structure<a class="heading-anchor" href="#21-file-structure" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">codegraph</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
<span class="err">├──</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">override</span><span class="o">.</span><span class="n">yml</span><span class="w">  </span><span class="c1"># Local settings</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="w">                         </span><span class="c1"># Environment variables</span>
<span class="err">├──</span><span class="w"> </span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span><span class="w">                  </span><span class="c1"># Application configuration</span>
<span class="err">└──</span><span class="w"> </span><span class="n">data</span><span class="o">/</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">postgres</span><span class="o">/</span><span class="w">                </span><span class="c1"># PostgreSQL data</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">duckdb</span><span class="o">/</span><span class="w">                  </span><span class="c1"># DuckDB files</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">joern</span><span class="o">/</span><span class="w">                   </span><span class="c1"># Joern workspace</span>
</code></pre></div>

<h3 id="22-docker-composeyml">2.2 docker-compose.yml<a class="heading-anchor" href="#22-docker-composeyml" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="c1"># CodeGraph API Server</span>
<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="nt">api</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql+asyncpg://postgres:${POSTGRES_PASSWORD}@postgres:5432/codegraph</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_JWT_SECRET=${API_JWT_SECRET}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GIGACHAT_AUTH_KEY=${GIGACHAT_AUTH_KEY}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SECURITY_ENABLED=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DLP_ENABLED=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SIEM_ENABLED=${SIEM_ENABLED:-false}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAULT_ENABLED=${VAULT_ENABLED:-false}</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config.yaml:/app/config.yaml:ro</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/duckdb:/app/data/duckdb</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="nt">postgres</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<span class="w">      </span><span class="nt">joern</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_started</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-network</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8000/api/v1/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="c1"># PostgreSQL Database</span>
<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="nt">postgres</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:16-alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-postgres</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER=postgres</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=${POSTGRES_PASSWORD}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=codegraph</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/postgres:/var/lib/postgresql/data</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./init.sql:/docker-entrypoint-initdb.d/init.sql:ro</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-network</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">postgres&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="c1"># Joern CPG Server</span>
<span class="w">  </span><span class="c1"># ==========================================================================</span>
<span class="w">  </span><span class="nt">joern</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/joernio/joern:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-joern</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/joern:/workspace</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;joern&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--server&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--server-host&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-network</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">codegraph-network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</code></pre></div>

<h3 id="23-environment-variables-env">2.3 Environment Variables (.env)<a class="heading-anchor" href="#23-environment-variables-env" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># =============================================================================</span>
<span class="c1"># CodeGraph Environment Variables</span>
<span class="c1"># =============================================================================</span>

<span class="c1"># PostgreSQL</span>
<span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>&lt;secure-password-here&gt;

<span class="c1"># JWT Authentication</span>
<span class="nv">API_JWT_SECRET</span><span class="o">=</span>&lt;<span class="m">64</span>-char-random-string&gt;
<span class="nv">API_ADMIN_USERNAME</span><span class="o">=</span>admin
<span class="nv">API_ADMIN_PASSWORD</span><span class="o">=</span>&lt;secure-admin-password&gt;

<span class="c1"># LLM Providers</span>
<span class="c1"># GigaChat (Sber)</span>
<span class="nv">GIGACHAT_AUTH_KEY</span><span class="o">=</span>&lt;base64-encoded-credentials&gt;
<span class="c1"># Yandex AI Studio (optional)</span>
<span class="nv">YANDEX_AI_API_KEY</span><span class="o">=</span>&lt;your-yandex-api-key&gt;
<span class="nv">YANDEX_AI_FOLDER_ID</span><span class="o">=</span>&lt;your-yandex-folder-id&gt;

<span class="c1"># Security Features</span>
<span class="nv">SECURITY_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">DLP_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">SIEM_ENABLED</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">VAULT_ENABLED</span><span class="o">=</span><span class="nb">false</span>

<span class="c1"># SIEM (if enabled)</span>
<span class="nv">SIEM_SYSLOG_HOST</span><span class="o">=</span>siem.company.com
<span class="nv">SIEM_SYSLOG_PORT</span><span class="o">=</span><span class="m">514</span>

<span class="c1"># Vault (if enabled)</span>
<span class="nv">VAULT_ADDR</span><span class="o">=</span>https://vault.company.com:8200
<span class="nv">VAULT_TOKEN</span><span class="o">=</span>&lt;vault-token&gt;
</code></pre></div>

<h3 id="24-startup">2.4 Startup<a class="heading-anchor" href="#24-startup" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create .env file</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env
<span class="c1"># Edit variables</span>
nano<span class="w"> </span>.env

<span class="c1"># Start all services</span>
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># Check status</span>
docker<span class="w"> </span>compose<span class="w"> </span>ps

<span class="c1"># View logs</span>
docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>api

<span class="c1"># Initialize database</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head

<span class="c1"># Create administrator</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>scripts.create_admin
</code></pre></div>

<hr />
<h2 id="3-kubernetes-production">3. Kubernetes (Production)<a class="heading-anchor" href="#3-kubernetes-production" title="Link to this section">&para;</a></h2>
<h3 id="31-architecture">3.1 Architecture<a class="heading-anchor" href="#31-architecture" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                           KUBERNETES CLUSTER                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         INGRESS CONTROLLER                           │   │
│  │                     (nginx / traefik / istio)                        │   │
│  │                                                                       │   │
│  │  api.codegraph.company.com ────────────────► codegraph-api:8000     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                       │                                     │
│                                       ▼                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    CODEGRAPH NAMESPACE                               │   │
│  │                                                                       │   │
│  │  ┌───────────────────┐  ┌───────────────────┐  ┌─────────────────┐  │   │
│  │  │  codegraph-api    │  │  codegraph-api    │  │  codegraph-api  │  │   │
│  │  │  (replica 1)      │  │  (replica 2)      │  │  (replica 3)    │  │   │
│  │  │                   │  │                   │  │                 │  │   │
│  │  │  CPU: 2           │  │  CPU: 2           │  │  CPU: 2         │  │   │
│  │  │  RAM: 4Gi         │  │  RAM: 4Gi         │  │  RAM: 4Gi       │  │   │
│  │  └───────────────────┘  └───────────────────┘  └─────────────────┘  │   │
│  │            │                    │                      │             │   │
│  │            └────────────────────┼──────────────────────┘             │   │
│  │                                 │                                    │   │
│  │                                 ▼                                    │   │
│  │  ┌───────────────────────────────────────────────────────────────┐  │   │
│  │  │                      SERVICES                                  │  │   │
│  │  │                                                                │  │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐   │  │   │
│  │  │  │ PostgreSQL  │  │   Joern     │  │   HashiCorp Vault   │   │  │   │
│  │  │  │ (StatefulSet)│  │ (StatefulSet)│  │   (External)       │   │  │   │
│  │  │  │             │  │             │  │                     │   │  │   │
│  │  │  │ PVC: 100Gi  │  │ PVC: 50Gi   │  │                     │   │  │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────────────┘   │  │   │
│  │  │                                                                │  │   │
│  │  └───────────────────────────────────────────────────────────────┘  │   │
│  │                                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="32-namespace-and-configmap">3.2 Namespace and ConfigMap<a class="heading-anchor" href="#32-namespace-and-configmap" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># namespace.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">    </span><span class="nt">istio-injection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="w">  </span><span class="c1"># If using Istio</span>
<span class="nn">---</span>
<span class="c1"># configmap.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config.yaml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">domain:</span>
<span class="w">      </span><span class="no">name: postgresql</span>
<span class="w">      </span><span class="no">auto_activate: true</span>

<span class="w">    </span><span class="no">api:</span>
<span class="w">      </span><span class="no">host: &quot;0.0.0.0&quot;</span>
<span class="w">      </span><span class="no">port: 8000</span>
<span class="w">      </span><span class="no">workers: 4</span>

<span class="w">    </span><span class="no">security:</span>
<span class="w">      </span><span class="no">enabled: true</span>
<span class="w">      </span><span class="no">dlp:</span>
<span class="w">        </span><span class="no">enabled: true</span>
<span class="w">        </span><span class="no">pre_request:</span>
<span class="w">          </span><span class="no">enabled: true</span>
<span class="w">          </span><span class="no">default_action: &quot;WARN&quot;</span>
<span class="w">        </span><span class="no">post_response:</span>
<span class="w">          </span><span class="no">enabled: true</span>
<span class="w">          </span><span class="no">default_action: &quot;MASK&quot;</span>
<span class="w">      </span><span class="no">siem:</span>
<span class="w">        </span><span class="no">enabled: true</span>
<span class="w">        </span><span class="no">syslog:</span>
<span class="w">          </span><span class="no">enabled: true</span>
<span class="w">          </span><span class="no">host: &quot;siem-syslog.security.svc.cluster.local&quot;</span>
<span class="w">          </span><span class="no">port: 514</span>
<span class="w">      </span><span class="no">vault:</span>
<span class="w">        </span><span class="no">enabled: true</span>
<span class="w">        </span><span class="no">url: &quot;http://vault.vault.svc.cluster.local:8200&quot;</span>
<span class="w">        </span><span class="no">auth_method: &quot;kubernetes&quot;</span>
<span class="w">        </span><span class="no">kubernetes:</span>
<span class="w">          </span><span class="no">role: &quot;codegraph&quot;</span>
</code></pre></div>

<h3 id="33-secrets">3.3 Secrets<a class="heading-anchor" href="#33-secrets" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># secrets.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-secrets</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nt">stringData</span><span class="p">:</span>
<span class="w">  </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgresql+asyncpg://postgres:password@postgres:5432/codegraph&quot;</span>
<span class="w">  </span><span class="nt">API_JWT_SECRET</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;64-char-random-string&gt;&quot;</span>
<span class="w">  </span><span class="nt">GIGACHAT_AUTH_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;base64-credentials&gt;&quot;</span>
<span class="nn">---</span>
<span class="c1"># For production use External Secrets Operator + Vault</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExternalSecret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-vault-secrets</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">refreshInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1h</span>
<span class="w">  </span><span class="nt">secretStoreRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-backend</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<span class="w">  </span><span class="nt">target</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-secrets</span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL</span>
<span class="w">      </span><span class="nt">remoteRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph/database</span>
<span class="w">        </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">url</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_JWT_SECRET</span>
<span class="w">      </span><span class="nt">remoteRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph/api</span>
<span class="w">        </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt_secret</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GIGACHAT_AUTH_KEY</span>
<span class="w">      </span><span class="nt">remoteRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph/llm</span>
<span class="w">        </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gigachat_credentials</span>
</code></pre></div>

<h3 id="34-deployment">3.4 Deployment<a class="heading-anchor" href="#34-deployment" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">    </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">      </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">        </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">prometheus.io/scrape</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="nt">prometheus.io/port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="w">        </span><span class="nt">prometheus.io/path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/api/v1/metrics&quot;</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">        </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">        </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>

<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph:latest</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-secrets</span>
<span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SECURITY_ENABLED</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SIEM_ENABLED</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAULT_ENABLED</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/config.yaml</span>
<span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yaml</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">duckdb-data</span>
<span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/data/duckdb</span>
<span class="w">          </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">            </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="w">            </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
<span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4Gi&quot;</span>
<span class="w">          </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/v1/health/live</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">            </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/v1/health/ready</span>
<span class="w">              </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">            </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">            </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">              </span><span class="nt">drop</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>

<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-config</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">duckdb-data</span>
<span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-duckdb-pvc</span>

<span class="w">      </span><span class="nt">affinity</span><span class="p">:</span>
<span class="w">        </span><span class="nt">podAntiAffinity</span><span class="p">:</span>
<span class="w">          </span><span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">              </span><span class="nt">podAffinityTerm</span><span class="p">:</span>
<span class="w">                </span><span class="nt">labelSelector</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">                </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/hostname</span>
</code></pre></div>

<h3 id="35-service-and-ingress">3.5 Service and Ingress<a class="heading-anchor" href="#35-service-and-ingress" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># service.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">    </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<span class="nn">---</span>
<span class="c1"># ingress.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;50m&quot;</span>
<span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;letsencrypt-prod&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api.codegraph.company.com</span>
<span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-tls</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api.codegraph.company.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
</code></pre></div>

<h3 id="36-horizontalpodautoscaler">3.6 HorizontalPodAutoscaler<a class="heading-anchor" href="#36-horizontalpodautoscaler" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># hpa.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api-hpa</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleTargetRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-api</span>
<span class="w">  </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
<span class="w">      </span><span class="nt">resource</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpu</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
<span class="w">          </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">70</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
<span class="w">      </span><span class="nt">resource</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">memory</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
<span class="w">          </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">behavior</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">      </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">    </span><span class="nt">scaleUp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
</code></pre></div>

<h3 id="37-networkpolicy">3.7 NetworkPolicy<a class="heading-anchor" href="#37-networkpolicy" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># networkpolicy.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-network-policy</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Allow traffic from ingress controller</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">    </span><span class="c1"># Allow traffic from Prometheus</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># PostgreSQL</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">    </span><span class="c1"># Joern</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joern</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="c1"># Vault</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8200</span>
<span class="w">    </span><span class="c1"># SIEM (Syslog)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">514</span>
<span class="w">    </span><span class="c1"># LLM APIs (GigaChat, Yandex AI, OpenAI)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">    </span><span class="c1"># DNS</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">          </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">k8s-app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-dns</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
</code></pre></div>

<hr />
<h2 id="4-air-gapped-deployment">4. Air-Gapped Deployment<a class="heading-anchor" href="#4-air-gapped-deployment" title="Link to this section">&para;</a></h2>
<h3 id="41-isolated-environment-characteristics">4.1 Isolated Environment Characteristics<a class="heading-anchor" href="#41-isolated-environment-characteristics" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                        </span><span class="n">AIR</span><span class="o">-</span><span class="n">GAPPED</span><span class="w"> </span><span class="n">ENVIRONMENT</span><span class="w">                            </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">┌─────────────────────────────────────────────────────────────────┐</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                        </span><span class="n">NO</span><span class="w"> </span><span class="n">INTERNET</span><span class="w"> </span><span class="n">ACCESS</span><span class="w">                        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">┌─────────────┐</span><span class="w">  </span><span class="err">┌─────────────┐</span><span class="w">  </span><span class="err">┌─────────────────────────┐</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">CodeGraph</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Local</span><span class="w"> </span><span class="n">LLM</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Local</span><span class="w"> </span><span class="n">Container</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">API</span><span class="w">         </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="p">(</span><span class="n">llama</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="n">Registry</span><span class="w">               </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">             </span><span class="err">│──│</span><span class="w">             </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nl">DLP:</span><span class="w"> </span><span class="n">ON</span><span class="w">     </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Qwen3</span><span class="o">-</span><span class="mh">30</span><span class="n">B</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="nl">local:</span><span class="mh">5000</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nl">SIEM:</span><span class="w"> </span><span class="n">ON</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">LLMxCPG</span><span class="o">-</span><span class="n">Q</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="nl">Vault:</span><span class="w"> </span><span class="n">ON</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">             </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                         </span><span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">  </span><span class="err">└─────────────┘</span><span class="w">  </span><span class="err">└─────────────┘</span><span class="w">  </span><span class="err">└─────────────────────────┘</span><span class="w">  </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">│</span><span class="w">                                                                   </span><span class="err">│</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">└─────────────────────────────────────────────────────────────────┘</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">                           </span><span class="err">❌</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">EXTERNAL</span><span class="w"> </span><span class="n">LLM</span><span class="w"> </span><span class="n">APIs</span><span class="w">                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">                           </span><span class="err">✅</span><span class="w"> </span><span class="n">ALL</span><span class="w"> </span><span class="n">DATA</span><span class="w"> </span><span class="n">STAYS</span><span class="w"> </span><span class="n">ON</span><span class="o">-</span><span class="n">PREMISE</span><span class="w">                  </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                                                         </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="42-air-gapped-configuration">4.2 Air-Gapped Configuration<a class="heading-anchor" href="#42-air-gapped-configuration" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># config.yaml for air-gapped</span>
<span class="nt">llm</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Use local LLM instead of GigaChat</span>
<span class="w">  </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>

<span class="w">  </span><span class="nt">local</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Path to model (transferred on media)</span>
<span class="w">    </span><span class="nt">model_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/models/LLMxCPG-Q-32B-Q4_K_M.gguf&quot;</span>
<span class="w">    </span><span class="nt">use_llmxcpg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">n_ctx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">    </span><span class="nt">n_gpu_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w">  </span><span class="c1"># All layers on GPU</span>
<span class="w">    </span><span class="nt">n_batch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">    </span><span class="nt">n_threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>

<span class="nt">security</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="c1"># DLP works locally</span>
<span class="w">  </span><span class="nt">dlp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">webhook</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># No external webhooks</span>

<span class="w">  </span><span class="c1"># SIEM — local server</span>
<span class="w">  </span><span class="nt">siem</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">syslog</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;siem.local&quot;</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">514</span>

<span class="w">  </span><span class="c1"># Vault — local instance</span>
<span class="w">  </span><span class="nt">vault</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://vault.local:8200&quot;</span>
<span class="w">    </span><span class="nt">auth_method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;approle&quot;</span>
</code></pre></div>

<h3 id="43-preparing-artifacts-for-air-gapped">4.3 Preparing Artifacts for Air-Gapped<a class="heading-anchor" href="#43-preparing-artifacts-for-air-gapped" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># prepare-airgapped.sh — run on internet-connected machine</span>

<span class="c1"># 1. Download Docker images</span>
docker<span class="w"> </span>pull<span class="w"> </span>codegraph:latest
docker<span class="w"> </span>pull<span class="w"> </span>postgres:16-alpine
docker<span class="w"> </span>pull<span class="w"> </span>ghcr.io/joernio/joern:latest
docker<span class="w"> </span>pull<span class="w"> </span>hashicorp/vault:1.15

<span class="c1"># 2. Save images to tar</span>
docker<span class="w"> </span>save<span class="w"> </span>codegraph:latest<span class="w"> </span>postgres:16-alpine<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/joernio/joern:latest<span class="w"> </span>hashicorp/vault:1.15<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>codegraph-images.tar.gz

<span class="c1"># 3. Download LLM model</span>
wget<span class="w"> </span>https://huggingface.co/company/LLMxCPG-Q-32B-GGUF/resolve/main/LLMxCPG-Q-32B-Q4_K_M.gguf

<span class="c1"># 4. Download Python dependencies</span>
pip<span class="w"> </span>download<span class="w"> </span>-d<span class="w"> </span>./packages<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># 5. Package everything</span>
tar<span class="w"> </span>-czvf<span class="w"> </span>codegraph-airgapped-bundle.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>codegraph-images.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>LLMxCPG-Q-32B-Q4_K_M.gguf<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>packages/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>config/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>scripts/
</code></pre></div>

<h3 id="44-installation-in-air-gapped-environment">4.4 Installation in Air-Gapped Environment<a class="heading-anchor" href="#44-installation-in-air-gapped-environment" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># install-airgapped.sh — run in isolated environment</span>

<span class="c1"># 1. Extract bundle</span>
tar<span class="w"> </span>-xzvf<span class="w"> </span>codegraph-airgapped-bundle.tar.gz

<span class="c1"># 2. Load Docker images</span>
gunzip<span class="w"> </span>-c<span class="w"> </span>codegraph-images.tar.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>load

<span class="c1"># 3. Install Python dependencies from local cache</span>
pip<span class="w"> </span>install<span class="w"> </span>--no-index<span class="w"> </span>--find-links<span class="o">=</span>./packages<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># 4. Copy model</span>
cp<span class="w"> </span>LLMxCPG-Q-32B-Q4_K_M.gguf<span class="w"> </span>/models/

<span class="c1"># 5. Start services</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.airgapped.yml<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>

<hr />
<h2 id="5-deployment-security">5. Deployment Security<a class="heading-anchor" href="#5-deployment-security" title="Link to this section">&para;</a></h2>
<h3 id="51-tlsssl-configuration">5.1 TLS/SSL Configuration<a class="heading-anchor" href="#51-tlsssl-configuration" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Nginx Ingress with TLS 1.3</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-protocols</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TLSv1.3&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-ciphers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;</span>
<span class="w">      </span><span class="no">add_header X-Content-Type-Options &quot;nosniff&quot; always;</span>
<span class="w">      </span><span class="no">add_header X-Frame-Options &quot;DENY&quot; always;</span>
<span class="w">      </span><span class="no">add_header X-XSS-Protection &quot;1; mode=block&quot; always;</span>
</code></pre></div>

<h3 id="52-pod-security-standards">5.2 Pod Security Standards<a class="heading-anchor" href="#52-pod-security-standards" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># PodSecurityPolicy / Pod Security Admission</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodSecurityPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-restricted</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">runAsUser</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MustRunAsNonRoot</span>
<span class="w">  </span><span class="nt">seLinux</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunAsAny</span>
<span class="w">  </span><span class="nt">fsGroup</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunAsAny</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;configMap&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;emptyDir&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;projected&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;secret&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;downwardAPI&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;persistentVolumeClaim&#39;</span>
<span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">hostIPC</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">hostPID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">requiredDropCapabilities</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
</code></pre></div>

<h3 id="53-secrets-encryption">5.3 Secrets Encryption<a class="heading-anchor" href="#53-secrets-encryption" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># EncryptionConfiguration for etcd</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apiserver.config.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EncryptionConfiguration</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">aescbc</span><span class="p">:</span>
<span class="w">          </span><span class="nt">keys</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">key1</span>
<span class="w">              </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;base64-encoded-32-byte-key&gt;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">identity</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>

<hr />
<h2 id="6-monitoring-and-observability">6. Monitoring and Observability<a class="heading-anchor" href="#6-monitoring-and-observability" title="Link to this section">&para;</a></h2>
<h3 id="61-prometheus-servicemonitor">6.1 Prometheus ServiceMonitor<a class="heading-anchor" href="#61-prometheus-servicemonitor" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceMonitor</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-monitor</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/v1/metrics</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</code></pre></div>

<h3 id="62-grafana-dashboard">6.2 Grafana Dashboard<a class="heading-anchor" href="#62-grafana-dashboard" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Panel</th>
<th>Metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Request Rate</strong></td>
<td><code>rate(http_requests_total[5m])</code></td>
<td>Requests per second</td>
</tr>
<tr>
<td><strong>Error Rate</strong></td>
<td><code>rate(http_requests_total{status=~"5.."}[5m])</code></td>
<td>5xx errors</td>
</tr>
<tr>
<td><strong>Latency P95</strong></td>
<td><code>histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))</code></td>
<td>95th percentile latency</td>
</tr>
<tr>
<td><strong>DLP Blocks</strong></td>
<td><code>rate(dlp_blocks_total[5m])</code></td>
<td>DLP blocks</td>
</tr>
<tr>
<td><strong>LLM Tokens</strong></td>
<td><code>sum(rate(llm_tokens_total[1h]))</code></td>
<td>Token usage</td>
</tr>
</tbody>
</table></div>
<h3 id="63-alertmanager-rules">6.3 Alertmanager Rules<a class="heading-anchor" href="#63-alertmanager-rules" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring.coreos.com/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PrometheusRule</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph-alerts</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">groups</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codegraph</span>
<span class="w">      </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CodeGraphHighErrorRate</span>
<span class="w">          </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(http_requests_total{status=~&quot;5..&quot;}[5m]) &gt; 0.1</span>
<span class="w">          </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">          </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;High</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">CodeGraph</span><span class="nv"> </span><span class="s">API&quot;</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CodeGraphDLPHighBlockRate</span>
<span class="w">          </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rate(dlp_blocks_total[5m]) / rate(llm_requests_total[5m]) &gt; 0.2</span>
<span class="w">          </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">          </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DLP</span><span class="nv"> </span><span class="s">blocking</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">20%</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">requests&quot;</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CodeGraphPodNotReady</span>
<span class="w">          </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube_pod_status_ready{namespace=&quot;codegraph&quot;, condition=&quot;true&quot;} == 0</span>
<span class="w">          </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">          </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CodeGraph</span><span class="nv"> </span><span class="s">pod</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">ready&quot;</span>
</code></pre></div>

<hr />
<h2 id="7-backup-and-recovery">7. Backup and Recovery<a class="heading-anchor" href="#7-backup-and-recovery" title="Link to this section">&para;</a></h2>
<h3 id="71-postgresql-backup">7.1 PostgreSQL Backup<a class="heading-anchor" href="#71-postgresql-backup" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup-postgres.sh</span>

<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backups/postgres&quot;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<span class="nv">NAMESPACE</span><span class="o">=</span><span class="s2">&quot;codegraph&quot;</span>

<span class="c1"># Create backup</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$NAMESPACE</span><span class="w"> </span>postgres-0<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>pg_dump<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>codegraph<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/codegraph_<span class="nv">$DATE</span>.sql.gz

<span class="c1"># Remove old backups (older than 30 days)</span>
find<span class="w"> </span><span class="nv">$BACKUP_DIR</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.sql.gz&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+30<span class="w"> </span>-delete
</code></pre></div>

<h3 id="72-duckdb-backup">7.2 DuckDB Backup<a class="heading-anchor" href="#72-duckdb-backup" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup-duckdb.sh</span>

<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backups/duckdb&quot;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>

<span class="c1"># Copy DuckDB files</span>
kubectl<span class="w"> </span>cp<span class="w"> </span>codegraph/codegraph-api-0:/app/data/duckdb<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/duckdb_<span class="nv">$DATE</span>

<span class="c1"># Compress</span>
tar<span class="w"> </span>-czvf<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/duckdb_<span class="nv">$DATE</span>.tar.gz<span class="w"> </span>-C<span class="w"> </span><span class="nv">$BACKUP_DIR</span><span class="w"> </span>duckdb_<span class="nv">$DATE</span>
rm<span class="w"> </span>-rf<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/duckdb_<span class="nv">$DATE</span>
</code></pre></div>

<h3 id="73-disaster-recovery">7.3 Disaster Recovery<a class="heading-anchor" href="#73-disaster-recovery" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>RPO</th>
<th>RTO</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 hour</td>
<td>4 hours</td>
<td>Hourly snapshots, standby cluster</td>
</tr>
<tr>
<td>24 hours</td>
<td>24 hours</td>
<td>Daily backups, manual recovery</td>
</tr>
<tr>
<td>1 week</td>
<td>72 hours</td>
<td>Weekly backups, cold standby</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="8-migration-and-upgrades">8. Migration and Upgrades<a class="heading-anchor" href="#8-migration-and-upgrades" title="Link to this section">&para;</a></h2>
<h3 id="81-rolling-update">8.1 Rolling Update<a class="heading-anchor" href="#81-rolling-update" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Update image with zero downtime</span>
kubectl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>image<span class="w"> </span>deployment/codegraph-api<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="nv">api</span><span class="o">=</span>codegraph:v2.0.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>codegraph

<span class="c1"># Monitor rollout</span>
kubectl<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deployment/codegraph-api<span class="w"> </span>-n<span class="w"> </span>codegraph

<span class="c1"># Rollback on issues</span>
kubectl<span class="w"> </span>rollout<span class="w"> </span>undo<span class="w"> </span>deployment/codegraph-api<span class="w"> </span>-n<span class="w"> </span>codegraph
</code></pre></div>

<h3 id="82-database-migration">8.2 Database Migration<a class="heading-anchor" href="#82-database-migration" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Run Alembic migrations</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>codegraph<span class="w"> </span>deployment/codegraph-api<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>python<span class="w"> </span>-m<span class="w"> </span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head

<span class="c1"># Check current version</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>codegraph<span class="w"> </span>deployment/codegraph-api<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>python<span class="w"> </span>-m<span class="w"> </span>alembic<span class="w"> </span>current
</code></pre></div>

<hr />
<h2 id="related-documents">Related Documents<a class="heading-anchor" href="#related-documents" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="./SECURITY_BRIEF.html">Enterprise Security Brief</a> — Security overview</li>
<li><a href="./RBAC.html">RBAC Authorization</a> — Access control</li>
<li><a href="./SIEM.html">SIEM Integration</a> — SIEM integration</li>
<li><a href="./LLM_SECURITY.html">LLM Security</a> — LLM interaction protection</li>
</ul>
<hr />
<p><em>Version: 1.0 | December 2025</em></p>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="index.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Previous</span>
        <span class="doc-page-nav-title">Overview</span>
      </a>

      <a href="SECURITY_BRIEF.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Next</span>
        <span class="doc-page-nav-title">Enterprise Security Brief</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Last updated: 2025-12-27</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/enterprise/DEPLOYMENT_GUIDE.md" target="_blank" rel="noopener">Edit on GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">On this page</div>
      <ul class="doc-toc-list">
        <li><a href="#enterprise-deployment" class="level-1">Enterprise Deployment</a></li>
<li><a href="#table-of-contents" class="level-2">Table of Contents</a></li>
<li><a href="#overview" class="level-2">Overview</a></li>
<li><a href="#1-system-requirements" class="level-2">1. System Requirements</a></li>
<li><a href="#11-hardware-requirements" class="level-3">1.1 Hardware Requirements</a></li>
<li><a href="#12-software-requirements" class="level-3">1.2 Software Requirements</a></li>
<li><a href="#13-network-ports" class="level-3">1.3 Network Ports</a></li>
<li><a href="#2-docker-compose-development" class="level-2">2. Docker Compose (Development)</a></li>
<li><a href="#21-file-structure" class="level-3">2.1 File Structure</a></li>
<li><a href="#22-docker-composeyml" class="level-3">2.2 docker-compose.yml</a></li>
<li><a href="#23-environment-variables-env" class="level-3">2.3 Environment Variables (.env)</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#codegraph-environment-variables" class="level-1">CodeGraph Environment Variables</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#postgresql" class="level-1">PostgreSQL</a></li>
<li><a href="#jwt-authentication" class="level-1">JWT Authentication</a></li>
<li><a href="#llm-providers" class="level-1">LLM Providers</a></li>
<li><a href="#gigachat-sber" class="level-1">GigaChat (Sber)</a></li>
<li><a href="#yandex-ai-studio-optional" class="level-1">Yandex AI Studio (optional)</a></li>
<li><a href="#security-features" class="level-1">Security Features</a></li>
<li><a href="#siem-if-enabled" class="level-1">SIEM (if enabled)</a></li>
<li><a href="#vault-if-enabled" class="level-1">Vault (if enabled)</a></li>
<li><a href="#24-startup" class="level-3">2.4 Startup</a></li>
<li><a href="#create-env-file" class="level-1">Create .env file</a></li>
<li><a href="#edit-variables" class="level-1">Edit variables</a></li>
<li><a href="#start-all-services" class="level-1">Start all services</a></li>
<li><a href="#check-status" class="level-1">Check status</a></li>
<li><a href="#view-logs" class="level-1">View logs</a></li>
<li><a href="#initialize-database" class="level-1">Initialize database</a></li>
<li><a href="#create-administrator" class="level-1">Create administrator</a></li>
<li><a href="#3-kubernetes-production" class="level-2">3. Kubernetes (Production)</a></li>
<li><a href="#31-architecture" class="level-3">3.1 Architecture</a></li>
<li><a href="#32-namespace-and-configmap" class="level-3">3.2 Namespace and ConfigMap</a></li>
<li><a href="#namespaceyaml" class="level-1">namespace.yaml</a></li>
<li><a href="#configmapyaml" class="level-1">configmap.yaml</a></li>
<li><a href="#33-secrets" class="level-3">3.3 Secrets</a></li>
<li><a href="#secretsyaml" class="level-1">secrets.yaml</a></li>
<li><a href="#for-production-use-external-secrets-operator-vault" class="level-1">For production use External Secrets Operator + Vault</a></li>
<li><a href="#34-deployment" class="level-3">3.4 Deployment</a></li>
<li><a href="#deploymentyaml" class="level-1">deployment.yaml</a></li>
<li><a href="#35-service-and-ingress" class="level-3">3.5 Service and Ingress</a></li>
<li><a href="#serviceyaml" class="level-1">service.yaml</a></li>
<li><a href="#ingressyaml" class="level-1">ingress.yaml</a></li>
<li><a href="#36-horizontalpodautoscaler" class="level-3">3.6 HorizontalPodAutoscaler</a></li>
<li><a href="#hpayaml" class="level-1">hpa.yaml</a></li>
<li><a href="#37-networkpolicy" class="level-3">3.7 NetworkPolicy</a></li>
<li><a href="#networkpolicyyaml" class="level-1">networkpolicy.yaml</a></li>
<li><a href="#4-air-gapped-deployment" class="level-2">4. Air-Gapped Deployment</a></li>
<li><a href="#41-isolated-environment-characteristics" class="level-3">4.1 Isolated Environment Characteristics</a></li>
<li><a href="#42-air-gapped-configuration" class="level-3">4.2 Air-Gapped Configuration</a></li>
<li><a href="#configyaml-for-air-gapped" class="level-1">config.yaml for air-gapped</a></li>
<li><a href="#43-preparing-artifacts-for-air-gapped" class="level-3">4.3 Preparing Artifacts for Air-Gapped</a></li>
<li><a href="#prepare-airgappedsh-run-on-internet-connected-machine" class="level-1">prepare-airgapped.sh — run on internet-connected machine</a></li>
<li><a href="#1-download-docker-images" class="level-1">1. Download Docker images</a></li>
<li><a href="#2-save-images-to-tar" class="level-1">2. Save images to tar</a></li>
<li><a href="#3-download-llm-model" class="level-1">3. Download LLM model</a></li>
<li><a href="#4-download-python-dependencies" class="level-1">4. Download Python dependencies</a></li>
<li><a href="#5-package-everything" class="level-1">5. Package everything</a></li>
<li><a href="#44-installation-in-air-gapped-environment" class="level-3">4.4 Installation in Air-Gapped Environment</a></li>
<li><a href="#install-airgappedsh-run-in-isolated-environment" class="level-1">install-airgapped.sh — run in isolated environment</a></li>
<li><a href="#1-extract-bundle" class="level-1">1. Extract bundle</a></li>
<li><a href="#2-load-docker-images" class="level-1">2. Load Docker images</a></li>
<li><a href="#3-install-python-dependencies-from-local-cache" class="level-1">3. Install Python dependencies from local cache</a></li>
<li><a href="#4-copy-model" class="level-1">4. Copy model</a></li>
<li><a href="#5-start-services" class="level-1">5. Start services</a></li>
<li><a href="#5-deployment-security" class="level-2">5. Deployment Security</a></li>
<li><a href="#51-tlsssl-configuration" class="level-3">5.1 TLS/SSL Configuration</a></li>
<li><a href="#nginx-ingress-with-tls-13" class="level-1">Nginx Ingress with TLS 1.3</a></li>
<li><a href="#52-pod-security-standards" class="level-3">5.2 Pod Security Standards</a></li>
<li><a href="#podsecuritypolicy-pod-security-admission" class="level-1">PodSecurityPolicy / Pod Security Admission</a></li>
<li><a href="#53-secrets-encryption" class="level-3">5.3 Secrets Encryption</a></li>
<li><a href="#encryptionconfiguration-for-etcd" class="level-1">EncryptionConfiguration for etcd</a></li>
<li><a href="#6-monitoring-and-observability" class="level-2">6. Monitoring and Observability</a></li>
<li><a href="#61-prometheus-servicemonitor" class="level-3">6.1 Prometheus ServiceMonitor</a></li>
<li><a href="#62-grafana-dashboard" class="level-3">6.2 Grafana Dashboard</a></li>
<li><a href="#63-alertmanager-rules" class="level-3">6.3 Alertmanager Rules</a></li>
<li><a href="#7-backup-and-recovery" class="level-2">7. Backup and Recovery</a></li>
<li><a href="#71-postgresql-backup" class="level-3">7.1 PostgreSQL Backup</a></li>
<li><a href="#backup-postgressh" class="level-1">backup-postgres.sh</a></li>
<li><a href="#create-backup" class="level-1">Create backup</a></li>
<li><a href="#remove-old-backups-older-than-30-days" class="level-1">Remove old backups (older than 30 days)</a></li>
<li><a href="#72-duckdb-backup" class="level-3">7.2 DuckDB Backup</a></li>
<li><a href="#backup-duckdbsh" class="level-1">backup-duckdb.sh</a></li>
<li><a href="#copy-duckdb-files" class="level-1">Copy DuckDB files</a></li>
<li><a href="#compress" class="level-1">Compress</a></li>
<li><a href="#73-disaster-recovery" class="level-3">7.3 Disaster Recovery</a></li>
<li><a href="#8-migration-and-upgrades" class="level-2">8. Migration and Upgrades</a></li>
<li><a href="#81-rolling-update" class="level-3">8.1 Rolling Update</a></li>
<li><a href="#update-image-with-zero-downtime" class="level-1">Update image with zero downtime</a></li>
<li><a href="#monitor-rollout" class="level-1">Monitor rollout</a></li>
<li><a href="#rollback-on-issues" class="level-1">Rollback on issues</a></li>
<li><a href="#82-database-migration" class="level-3">8.2 Database Migration</a></li>
<li><a href="#run-alembic-migrations" class="level-1">Run Alembic migrations</a></li>
<li><a href="#check-current-version" class="level-1">Check current version</a></li>
<li><a href="#related-documents" class="level-2">Related Documents</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI copilot for source code analysis</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Product</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Features</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Integrations</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Documentation</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Getting Started</a></li>
              <li><a href="../guides/index.html" class="footer-link">Guides</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Resources</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Contacts</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
