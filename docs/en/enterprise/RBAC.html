<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: RBAC and Authorization">
  <meta name="keywords" content="CodeGraph, documentation, enterprise">

  <meta property="og:title" content="RBAC and Authorization - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: RBAC and Authorization">
  <meta property="og:type" content="article">

  <title>RBAC and Authorization - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Problems</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Solution</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Features</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Integrations</a></li>
        <li><a href="../index.html" class="nav-link active">Documentation</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/enterprise/RBAC.html" class="active">EN</a>
          <a href="../../ru/enterprise/RBAC.html" class="">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Toggle theme">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Request Demo</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Problems</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Solution</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Features</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Integrations</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Documentation</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Request Demo</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Getting Started</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../getting-started/index.html">Overview</a></li>
        <li><a href="../getting-started/CONFIGURATION.html">Configuration Guide</a></li>
        <li><a href="../getting-started/INSTALLATION.html">Installation Guide</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">User Guides</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Overview</a></li>
        <li><a href="../guides/BENCHMARK_GUIDE.html">Benchmark Framework Guide</a></li>
        <li><a href="../guides/CLI_GUIDE.html">CLI Guide</a></li>
        <li><a href="../guides/CODE_REVIEW.html">Automated Code Review</a></li>
        <li><a href="../guides/CPG_EXPORT.html">CPG Export Guide</a></li>
        <li><a href="../guides/MONITORING.html">Monitoring Guide</a></li>
        <li><a href="../guides/PROGRAMMATIC_GUIDE.html">User Guide</a></li>
        <li><a href="../guides/PROJECT_IMPORT.html">Importing a New Codebase</a></li>
        <li><a href="../guides/QUICK_REFERENCE.html">CodeGraph Quick Reference</a></li>
        <li><a href="../guides/REFACTORING.html">Refactoring Analysis Guide</a></li>
        <li><a href="../guides/SCENARIOS.html">Workflow Scenarios Guide</a></li>
        <li><a href="../guides/TROUBLESHOOTING.html">Troubleshooting Guide</a></li>
        <li><a href="../guides/TUI_USER_GUIDE.html">CodeGraph User Guide</a></li>
        <li><a href="../guides/01-onboarding.html">Scenario 01: Developer Onboarding</a></li>
        <li><a href="../guides/02-security-audit.html">Scenario 02: Security Audit</a></li>
        <li><a href="../guides/03-documentation.html">Scenario 03: Documentation Generation</a></li>
        <li><a href="../guides/04-feature-development.html">Scenario 04: Feature Development</a></li>
        <li><a href="../guides/05-refactoring.html">Scenario 05: Refactoring</a></li>
        <li><a href="../guides/06-performance.html">Scenario 06: Performance Analysis</a></li>
        <li><a href="../guides/07-test-coverage.html">Scenario 07: Test Coverage</a></li>
        <li><a href="../guides/08-compliance.html">Scenario 08: Compliance Checking</a></li>
        <li><a href="../guides/09-code-review.html">Scenario 09: Code Review</a></li>
        <li><a href="../guides/10-cross-repo.html">Scenario 10: Cross-Repository Analysis</a></li>
        <li><a href="../guides/11-architecture.html">Scenario 11: Architecture Analysis</a></li>
        <li><a href="../guides/12-tech-debt.html">Scenario 12: Tech Debt Assessment</a></li>
        <li><a href="../guides/13-mass-refactoring.html">Scenario 13: Mass Refactoring</a></li>
        <li><a href="../guides/14-incident-response.html">Scenario 14: Security Incident Response</a></li>
        <li><a href="../guides/15-debugging.html">Scenario 15: Debugging Assistance</a></li>
        <li><a href="../guides/16-entry-points.html">Scenario 16: Entry Point Discovery</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Reference</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../api/index.html">Overview</a></li>
        <li><a href="../api/REST_API.html">CodeGraph REST API Documentation</a></li>
        <li><a href="../api/WEBSOCKET_API.html">WebSocket API Reference</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Integrations</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../integrations/index.html">Overview</a></li>
        <li><a href="../integrations/GIGACHAT.html">GigaChat Integration Guide</a></li>
        <li><a href="../integrations/YANDEX_AI_STUDIO.html">Yandex AI Studio Integration Guide</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Technical Reference</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../reference/index.html">Overview</a></li>
        <li><a href="../reference/AGENTS.html">Agents Reference</a></li>
        <li><a href="../reference/ANALYSIS_MODULES.html">Analysis Modules Reference</a></li>
        <li><a href="../reference/API.html">API Reference</a></li>
        <li><a href="../reference/HYPOTHESIS_SYSTEM.html">Hypothesis System Reference</a></li>
        <li><a href="../reference/SCHEMA.html">DuckDB CPG Schema Design (CPG Spec v1.1)</a></li>
        <li><a href="../reference/SECURITY.html">Enterprise Security Module</a></li>
        <li><a href="../reference/SQL_QUERY_COOKBOOK.html">SQL Query Cookbook for DuckDB CPG</a></li>
        <li><a href="../reference/WORKFLOWS.html">Workflows Reference</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Overview</a></li>
        <li><a href="COMPETITIVE_MATRIX.html">CodeGraph Competitive Matrix</a></li>
        <li><a href="DEPLOYMENT_GUIDE.html">Enterprise Deployment</a></li>
        <li><a href="DLP_SECURITY.html">DLP: Data Loss Prevention</a></li>
        <li><a href="HYPOTHESIS_WHITEPAPER.html">Security Hypothesis Validation</a></li>
        <li><a href="LLM_SECURITY.html">LLM Integration Security</a></li>
        <li><a href="RBAC.html" class="active">RBAC and Authorization</a></li>
        <li><a href="SECURITY_BRIEF.html">Enterprise Security Brief</a></li>
        <li><a href="SIEM.html">SIEM Integration</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Documentation</a>
        <span>/</span>
        <a href="index.html">Enterprise</a>
        <span>/</span>
        <span>RBAC and Authorization</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>RBAC and Authorization</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="rbac-and-authorization">RBAC and Authorization<a class="heading-anchor" href="#rbac-and-authorization" title="Link to this section">&para;</a></h1>
<blockquote class="callout">
<p>Technical Documentation for IT and Security Teams</p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="heading-anchor" href="#table-of-contents" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#key-capabilities">Key Capabilities</a></li>
<li><a href="#rbac-architecture">RBAC Architecture</a></li>
<li><a href="#role-hierarchy">Role Hierarchy</a></li>
<li><a href="#permission-inheritance">Permission Inheritance</a></li>
<li><a href="#permission-catalog">Permission Catalog</a></li>
<li><a href="#permissions-by-category">Permissions by Category</a></li>
<li><a href="#authentication-methods">Authentication Methods</a></li>
<li><a href="#1-jwt-bearer-token">1. JWT Bearer Token</a></li>
<li><a href="#2-api-keys">2. API Keys</a></li>
<li><a href="#3-oauth2oidc-integration-ready">3. OAuth2/OIDC (Integration-Ready)</a></li>
<li><a href="#4-ldapactive-directory-integration-ready">4. LDAP/Active Directory (Integration-Ready)</a></li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#middleware-dependencies">Middleware Dependencies</a></li>
<li><a href="#fastapi-usage-examples">FastAPI Usage Examples</a></li>
<li><a href="#authcontext">AuthContext</a></li>
<li><a href="#auditing-and-logging">Auditing and Logging</a></li>
<li><a href="#authorization-events">Authorization Events</a></li>
<li><a href="#log-format">Log Format</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#for-administrators">For Administrators</a></li>
<li><a href="#for-developers">For Developers</a></li>
<li><a href="#related-documents">Related Documents</a></li>
</ul>
<h2 id="overview">Overview<a class="heading-anchor" href="#overview" title="Link to this section">&para;</a></h2>
<p>CodeGraph implements a comprehensive Role-Based Access Control (RBAC) system with support for multiple authentication methods. The system provides granular access control to platform features.</p>
<h3 id="key-capabilities">Key Capabilities<a class="heading-anchor" href="#key-capabilities" title="Link to this section">&para;</a></h3>
<ul>
<li><strong>4 role levels</strong> with hierarchical inheritance</li>
<li><strong>21 granular permissions</strong> across functional categories</li>
<li><strong>Multiple authentication methods</strong>: JWT, API keys, OAuth2, LDAP</li>
<li><strong>Token blacklisting</strong> for instant access revocation</li>
<li><strong>SIEM integration</strong> for authorization event auditing</li>
</ul>
<hr />
<h2 id="rbac-architecture">RBAC Architecture<a class="heading-anchor" href="#rbac-architecture" title="Link to this section">&para;</a></h2>
<h3 id="role-hierarchy">Role Hierarchy<a class="heading-anchor" href="#role-hierarchy" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>                           ┌─────────────────────┐
                           │       ADMIN         │
                           │    (admin:all)      │
                           │    Full access      │
                           └──────────┬──────────┘
                                      │
                           ┌──────────▼──────────┐
                           │      REVIEWER       │
                           │  Code review +      │
                           │  GitHub + GitLab    │
                           └──────────┬──────────┘
                                      │
                           ┌──────────▼──────────┐
                           │      ANALYST        │
                           │  Query execution    │
                           │  + API keys         │
                           └──────────┬──────────┘
                                      │
                           ┌──────────▼──────────┐
                           │       VIEWER        │
                           │    Read-only        │
                           └─────────────────────┘
</code></pre></div>

<h3 id="permission-inheritance">Permission Inheritance<a class="heading-anchor" href="#permission-inheritance" title="Link to this section">&para;</a></h3>
<p>Each role inherits all permissions from lower-level roles:
- <code>ADMIN</code> → all permissions (<code>admin:all</code>)
- <code>REVIEWER</code> → <code>ANALYST</code> permissions + code review
- <code>ANALYST</code> → <code>VIEWER</code> permissions + execution/export
- <code>VIEWER</code> → read-only (base level)</p>
<hr />
<h2 id="permission-catalog">Permission Catalog<a class="heading-anchor" href="#permission-catalog" title="Link to this section">&para;</a></h2>
<h3 id="permissions-by-category">Permissions by Category<a class="heading-anchor" href="#permissions-by-category" title="Link to this section">&para;</a></h3>
<h4 id="scenarios-scenarios">Scenarios (<code>scenarios:*</code>)<a class="heading-anchor" href="#scenarios-scenarios" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scenarios:read</code></td>
<td>View scenario list</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>scenarios:execute</code></td>
<td>Run analysis scenarios</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="queries-query">Queries (<code>query:*</code>)<a class="heading-anchor" href="#queries-query" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>query:execute</code></td>
<td>Execute SQL queries against CPG</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>query:validate</code></td>
<td>Validate query syntax</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="code-review-review">Code Review (<code>review:*</code>)<a class="heading-anchor" href="#code-review-review" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>review:execute</code></td>
<td>Run automated review</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>review:github</code></td>
<td>GitHub PR integration</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>review:gitlab</code></td>
<td>GitLab MR integration</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="sessions-sessions">Sessions (<code>sessions:*</code>)<a class="heading-anchor" href="#sessions-sessions" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sessions:read</code></td>
<td>View sessions</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>sessions:write</code></td>
<td>Create/modify sessions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>sessions:delete</code></td>
<td>Delete sessions</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="history-history">History (<code>history:*</code>)<a class="heading-anchor" href="#history-history" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>history:read</code></td>
<td>View query history</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>history:export</code></td>
<td>Export history</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="users-users">Users (<code>users:*</code>)<a class="heading-anchor" href="#users-users" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>users:read</code></td>
<td>View user list</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>users:write</code></td>
<td>Create/edit users</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>users:delete</code></td>
<td>Delete users</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="api-keys-api-keys">API Keys (<code>api_keys:*</code>)<a class="heading-anchor" href="#api-keys-api-keys" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api_keys:read</code></td>
<td>View own keys</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>api_keys:write</code></td>
<td>Create keys</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>api_keys:delete</code></td>
<td>Delete any keys</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="metrics-stats-metrics">Metrics (<code>stats:*</code>, <code>metrics:*</code>)<a class="heading-anchor" href="#metrics-stats-metrics" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stats:read</code></td>
<td>View statistics</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
<td style="text-align: center;">✓</td>
</tr>
<tr>
<td><code>metrics:read</code></td>
<td>Prometheus metrics</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<h4 id="administration">Administration<a class="heading-anchor" href="#administration" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
<th style="text-align: center;">VIEWER</th>
<th style="text-align: center;">ANALYST</th>
<th style="text-align: center;">REVIEWER</th>
<th style="text-align: center;">ADMIN</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>admin:all</code></td>
<td>Full access</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">✓</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="authentication-methods">Authentication Methods<a class="heading-anchor" href="#authentication-methods" title="Link to this section">&para;</a></h2>
<h3 id="1-jwt-bearer-token">1. JWT Bearer Token<a class="heading-anchor" href="#1-jwt-bearer-token" title="Link to this section">&para;</a></h3>
<p>Primary method for web applications and interactive sessions.</p>
<h4 id="token-structure">Token Structure<a class="heading-anchor" href="#token-structure" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TokenPayload</span><span class="p">:</span>
    <span class="n">sub</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># User ID</span>
    <span class="n">jti</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># JWT ID (unique identifier)</span>
    <span class="n">exp</span><span class="p">:</span> <span class="n">datetime</span>  <span class="c1"># Expiration time</span>
    <span class="n">iat</span><span class="p">:</span> <span class="n">datetime</span>  <span class="c1"># Issued at</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>      <span class="c1"># &quot;access&quot; or &quot;refresh&quot;</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="nb">list</span>   <span class="c1"># Permission list</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span>      <span class="c1"># User role</span>
</code></pre></div>

<h4 id="token-parameters">Token Parameters<a class="heading-anchor" href="#token-parameters" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Token Type</th>
<th>TTL</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access Token</td>
<td>30 minutes</td>
<td>API request authorization</td>
</tr>
<tr>
<td>Refresh Token</td>
<td>7 days</td>
<td>Access token renewal</td>
</tr>
</tbody>
</table></div>
<h4 id="usage-example">Usage Example<a class="heading-anchor" href="#usage-example" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Get token</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>/api/v1/auth/login<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;username&quot;: &quot;analyst&quot;, &quot;password&quot;: &quot;***&quot;}&#39;</span>

<span class="c1"># Response:</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;access_token&quot;</span>:<span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>,
<span class="w">  </span><span class="s2">&quot;refresh_token&quot;</span>:<span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>,
<span class="w">  </span><span class="s2">&quot;token_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;bearer&quot;</span>,
<span class="w">  </span><span class="s2">&quot;expires_in&quot;</span>:<span class="w"> </span><span class="m">1800</span>
<span class="o">}</span>

<span class="c1"># Use token</span>
curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>/api/v1/scenarios<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
</code></pre></div>

<h4 id="token-revocation-blacklisting">Token Revocation (Blacklisting)<a class="heading-anchor" href="#token-revocation-blacklisting" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Logout - add token to blacklist</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>/api/v1/auth/logout<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
</code></pre></div>

<p>After blacklisting, the token becomes invalid immediately.</p>
<hr />
<h3 id="2-api-keys">2. API Keys<a class="heading-anchor" href="#2-api-keys" title="Link to this section">&para;</a></h3>
<p>For integrations, CI/CD, and automation.</p>
<h4 id="api-key-format">API Key Format<a class="heading-anchor" href="#api-key-format" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">Prefix</span><span class="o">:</span><span class="w"> </span><span class="n">cgk_</span><span class="w">          </span><span class="o">(</span><span class="n">CodeGraph</span><span class="w"> </span><span class="n">Key</span><span class="o">)</span>
<span class="n">Secret</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">36</span><span class="w"> </span><span class="n">chars</span><span class="o">]</span><span class="w">    </span><span class="o">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">v4</span><span class="o">)</span>

<span class="n">Example</span><span class="o">:</span><span class="w"> </span><span class="n">cgk_550e8400</span><span class="o">-</span><span class="n">e29b</span><span class="o">-</span><span class="mi">41</span><span class="n">d4</span><span class="o">-</span><span class="n">a716</span><span class="o">-</span><span class="mi">446655440000</span>
</code></pre></div>

<h4 id="storage-security">Storage Security<a class="heading-anchor" href="#storage-security" title="Link to this section">&para;</a></h4>
<ul>
<li>Keys are SHA-256 hashed before storage</li>
<li>Full key shown only at creation time</li>
<li>Support for expiration and revocation</li>
</ul>
<h4 id="usage-example_1">Usage Example<a class="heading-anchor" href="#usage-example_1" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Create API key</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>/api/v1/auth/api-keys<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;admin_token&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;CI Pipeline&quot;, &quot;scopes&quot;: [&quot;query:execute&quot;, &quot;scenarios:execute&quot;]}&#39;</span>

<span class="c1"># Response:</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;key_123&quot;</span>,
<span class="w">  </span><span class="s2">&quot;key&quot;</span>:<span class="w"> </span><span class="s2">&quot;cgk_550e8400-e29b-41d4-a716-446655440000&quot;</span>,<span class="w">  </span><span class="c1"># Shown only once!</span>
<span class="w">  </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;CI Pipeline&quot;</span>,
<span class="w">  </span><span class="s2">&quot;scopes&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;query:execute&quot;</span>,<span class="w"> </span><span class="s2">&quot;scenarios:execute&quot;</span><span class="o">]</span>,
<span class="w">  </span><span class="s2">&quot;expires_at&quot;</span>:<span class="w"> </span><span class="s2">&quot;2026-01-01T00:00:00Z&quot;</span>
<span class="o">}</span>

<span class="c1"># Use API key</span>
curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>/api/v1/scenarios<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;X-API-Key: cgk_550e8400-e29b-41d4-a716-446655440000&quot;</span>
</code></pre></div>

<h4 id="default-api-key-permissions">Default API Key Permissions<a class="heading-anchor" href="#default-api-key-permissions" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">default_scopes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;scenarios:read&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scenarios:execute&quot;</span><span class="p">,</span>
    <span class="s2">&quot;query:execute&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sessions:read&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sessions:write&quot;</span><span class="p">,</span>
    <span class="s2">&quot;history:read&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<hr />
<h3 id="3-oauth2oidc-integration-ready">3. OAuth2/OIDC (Integration-Ready)<a class="heading-anchor" href="#3-oauth2oidc-integration-ready" title="Link to this section">&para;</a></h3>
<p>Support for enterprise identity providers.</p>
<h4 id="supported-providers">Supported Providers<a class="heading-anchor" href="#supported-providers" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Provider</th>
<th>Status</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>GitHub</td>
<td>✅ Ready</td>
<td>Developers, open-source</td>
</tr>
<tr>
<td>GitLab</td>
<td>✅ Ready</td>
<td>Corporate GitLab</td>
</tr>
<tr>
<td>Google</td>
<td>✅ Ready</td>
<td>Google Workspace</td>
</tr>
<tr>
<td>Keycloak</td>
<td>✅ Ready</td>
<td>Enterprise IdP</td>
</tr>
<tr>
<td>Azure AD</td>
<td>✅ Ready</td>
<td>Microsoft 365</td>
</tr>
</tbody>
</table></div>
<h4 id="configuration-keycloak-example">Configuration (Keycloak Example)<a class="heading-anchor" href="#configuration-keycloak-example" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">oauth2</span><span class="p">:</span>
<span class="w">  </span><span class="nt">providers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">keycloak</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">client_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;codegraph&quot;</span>
<span class="w">      </span><span class="nt">client_secret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${KEYCLOAK_SECRET}&quot;</span>
<span class="w">      </span><span class="nt">authorize_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://keycloak.company.com/realms/main/protocol/openid-connect/auth&quot;</span>
<span class="w">      </span><span class="nt">token_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://keycloak.company.com/realms/main/protocol/openid-connect/token&quot;</span>
<span class="w">      </span><span class="nt">userinfo_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://keycloak.company.com/realms/main/protocol/openid-connect/userinfo&quot;</span>
<span class="w">      </span><span class="nt">scopes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;openid&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;profile&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;email&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;groups&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">role_claim</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;realm_access.roles&quot;</span>
<span class="w">      </span><span class="nt">role_mapping</span><span class="p">:</span>
<span class="w">        </span><span class="nt">codegraph-admin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">        </span><span class="nt">codegraph-reviewer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviewer</span>
<span class="w">        </span><span class="nt">codegraph-analyst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyst</span>
<span class="w">        </span><span class="nt">codegraph-viewer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">viewer</span>
</code></pre></div>

<hr />
<h3 id="4-ldapactive-directory-integration-ready">4. LDAP/Active Directory (Integration-Ready)<a class="heading-anchor" href="#4-ldapactive-directory-integration-ready" title="Link to this section">&para;</a></h3>
<p>Integration with corporate directory.</p>
<h4 id="configuration">Configuration<a class="heading-anchor" href="#configuration" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">ldap</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldaps://ldap.company.com:636&quot;</span>
<span class="w">  </span><span class="nt">base_dn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dc=company,dc=com&quot;</span>
<span class="w">  </span><span class="nt">bind_dn</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cn=codegraph,ou=services,dc=company,dc=com&quot;</span>
<span class="w">  </span><span class="nt">bind_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${LDAP_PASSWORD}&quot;</span>
<span class="w">  </span><span class="nt">user_search_base</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=users,dc=company,dc=com&quot;</span>
<span class="w">  </span><span class="nt">user_search_filter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(sAMAccountName={username})&quot;</span>
<span class="w">  </span><span class="nt">group_search_base</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=groups,dc=company,dc=com&quot;</span>
<span class="w">  </span><span class="nt">group_membership_attr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;memberOf&quot;</span>
<span class="w">  </span><span class="nt">group_mapping</span><span class="p">:</span>
<span class="w">    </span><span class="s">&quot;CN=CodeGraph-Admins,OU=Groups,DC=company,DC=com&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">    </span><span class="s">&quot;CN=CodeGraph-Reviewers,OU=Groups,DC=company,DC=com&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviewer</span>
<span class="w">    </span><span class="s">&quot;CN=CodeGraph-Analysts,OU=Groups,DC=company,DC=com&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyst</span>
<span class="w">    </span><span class="s">&quot;CN=CodeGraph-Viewers,OU=Groups,DC=company,DC=com&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">viewer</span>
<span class="w">  </span><span class="nt">sync_interval_minutes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
</code></pre></div>

<h4 id="group-synchronization">Group Synchronization<a class="heading-anchor" href="#group-synchronization" title="Link to this section">&para;</a></h4>
<ul>
<li>Automatic role sync with AD groups</li>
<li>Nested group support</li>
<li>Caching with configurable TTL</li>
</ul>
<hr />
<h2 id="api-reference">API Reference<a class="heading-anchor" href="#api-reference" title="Link to this section">&para;</a></h2>
<h3 id="middleware-dependencies">Middleware Dependencies<a class="heading-anchor" href="#middleware-dependencies" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.api.auth.middleware</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_auth_context</span><span class="p">,</span>     <span class="c1"># Get context (no error if unauthenticated)</span>
    <span class="n">require_auth</span><span class="p">,</span>         <span class="c1"># Require any authentication</span>
    <span class="n">require_permission</span><span class="p">,</span>   <span class="c1"># Require specific permission</span>
    <span class="n">require_role</span><span class="p">,</span>         <span class="c1"># Require specific role</span>
    <span class="n">require_admin</span><span class="p">,</span>        <span class="c1"># Shortcut for admin</span>
    <span class="n">require_analyst</span><span class="p">,</span>      <span class="c1"># Shortcut for analyst+</span>
    <span class="n">require_reviewer</span><span class="p">,</span>     <span class="c1"># Shortcut for reviewer+</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="fastapi-usage-examples">FastAPI Usage Examples<a class="heading-anchor" href="#fastapi-usage-examples" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">APIRouter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.auth.middleware</span><span class="w"> </span><span class="kn">import</span> <span class="n">require_permission</span><span class="p">,</span> <span class="n">require_admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.auth.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Permission</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>

<span class="c1"># Require specific permission</span>
<span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/query/execute&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_query</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_permission</span><span class="p">(</span><span class="n">Permission</span><span class="o">.</span><span class="n">QUERY_EXECUTE</span><span class="p">))</span>
<span class="p">):</span>
    <span class="c1"># auth.user_id, auth.role, auth.scopes available</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}</span>

<span class="c1"># Require one of multiple permissions</span>
<span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/reviews&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_reviews</span><span class="p">(</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_any_permission</span><span class="p">(</span>
        <span class="n">Permission</span><span class="o">.</span><span class="n">REVIEW_EXECUTE</span><span class="p">,</span>
        <span class="n">Permission</span><span class="o">.</span><span class="n">REVIEW_GITHUB</span><span class="p">,</span>
        <span class="n">Permission</span><span class="o">.</span><span class="n">REVIEW_GITLAB</span>
    <span class="p">))</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;reviews&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]}</span>

<span class="c1"># Require Admin role</span>
<span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_user</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">require_admin</span><span class="p">)</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;deleted&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
</code></pre></div>

<h3 id="authcontext">AuthContext<a class="heading-anchor" href="#authcontext" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AuthContext</span><span class="p">:</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># User ID</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>         <span class="c1"># Username</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">Role</span>            <span class="c1"># Role (VIEWER, ANALYST, REVIEWER, ADMIN)</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>     <span class="c1"># Permission list</span>
    <span class="n">auth_method</span><span class="p">:</span> <span class="nb">str</span>      <span class="c1"># &quot;jwt&quot;, &quot;api_key&quot;, &quot;oauth2&quot;, &quot;ldap&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check authentication status&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission</span><span class="p">:</span> <span class="n">Permission</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check specific permission&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="auditing-and-logging">Auditing and Logging<a class="heading-anchor" href="#auditing-and-logging" title="Link to this section">&para;</a></h2>
<h3 id="authorization-events">Authorization Events<a class="heading-anchor" href="#authorization-events" title="Link to this section">&para;</a></h3>
<p>All authorization events are logged and sent to SIEM:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Event</th>
<th>Severity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AUTH_SUCCESS</code></td>
<td>INFO</td>
<td>Successful authentication</td>
</tr>
<tr>
<td><code>AUTH_FAILURE</code></td>
<td>WARNING</td>
<td>Failed attempt</td>
</tr>
<tr>
<td><code>TOKEN_ISSUED</code></td>
<td>INFO</td>
<td>New token issued</td>
</tr>
<tr>
<td><code>TOKEN_REVOKED</code></td>
<td>INFO</td>
<td>Token revoked</td>
</tr>
<tr>
<td><code>PERMISSION_DENIED</code></td>
<td>WARNING</td>
<td>Access denied</td>
</tr>
<tr>
<td><code>API_KEY_CREATED</code></td>
<td>INFO</td>
<td>API key created</td>
</tr>
<tr>
<td><code>API_KEY_REVOKED</code></td>
<td>INFO</td>
<td>API key revoked</td>
</tr>
</tbody>
</table></div>
<h3 id="log-format">Log Format<a class="heading-anchor" href="#log-format" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-12-14T10:30:00.000Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;event_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AUTH_SUCCESS&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;analyst@company.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;analyst&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;auth_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jwt&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ip_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10.0.0.50&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/api/v1/scenarios&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="best-practices">Best Practices<a class="heading-anchor" href="#best-practices" title="Link to this section">&para;</a></h2>
<h3 id="for-administrators">For Administrators<a class="heading-anchor" href="#for-administrators" title="Link to this section">&para;</a></h3>
<ol>
<li><strong>Least privilege principle</strong> — assign minimum necessary roles</li>
<li><strong>Use API keys with limited scopes</strong> for automation</li>
<li><strong>Configure LDAP/AD sync</strong> for centralized management</li>
<li><strong>Enable SIEM integration</strong> for security event monitoring</li>
<li><strong>Regularly audit</strong> active sessions and API keys</li>
</ol>
<h3 id="for-developers">For Developers<a class="heading-anchor" href="#for-developers" title="Link to this section">&para;</a></h3>
<ol>
<li><strong>Use JWT for web apps</strong>, API keys for CI/CD</li>
<li><strong>Store refresh tokens securely</strong> (httpOnly cookies)</li>
<li><strong>Handle 401/403</strong> correctly in UI</li>
<li><strong>Never log tokens or keys</strong> in plain text</li>
</ol>
<hr />
<h2 id="related-documents">Related Documents<a class="heading-anchor" href="#related-documents" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="./SECURITY_BRIEF.html">Enterprise Security Brief</a> — Security overview</li>
<li><a href="./DLP_SECURITY.html">DLP Security</a> — Data loss prevention</li>
<li><a href="./SIEM.html">SIEM Integration</a> — SIEM integration</li>
<li><a href="../api/REST_API.html">REST API Reference</a> — API reference</li>
</ul>
<hr />
<p><em>Version: 1.0 | December 2025</em></p>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="SECURITY_BRIEF.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Previous</span>
        <span class="doc-page-nav-title">Enterprise Security Brief</span>
      </a>

      <a href="DLP_SECURITY.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Next</span>
        <span class="doc-page-nav-title">DLP: Data Loss Prevention</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Last updated: 2025-12-27</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/enterprise/RBAC.md" target="_blank" rel="noopener">Edit on GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">On this page</div>
      <ul class="doc-toc-list">
        <li><a href="#rbac-and-authorization" class="level-1">RBAC and Authorization</a></li>
<li><a href="#table-of-contents" class="level-2">Table of Contents</a></li>
<li><a href="#overview" class="level-2">Overview</a></li>
<li><a href="#key-capabilities" class="level-3">Key Capabilities</a></li>
<li><a href="#rbac-architecture" class="level-2">RBAC Architecture</a></li>
<li><a href="#role-hierarchy" class="level-3">Role Hierarchy</a></li>
<li><a href="#permission-inheritance" class="level-3">Permission Inheritance</a></li>
<li><a href="#permission-catalog" class="level-2">Permission Catalog</a></li>
<li><a href="#permissions-by-category" class="level-3">Permissions by Category</a></li>
<li><a href="#authentication-methods" class="level-2">Authentication Methods</a></li>
<li><a href="#1-jwt-bearer-token" class="level-3">1. JWT Bearer Token</a></li>
<li><a href="#get-token" class="level-1">Get token</a></li>
<li><a href="#response" class="level-1">Response:</a></li>
<li><a href="#use-token" class="level-1">Use token</a></li>
<li><a href="#logout-add-token-to-blacklist" class="level-1">Logout - add token to blacklist</a></li>
<li><a href="#2-api-keys" class="level-3">2. API Keys</a></li>
<li><a href="#create-api-key" class="level-1">Create API key</a></li>
<li><a href="#response" class="level-1">Response:</a></li>
<li><a href="#use-api-key" class="level-1">Use API key</a></li>
<li><a href="#3-oauth2oidc-integration-ready" class="level-3">3. OAuth2/OIDC (Integration-Ready)</a></li>
<li><a href="#4-ldapactive-directory-integration-ready" class="level-3">4. LDAP/Active Directory (Integration-Ready)</a></li>
<li><a href="#api-reference" class="level-2">API Reference</a></li>
<li><a href="#middleware-dependencies" class="level-3">Middleware Dependencies</a></li>
<li><a href="#fastapi-usage-examples" class="level-3">FastAPI Usage Examples</a></li>
<li><a href="#require-specific-permission" class="level-1">Require specific permission</a></li>
<li><a href="#require-one-of-multiple-permissions" class="level-1">Require one of multiple permissions</a></li>
<li><a href="#require-admin-role" class="level-1">Require Admin role</a></li>
<li><a href="#authcontext" class="level-3">AuthContext</a></li>
<li><a href="#auditing-and-logging" class="level-2">Auditing and Logging</a></li>
<li><a href="#authorization-events" class="level-3">Authorization Events</a></li>
<li><a href="#log-format" class="level-3">Log Format</a></li>
<li><a href="#best-practices" class="level-2">Best Practices</a></li>
<li><a href="#for-administrators" class="level-3">For Administrators</a></li>
<li><a href="#for-developers" class="level-3">For Developers</a></li>
<li><a href="#related-documents" class="level-2">Related Documents</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI copilot for source code analysis</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Product</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Features</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Integrations</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Documentation</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Getting Started</a></li>
              <li><a href="../guides/index.html" class="footer-link">Guides</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Resources</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Contacts</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
