<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: Документация по REST API CodeGraph">
  <meta name="keywords" content="CodeGraph, documentation, api">

  <meta property="og:title" content="Документация по REST API CodeGraph - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: Документация по REST API CodeGraph">
  <meta property="og:type" content="article">

  <title>Документация по REST API CodeGraph - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="nav-link active">Документация</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/api/REST_API.html" class="">EN</a>
          <a href="../../ru/api/REST_API.html" class="active">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Переключить тему">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Запросить демо</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Документация</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Запросить демо</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Начало работы</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../getting-started/index.html">Обзор</a></li>
        <li><a href="../getting-started/CONFIGURATION.html">Руководство по настройке</a></li>
        <li><a href="../getting-started/INSTALLATION.html">Руководство по установке</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Руководства</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Обзор</a></li>
        <li><a href="../guides/BENCHMARK_GUIDE.html">Руководство по тестовой платформе</a></li>
        <li><a href="../guides/CLI_GUIDE.html">Руководство по CLI</a></li>
        <li><a href="../guides/CODE_REVIEW.html">Система автоматического код-ревью на основе патчей</a></li>
        <li><a href="../guides/CPG_EXPORT.html">Руководство по экспорту CPG</a></li>
        <li><a href="../guides/MONITORING.html">Руководство по мониторингу</a></li>
        <li><a href="../guides/PROGRAMMATIC_GUIDE.html">Руководство пользователя</a></li>
        <li><a href="../guides/PROJECT_IMPORT.html">Импорт новой кодовой базы</a></li>
        <li><a href="../guides/QUICK_REFERENCE.html">Краткое руководство по CodeGraph</a></li>
        <li><a href="../guides/REFACTORING.html">Руководство по анализу рефакторинга</a></li>
        <li><a href="../guides/SCENARIOS.html">Руководство по сценариям рабочих процессов</a></li>
        <li><a href="../guides/TROUBLESHOOTING.html">Руководство по устранению неполадок</a></li>
        <li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя CodeGraph</a></li>
        <li><a href="../guides/01-onboarding.html">Сценарий 01: Ввод нового разработчика</a></li>
        <li><a href="../guides/02-security-audit.html">Сценарий 02: Аудит безопасности</a></li>
        <li><a href="../guides/03-documentation.html">Сценарий 03: Генерация документации</a></li>
        <li><a href="../guides/04-feature-development.html">Сценарий 04: Разработка функций</a></li>
        <li><a href="../guides/05-refactoring.html">Сценарий 05: Рефакторинг</a></li>
        <li><a href="../guides/06-performance.html">Сценарий 06: Анализ производительности</a></li>
        <li><a href="../guides/07-test-coverage.html">Сценарий 07: Покрытие тестами</a></li>
        <li><a href="../guides/08-compliance.html">Сценарий 08: Проверка соответствия требованиям</a></li>
        <li><a href="../guides/09-code-review.html">Сценарий 09: Код-ревью</a></li>
        <li><a href="../guides/10-cross-repo.html">Сценарий 10: Анализ между репозиториями</a></li>
        <li><a href="../guides/11-architecture.html">Сценарий 11: Анализ архитектуры</a></li>
        <li><a href="../guides/12-tech-debt.html">Сценарий 12: Оценка технического долга</a></li>
        <li><a href="../guides/13-mass-refactoring.html">Сценарий 13: Массовая рефакторизация</a></li>
        <li><a href="../guides/14-incident-response.html">Сценарий 14: Реагирование на инциденты безопасности</a></li>
        <li><a href="../guides/15-debugging.html">Сценарий 15: Помощь в отладке</a></li>
        <li><a href="../guides/16-entry-points.html">Сценарий 16: Обнаружение точки входа</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Документация</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Обзор</a></li>
        <li><a href="REST_API.html" class="active">Документация по REST API CodeGraph</a></li>
        <li><a href="WEBSOCKET_API.html">Справочная документация по WebSocket API</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Интеграции</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../integrations/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Справочник</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../reference/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../enterprise/index.html">Обзор</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Документация</a>
        <span>/</span>
        <a href="index.html">API Документация</a>
        <span>/</span>
        <span>Документация по REST API CodeGraph</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>Документация по REST API CodeGraph</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="dokumentatsiya-po-rest-api-codegraph">Документация по REST API CodeGraph<a class="heading-anchor" href="#dokumentatsiya-po-rest-api-codegraph" title="Link to this section">&para;</a></h1>
<p>Полная документация по серверу REST API CodeGraph.</p>
<h2 id="soderzhanie">Содержание<a class="heading-anchor" href="#soderzhanie" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="#overview">Обзор</a></li>
<li><a href="#quick-start">Быстрый старт</a></li>
<li><a href="#1-install-dependencies">1. Установка зависимостей</a></li>
<li><a href="#2-configure-environment">2. Настройка окружения</a></li>
<li><a href="#3-initialize-database">3. Инициализация базы данных</a></li>
<li><a href="#4-create-admin-user">4. Создание администратора</a></li>
<li><a href="#5-start-server">5. Запуск сервера</a></li>
<li><a href="#environment-variables">Переменные окружения</a></li>
<li><a href="#required">Обязательные</a></li>
<li><a href="#server-settings">Настройки сервера</a></li>
<li><a href="#authentication">Аутентификация</a></li>
<li><a href="#oauth2-providers">Провайдеры OAuth2</a></li>
<li><a href="#ldapactive-directory">LDAP/Active Directory</a></li>
<li><a href="#rate-limiting">Ограничение частоты запросов</a></li>
<li><a href="#demo-endpoint">Демо-эндпоинт</a></li>
<li><a href="#authentication">Аутентификация</a></li>
<li><a href="#jwt-token-authentication">Аутентификация по JWT-токену</a></li>
<li><a href="#api-key-authentication">Аутентификация по API-ключу</a></li>
<li><a href="#oauth2-authentication">Аутентификация через OAuth2</a></li>
<li><a href="#ldap-authentication">Аутентификация через LDAP</a></li>
<li><a href="#api-endpoints">API-эндпоинты</a></li>
<li><a href="#demo-public---no-auth-required">Демо (публичный — без аутентификации)</a></li>
<li><a href="#chat">Чат</a></li>
<li><a href="#scenarios">Сценарии</a></li>
<li><a href="#available-scenarios-16-total">Доступные сценарии (всего 16)</a></li>
<li><a href="#code-review">Рецензирование кода</a></li>
<li><a href="#sessions">Сессии</a></li>
<li><a href="#history">История</a></li>
<li><a href="#query-sql">Запрос (SQL)</a></li>
<li><a href="#project-import">Импорт проекта</a></li>
<li><a href="#websocket-endpoints">WebSocket-эндпоинты</a></li>
<li><a href="#wschat">/ws/chat</a></li>
<li><a href="#wsjobsjob_id">/ws/jobs/{job_id}</a></li>
<li><a href="#wsnotifications">/ws/notifications</a></li>
<li><a href="#rate-limiting">Ограничение частоты запросов</a></li>
<li><a href="#default-limits">Стандартные лимиты</a></li>
<li><a href="#endpoint-specific-limits">Лимиты для конкретных эндпоинтов</a></li>
<li><a href="#rate-limit-headers">Заголовки ограничения частоты</a></li>
<li><a href="#using-redis-for-rate-limiting">Использование Redis для ограничения частоты</a></li>
<li><a href="#rbac-roles">Роли RBAC</a></li>
<li><a href="#database-setup">Настройка базы данных</a></li>
<li><a href="#postgresql-connection">Подключение к PostgreSQL</a></li>
<li><a href="#alembic-migrations">Миграции Alembic</a></li>
<li><a href="#database-schema">Схема базы данных</a></li>
<li><a href="#cli-commands">Команды CLI</a></li>
<li><a href="#example-usage-curl">Примеры использования (curl)</a></li>
<li><a href="#demo-endpoint-no-auth">Демо-эндпоинт (без аутентификации)</a></li>
<li><a href="#login">Вход в систему</a></li>
<li><a href="#chat-with-jwt">Чат с JWT</a></li>
<li><a href="#list-scenarios">Просмотр списка сценариев</a></li>
<li><a href="#create-api-key">Создание API-ключа</a></li>
<li><a href="#use-api-key">Использование API-ключа</a></li>
<li><a href="#review-patch">Рецензирование патча</a></li>
<li><a href="#error-responses">Формат ошибок</a></li>
<li><a href="#common-http-status-codes">Распространённые HTTP-статусы</a></li>
<li><a href="#related-documentation">Сопутствующая документация</a></li>
</ul>
<h2 id="overview">Обзор<a class="heading-anchor" href="#overview" title="Link to this section">&para;</a></h2>
<ul>
<li><strong>Фреймворк:</strong> FastAPI</li>
<li><strong>Базовый URL:</strong> <code>http://localhost:8000/api/v1</code></li>
<li><strong>Документация OpenAPI:</strong> <code>/docs</code> (Swagger UI), <code>/redoc</code> (ReDoc)</li>
<li><strong>Аутентификация:</strong> JWT-токены, API-ключи, OAuth2, LDAP</li>
</ul>
<hr />
<h2 id="quick-start">Быстрый старт<a class="heading-anchor" href="#quick-start" title="Link to this section">&para;</a></h2>
<h3 id="1-install-dependencies">1. Установка зависимостей<a class="heading-anchor" href="#1-install-dependencies" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>pip install -r requirements.txt
</code></pre></div>

<h3 id="2-configure-environment">2. Настройка окружения<a class="heading-anchor" href="#2-configure-environment" title="Link to this section">&para;</a></h3>
<p>Создайте файл <code>.env</code> (см. <a href="#environment-variables">Переменные окружения</a>):</p>
<div class="highlight"><pre><span></span><code>cp .env.example .env
# Отредактируйте .env под свои настройки {#edit-env-with-your-settings}
</code></pre></div>

<h3 id="3-initialize-database">3. Инициализация базы данных<a class="heading-anchor" href="#3-initialize-database" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code># Создание таблиц {#create-tables}
python -m src.api.cli init-db

# Выполнение миграций {#run-migrations}
python -m src.api.cli migrate
</code></pre></div>

<h3 id="4-create-admin-user">4. Создание администратора<a class="heading-anchor" href="#4-create-admin-user" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>python -m src.api.cli create-admin --username admin --password ваш-надёжный-пароль
</code></pre></div>

<h3 id="5-start-server">5. Запуск сервера<a class="heading-anchor" href="#5-start-server" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>python -m src.api.cli run --host 0.0.0.0 --port 8000
</code></pre></div>

<hr />
<h2 id="environment-variables">Переменные окружения<a class="heading-anchor" href="#environment-variables" title="Link to this section">&para;</a></h2>
<h3 id="required">Обязательные<a class="heading-anchor" href="#required" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATABASE_URL</td>
<td>Строка подключения к PostgreSQL</td>
<td>postgresql+asyncpg://postgres:postgres@localhost:5432/codegraph</td>
</tr>
<tr>
<td>API_JWT_SECRET</td>
<td>Секрет для подписи JWT (не менее 64 символов)</td>
<td>change-me-in-production&hellip;</td>
</tr>
</tbody>
</table></div>
<h3 id="server-settings">Настройки сервера<a class="heading-anchor" href="#server-settings" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td>API_HOST</td>
<td>Адрес, на котором запускается сервер</td>
<td>0.0.0.0</td>
</tr>
<tr>
<td>API_PORT</td>
<td>Порт сервера</td>
<td>8000</td>
</tr>
<tr>
<td>API_WORKERS</td>
<td>Количество воркеров</td>
<td>4</td>
</tr>
<tr>
<td>API_DEBUG</td>
<td>Режим отладки</td>
<td>false</td>
</tr>
</tbody>
</table></div>
<h3 id="authentication">Аутентификация<a class="heading-anchor" href="#authentication" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td>API_JWT_ALGORITHM</td>
<td>Алгоритм JWT</td>
<td>HS256</td>
</tr>
<tr>
<td>API_ADMIN_USERNAME</td>
<td>Имя администратора по умолчанию</td>
<td>admin</td>
</tr>
<tr>
<td>API_ADMIN_PASSWORD</td>
<td>Пароль администратора по умолчанию</td>
<td>admin</td>
</tr>
</tbody>
</table></div>
<h3 id="oauth2-providers">Провайдеры OAuth2<a class="heading-anchor" href="#oauth2-providers" title="Link to this section">&para;</a></h3>
<h4 id="github">GitHub<a class="heading-anchor" href="#github" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>OAUTH_GITHUB_CLIENT_ID</td>
<td>Идентификатор клиента приложения GitHub OAuth</td>
</tr>
<tr>
<td>OAUTH_GITHUB_CLIENT_SECRET</td>
<td>Секрет клиента приложения GitHub OAuth</td>
</tr>
</tbody>
</table></div>
<h4 id="google">Google<a class="heading-anchor" href="#google" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>OAUTH_GOOGLE_CLIENT_ID</td>
<td>Идентификатор клиента Google OAuth</td>
</tr>
<tr>
<td>OAUTH_GOOGLE_CLIENT_SECRET</td>
<td>Секрет клиента Google OAuth</td>
</tr>
</tbody>
</table></div>
<h4 id="keycloak">Keycloak<a class="heading-anchor" href="#keycloak" title="Link to this section">&para;</a></h4>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>OAUTH_KEYCLOAK_SERVER_URL</td>
<td>URL сервера Keycloak</td>
</tr>
<tr>
<td>OAUTH_KEYCLOAK_REALM</td>
<td>Realm в Keycloak</td>
</tr>
<tr>
<td>OAUTH_KEYCLOAK_CLIENT_ID</td>
<td>Идентификатор клиента Keycloak</td>
</tr>
<tr>
<td>OAUTH_KEYCLOAK_CLIENT_SECRET</td>
<td>Секрет клиента Keycloak</td>
</tr>
</tbody>
</table></div>
<h3 id="ldapactive-directory">LDAP/Active Directory<a class="heading-anchor" href="#ldapactive-directory" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>LDAP_SERVER</td>
<td>Имя хоста LDAP-сервера</td>
</tr>
<tr>
<td>LDAP_BASE_DN</td>
<td>Базовый DN для поиска</td>
</tr>
<tr>
<td>LDAP_BIND_USER</td>
<td>DN пользователя для привязки (bind)</td>
</tr>
<tr>
<td>LDAP_BIND_PASSWORD</td>
<td>Пароль пользователя для привязки</td>
</tr>
<tr>
<td>LDAP_USER_SEARCH_BASE</td>
<td>База поиска пользователей</td>
</tr>
<tr>
<td>LDAP_GROUP_SEARCH_BASE</td>
<td>База поиска групп</td>
</tr>
</tbody>
</table></div>
<h3 id="rate-limiting">Ограничение частоты запросов<a class="heading-anchor" href="#rate-limiting" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td>RATE_LIMIT_STORAGE</td>
<td>Бэкенд хранилища (memoryилиredis://&hellip;)</td>
<td>memory</td>
</tr>
</tbody>
</table></div>
<h3 id="demo-endpoint">Демо-эндпоинт<a class="heading-anchor" href="#demo-endpoint" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Описание</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEMO_ENABLED</td>
<td>Включить демо-эндпоинт</td>
<td>true</td>
</tr>
<tr>
<td>DEMO_RATE_LIMIT</td>
<td>Ограничение частоты для демо</td>
<td>30/minute</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="autentifikatsiya">Аутентификация<a class="heading-anchor" href="#autentifikatsiya" title="Link to this section">&para;</a></h2>
<h3 id="jwt-token-authentication">Аутентификация по JWT-токену<a class="heading-anchor" href="#jwt-token-authentication" title="Link to this section">&para;</a></h3>
<h4 id="vhod-poluchenie-tokena">Вход (получение токена)<a class="heading-anchor" href="#vhod-poluchenie-tokena" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>POST /api/v1/auth/token
Content-Type: application/json

{
  &quot;username&quot;: &quot;admin&quot;,
  &quot;password&quot;: &quot;ваш-пароль&quot;
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eyJhbGciOiJIUzI1NiIs...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eyJhbGciOiJIUzI1NiIs...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bearer&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1800</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="obnovlenie-tokena">Обновление токена<a class="heading-anchor" href="#obnovlenie-tokena" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>POST /api/v1/auth/refresh
Content-Type: application/json

{
  &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIs...&quot;
}
</code></pre></div>

<h4 id="ispolzovanie-jwt-v-zaprosah">Использование JWT в запросах<a class="heading-anchor" href="#ispolzovanie-jwt-v-zaprosah" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">Authorization</span><span class="o">:</span><span class="w"> </span><span class="n">Bearer</span><span class="w"> </span><span class="o">&lt;</span><span class="n">access_token</span><span class="o">&gt;</span>
</code></pre></div>

<h3 id="api-key-authentication">Аутентификация по API-ключу<a class="heading-anchor" href="#api-key-authentication" title="Link to this section">&para;</a></h3>
<h4 id="create-api-key">Создание API-ключа<a class="heading-anchor" href="#create-api-key" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>POST /api/v1/auth/api-keys
Authorization: Bearer &lt;token&gt;
Content-Type: application/json

{
  &quot;name&quot;: &quot;my-integration&quot;,
  &quot;expires_days&quot;: 365,
  &quot;scopes&quot;: [&quot;scenarios:read&quot;, &quot;query:execute&quot;]
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;id&quot;: &quot;key_abc123&quot;,
  &quot;name&quot;: &quot;my-integration&quot;,
  &quot;key&quot;: &quot;rak_xxxxxxxxxxxxxxxxxxxx&quot;,
  &quot;prefix&quot;: &quot;rak_xxxx&quot;,
  &quot;scopes&quot;: [&quot;scenarios:read&quot;, &quot;query:execute&quot;],
  &quot;expires_at&quot;: &quot;2025-12-09T00:00:00Z&quot;,
  &quot;created_at&quot;: &quot;2024-12-09T00:00:00Z&quot;
}
</code></pre></div>

<h4 id="use-api-key">Использование API-ключа в запросах<a class="heading-anchor" href="#use-api-key" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>X-API-Key: rak_xxxxxxxxxxxxxxxxxxxx
</code></pre></div>

<h4 id="spisok-api-klyuchey">Список API-ключей<a class="heading-anchor" href="#spisok-api-klyuchey" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>GET /api/v1/auth/api-keys
Authorization: Bearer &lt;token&gt;
</code></pre></div>

<h4 id="udalenie-api-klyucha">Удаление API-ключа<a class="heading-anchor" href="#udalenie-api-klyucha" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>DELETE /api/v1/auth/api-keys/{key_id}
Authorization: Bearer &lt;token&gt;
</code></pre></div>

<h3 id="oauth2-authentication">Аутентификация через OAuth2<a class="heading-anchor" href="#oauth2-authentication" title="Link to this section">&para;</a></h3>
<h4 id="zapusk-oauth-protsessa">Запуск OAuth-процесса<a class="heading-anchor" href="#zapusk-oauth-protsessa" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>GET /api/v1/auth/oauth/{provider}/authorize
</code></pre></div>

<p>Поддерживаемые провайдеры: <code>github</code>, <code>google</code>, <code>gitlab</code>, <code>keycloak</code></p>
<h4 id="obratnyy-vyzov-oauth">Обратный вызов OAuth<a class="heading-anchor" href="#obratnyy-vyzov-oauth" title="Link to this section">&para;</a></h4>
<div class="highlight"><pre><span></span><code>GET /api/v1/auth/oauth/{provider}/callback?code=xxx&amp;state=xxx
</code></pre></div>

<h3 id="ldap-authentication">Аутентификация через LDAP<a class="heading-anchor" href="#ldap-authentication" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>POST /api/v1/auth/ldap
Content-Type: application/json

{
  &quot;username&quot;: &quot;jdoe&quot;,
  &quot;password&quot;: &quot;ldap-пароль&quot;
}
</code></pre></div>

<h2 id="api-endpoints">Конечные точки API<a class="heading-anchor" href="#api-endpoints" title="Link to this section">&para;</a></h2>
<h3 id="demo-public---no-auth-required">Демо (Публичный - Без аутентификации)<a class="heading-anchor" href="#demo-public---no-auth-required" title="Link to this section">&para;</a></h3>
<h4 id="post-apiv1demochat">POST /api/v1/demo/chat<a class="heading-anchor" href="#post-apiv1demochat" title="Link to this section">&para;</a></h4>
<p>Публичная демо-конечная точка для интеграции с целевой страницей. Ограничение по количеству запросов на IP-адрес.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;query&quot;: &quot;Как работает MVCC?&quot;,
  &quot;language&quot;: &quot;ru&quot;
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;answer&quot;: &quot;MVCC (Multi-Version Concurrency Control)...&quot;,
  &quot;scenario_id&quot;: &quot;onboarding&quot;,
  &quot;processing_time_ms&quot;: 1523.45
}
</code></pre></div>

<p><strong>Ограничение по частоте:</strong> 30 запросов в минуту с одного IP</p>
<h4 id="get-apiv1demostatus">GET /api/v1/demo/status<a class="heading-anchor" href="#get-apiv1demostatus" title="Link to this section">&para;</a></h4>
<p>Проверка статуса демо-конечной точки.</p>
<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;enabled&quot;: true,
  &quot;rate_limit&quot;: &quot;30/minute&quot;,
  &quot;max_query_length&quot;: 500,
  &quot;allowed_scenarios&quot;: [&quot;onboarding&quot;]
}
</code></pre></div>

<hr />
<h3 id="chat">Чат<a class="heading-anchor" href="#chat" title="Link to this section">&para;</a></h3>
<h4 id="post-apiv1chat">POST /api/v1/chat<a class="heading-anchor" href="#post-apiv1chat" title="Link to this section">&para;</a></h4>
<p>Отправка запроса в систему CodeGraph.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;query&quot;: &quot;Найти уязвимости к SQL-инъекциям&quot;,
  &quot;session_id&quot;: &quot;необязательный-id-сессии&quot;,
  &quot;scenario_id&quot;: &quot;security&quot;,
  &quot;language&quot;: &quot;en&quot;
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;answer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Найдено 3 потенциальные уязвимости к SQL-инъекциям...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;scenario_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;security&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;confidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.85</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;evidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;code&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;src/executor.c:123&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sprintf(query, \&quot;SELECT * FROM %s\&quot;, user_input);&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s">&quot;relevance&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.95</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sess_abc123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;req_xyz789&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;processing_time_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2341.5</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="post-apiv1chatstream">POST /api/v1/chat/stream<a class="heading-anchor" href="#post-apiv1chatstream" title="Link to this section">&para;</a></h4>
<p>Отправка запроса и получение потокового ответа через Server-Sent Events (SSE).</p>
<p><strong>Запрос:</strong> То же, что и <code>/chat</code></p>
<p><strong>Ответ:</strong> Поток SSE</p>
<div class="highlight"><pre><span></span><code><span class="nx">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sess_abc123&quot;</span><span class="p">}</span>

<span class="nx">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Найдено 3 потенциальные &quot;</span><span class="p">}</span>

<span class="nx">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;уязвимости к SQL-инъекциям...&quot;</span><span class="p">}</span>

<span class="nx">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scenario_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;security&quot;</span><span class="p">}</span>
</code></pre></div>

<hr />
<h3 id="scenarios">Сценарии<a class="heading-anchor" href="#scenarios" title="Link to this section">&para;</a></h3>
<h4 id="get-apiv1scenarios">GET /api/v1/scenarios<a class="heading-anchor" href="#get-apiv1scenarios" title="Link to this section">&para;</a></h4>
<p>Список всех 16 доступных сценариев анализа.</p>
<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;onboarding&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Onboarding&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Начало работы с кодовой базой — поиск функций, построение графов вызовов&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Learning&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;find&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;where&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;what&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;how&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;explain&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="s">&quot;example_queries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Где находится функция main()?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Что делает exec_simple_query?&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;security&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security Audit&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Поиск уязвимостей — SQL-инъекции, переполнения буфера&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;vulnerability&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;injection&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unsafe&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="s">&quot;example_queries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Найти уязвимости к SQL-инъекциям&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// ... ещё 14 сценариев</span>
<span class="p">]</span>
</code></pre></div>

<h4 id="get-apiv1scenariosscenario-id">GET /api/v1/scenarios/{scenario_id}<a class="heading-anchor" href="#get-apiv1scenariosscenario-id" title="Link to this section">&para;</a></h4>
<p>Получение информации о конкретном сценарии.</p>
<h4 id="post-apiv1scenariosscenario-idquery">POST /api/v1/scenarios/{scenario_id}/query<a class="heading-anchor" href="#post-apiv1scenariosscenario-idquery" title="Link to this section">&para;</a></h4>
<p>Отправка запроса к конкретному сценарию.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;query&quot;: &quot;Найти уязвимости к переполнению буфера&quot;,
  &quot;session_id&quot;: &quot;необязательный-id-сессии&quot;,
  &quot;language&quot;: &quot;en&quot;
}
</code></pre></div>

<hr />
<h3 id="available-scenarios-16-total">Доступные сценарии (всего 16)<a class="heading-anchor" href="#available-scenarios-16-total" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ID</th>
<th>Название</th>
<th>Категория</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>onboarding</td>
<td>Onboarding</td>
<td>Learning</td>
<td>Начало работы с кодовой базой</td>
</tr>
<tr>
<td>security</td>
<td>Security Audit</td>
<td>Security</td>
<td>Поиск уязвимостей</td>
</tr>
<tr>
<td>documentation</td>
<td>Documentation</td>
<td>Documentation</td>
<td>Генерация документации</td>
</tr>
<tr>
<td>feature_dev</td>
<td>Feature Development</td>
<td>Development</td>
<td>Поиск точек интеграции</td>
</tr>
<tr>
<td>refactoring</td>
<td>Refactoring</td>
<td>Quality</td>
<td>Выявление код-смэллов</td>
</tr>
<tr>
<td>performance</td>
<td>Performance Analysis</td>
<td>Performance</td>
<td>Поиск узких мест</td>
</tr>
<tr>
<td>test_coverage</td>
<td>Test Coverage</td>
<td>Testing</td>
<td>Анализ покрытия тестами</td>
</tr>
<tr>
<td>compliance</td>
<td>Compliance Check</td>
<td>Quality</td>
<td>Проверка стандартов кодирования</td>
</tr>
<tr>
<td>code_review</td>
<td>Code Review</td>
<td>Review</td>
<td>Автоматический код-ревью</td>
</tr>
<tr>
<td>cross_repo</td>
<td>Cross-Repository</td>
<td>Architecture</td>
<td>Анализ зависимостей</td>
</tr>
<tr>
<td>architecture</td>
<td>Architecture Violations</td>
<td>Architecture</td>
<td>Обнаружение нарушений</td>
</tr>
<tr>
<td>tech_debt</td>
<td>Technical Debt</td>
<td>Quality</td>
<td>Оценка технического долга</td>
</tr>
<tr>
<td>mass_refactoring</td>
<td>Mass Refactoring</td>
<td>Development</td>
<td>Масштабные изменения</td>
</tr>
<tr>
<td>security_incident</td>
<td>Security Incident</td>
<td>Security</td>
<td>Реагирование на инциденты</td>
</tr>
<tr>
<td>debugging</td>
<td>Debugging Support</td>
<td>Development</td>
<td>Поиск точек логирования</td>
</tr>
<tr>
<td>entry_points</td>
<td>Entry Points</td>
<td>Security</td>
<td>Поиск поверхности атаки</td>
</tr>
</tbody>
</table></div>
<hr />
<h3 id="code-review">Код-ревью<a class="heading-anchor" href="#code-review" title="Link to this section">&para;</a></h3>
<h4 id="post-apiv1reviewpatch">POST /api/v1/review/patch<a class="heading-anchor" href="#post-apiv1reviewpatch" title="Link to this section">&para;</a></h4>
<p>Ревью git-патча/диффа.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;patch_content&quot;: &quot;diff --git a/src/file.c b/src/file.c\n...&quot;,
  &quot;task_description&quot;: &quot;Исправить утечку памяти в обработчике транзакций&quot;,
  &quot;dod_items&quot;: [&quot;Нет утечек памяти&quot;, &quot;Проходят модульные тесты&quot;],
  &quot;output_format&quot;: &quot;json&quot;
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;recommendation&quot;: &quot;REQUEST_CHANGES&quot;,
  &quot;confidence&quot;: 0.82,
  &quot;findings&quot;: [
    {
      &quot;category&quot;: &quot;error&quot;,
      &quot;severity&quot;: &quot;high&quot;,
      &quot;location&quot;: {&quot;file&quot;: &quot;src/file.c&quot;, &quot;line_start&quot;: 45},
      &quot;message&quot;: &quot;Потенциальная утечка памяти: выделенная память не освобождается на пути ошибки&quot;,
      &quot;suggested_fix&quot;: &quot;Добавить free(ptr) перед оператором return&quot;
    }
  ],
  &quot;dod_status&quot;: [
    {&quot;description&quot;: &quot;Нет утечек памяти&quot;, &quot;satisfied&quot;: false, &quot;evidence&quot;: &quot;Найдена 1 потенциальная утечка&quot;}
  ],
  &quot;summary&quot;: &quot;Найдена 1 проблема высокой серьёзности, которую необходимо устранить.&quot;
}
</code></pre></div>

<h4 id="post-apiv1reviewgithub-pr">POST /api/v1/review/github-pr<a class="heading-anchor" href="#post-apiv1reviewgithub-pr" title="Link to this section">&para;</a></h4>
<p>Ревью Pull Request в GitHub.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;owner&quot;: &quot;postgres&quot;,
  &quot;repo&quot;: &quot;postgres&quot;,
  &quot;pr_number&quot;: 123,
  &quot;github_token&quot;: &quot;ghp_xxx&quot;
}
</code></pre></div>

<h4 id="post-apiv1reviewgitlab-mr">POST /api/v1/review/gitlab-mr<a class="heading-anchor" href="#post-apiv1reviewgitlab-mr" title="Link to this section">&para;</a></h4>
<p>Ревью Merge Request в GitLab.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;project_id&quot;: &quot;123&quot;,
  &quot;mr_iid&quot;: 456,
  &quot;gitlab_token&quot;: &quot;glpat-xxx&quot;,
  &quot;gitlab_url&quot;: &quot;https://gitlab.com&quot;
}
</code></pre></div>

<hr />
<h3 id="sessions">Сессии<a class="heading-anchor" href="#sessions" title="Link to this section">&para;</a></h3>
<h4 id="get-apiv1sessions">GET /api/v1/sessions<a class="heading-anchor" href="#get-apiv1sessions" title="Link to this section">&para;</a></h4>
<p>Список сессий пользователя.</p>
<h4 id="post-apiv1sessions">POST /api/v1/sessions<a class="heading-anchor" href="#post-apiv1sessions" title="Link to this section">&para;</a></h4>
<p>Создание новой сессии.</p>
<h4 id="get-apiv1sessionssession-id">GET /api/v1/sessions/{session_id}<a class="heading-anchor" href="#get-apiv1sessionssession-id" title="Link to this section">&para;</a></h4>
<p>Получение деталей сессии.</p>
<h4 id="delete-apiv1sessionssession-id">DELETE /api/v1/sessions/{session_id}<a class="heading-anchor" href="#delete-apiv1sessionssession-id" title="Link to this section">&para;</a></h4>
<p>Удаление сессии.</p>
<hr />
<h3 id="history">История<a class="heading-anchor" href="#history" title="Link to this section">&para;</a></h3>
<h4 id="get-apiv1history">GET /api/v1/history<a class="heading-anchor" href="#get-apiv1history" title="Link to this section">&para;</a></h4>
<p>Получение истории диалогов.</p>
<p><strong>Параметры запроса:</strong>
- <code>session_id</code> — фильтрация по сессии
- <code>limit</code> — количество элементов (по умолчанию: 50)
- <code>offset</code> — смещение для пагинации</p>
<h4 id="get-apiv1historymessage-id">GET /api/v1/history/{message_id}<a class="heading-anchor" href="#get-apiv1historymessage-id" title="Link to this section">&para;</a></h4>
<p>Получение конкретного сообщения.</p>
<h4 id="get-apiv1historyexport">GET /api/v1/history/export<a class="heading-anchor" href="#get-apiv1historyexport" title="Link to this section">&para;</a></h4>
<p>Экспорт истории диалогов.</p>
<p><strong>Параметры запроса:</strong>
- <code>format</code> — формат экспорта (<code>json</code>, <code>csv</code>, <code>markdown</code>)
- <code>session_id</code> — фильтрация по сессии</p>
<hr />
<h3 id="query-sql">Запрос (SQL)<a class="heading-anchor" href="#query-sql" title="Link to this section">&para;</a></h3>
<h4 id="post-apiv1queryexecute">POST /api/v1/query/execute<a class="heading-anchor" href="#post-apiv1queryexecute" title="Link to this section">&para;</a></h4>
<p>Выполнение SQL-запроса напрямую к базе данных CPG.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;query&quot;: &quot;SELECT name, file FROM nodes_method WHERE name LIKE &#39;%transaction%&#39; LIMIT 10&quot;,
  &quot;timeout_ms&quot;: 30000
}
</code></pre></div>

<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;results&quot;: [
    {&quot;name&quot;: &quot;StartTransaction&quot;, &quot;file&quot;: &quot;xact.c&quot;},
    {&quot;name&quot;: &quot;CommitTransaction&quot;, &quot;file&quot;: &quot;xact.c&quot;}
  ],
  &quot;row_count&quot;: 2,
  &quot;execution_time_ms&quot;: 45.2
}
</code></pre></div>

<hr />
<h3 id="project-import">Импорт проекта<a class="heading-anchor" href="#project-import" title="Link to this section">&para;</a></h3>
<p>Импорт новых кодовых баз в систему CodeGraph.</p>
<blockquote class="callout">
<p><strong>Подробная документация:</strong> см. <a href="../guides/PROJECT_IMPORT.html">Руководство по импорту проектов</a> для примеров использования.</p>
</blockquote>
<h4 id="get-apiv1importlanguages">GET /api/v1/import/languages<a class="heading-anchor" href="#get-apiv1importlanguages" title="Link to this section">&para;</a></h4>
<p>Получение списка поддерживаемых языков программирования.</p>
<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;languages&quot;: [
    {
      &quot;id&quot;: &quot;c&quot;,
      &quot;name&quot;: &quot;C&quot;,
      &quot;extensions&quot;: [&quot;.c&quot;, &quot;.h&quot;, &quot;.cpp&quot;, &quot;.hpp&quot;],
      &quot;joern_command&quot;: &quot;c2cpg&quot;,
      &quot;joern_flag&quot;: &quot;C&quot;
    },
    {
      &quot;id&quot;: &quot;java&quot;,
      &quot;name&quot;: &quot;JAVA&quot;,
      &quot;extensions&quot;: [&quot;.java&quot;],
      &quot;joern_command&quot;: &quot;javasrc2cpg&quot;,
      &quot;joern_flag&quot;: &quot;JAVASRC&quot;
    }
  ]
}
</code></pre></div>

<p><strong>Поддерживаемые языки (10):</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ID</th>
<th>Название</th>
<th>Команда Joern</th>
<th>Расширения</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>C/C++</td>
<td>c2cpg</td>
<td>.c,.h,.cpp,.hpp,.cc,.cxx</td>
</tr>
<tr>
<td>csharp</td>
<td>C#</td>
<td>csharp2cpg</td>
<td>.cs</td>
</tr>
<tr>
<td>go</td>
<td>Go</td>
<td>gosrc2cpg</td>
<td>.go</td>
</tr>
<tr>
<td>java</td>
<td>Java</td>
<td>javasrc2cpg</td>
<td>.java</td>
</tr>
<tr>
<td>javascript</td>
<td>JavaScript/TypeScript</td>
<td>jssrc2cpg</td>
<td>.js,.jsx,.ts,.tsx,.mjs</td>
</tr>
<tr>
<td>kotlin</td>
<td>Kotlin</td>
<td>kotlin2cpg</td>
<td>.kt,.kts</td>
</tr>
<tr>
<td>php</td>
<td>PHP</td>
<td>php2cpg</td>
<td>.php</td>
</tr>
<tr>
<td>python</td>
<td>Python</td>
<td>pysrc2cpg</td>
<td>.py,.pyw</td>
</tr>
<tr>
<td>ruby</td>
<td>Ruby</td>
<td>rubysrc2cpg</td>
<td>.rb</td>
</tr>
<tr>
<td>swift</td>
<td>Swift</td>
<td>swiftsrc2cpg</td>
<td>.swift</td>
</tr>
</tbody>
</table></div>
<h4 id="post-apiv1importstart">POST /api/v1/import/start<a class="heading-anchor" href="#post-apiv1importstart" title="Link to this section">&para;</a></h4>
<p>Запуск асинхронного импорта новой кодовой базы.</p>
<p><strong>Запрос:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;repo_url&quot;: &quot;https://github.com/llvm/llvm-project&quot;,
  &quot;branch&quot;: &quot;main&quot;,
  &quot;shallow_clone&quot;: true,
  &quot;language&quot;: null,
  &quot;mode&quot;: &quot;full&quot;,
  &quot;include_paths&quot;: [&quot;llvm/lib&quot;, &quot;llvm/include&quot;],
  &quot;exclude_paths&quot;: [&quot;test&quot;, &quot;tests&quot;],
  &quot;create_domain_plugin&quot;: true,
  &quot;import_docs&quot;: true,
  &quot;joern_memory_gb&quot;: 16,
  &quot;batch_size&quot;: 10000
}
</code></pre></div>

<p><strong>Параметры запроса:</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Параметр</th>
<th>Тип</th>
<th>По умолчанию</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>repo_url</td>
<td>строка</td>
<td>-</td>
<td>URL Git-репозитория (обязателен, если нетlocal_path)</td>
</tr>
<tr>
<td>local_path</td>
<td>строка</td>
<td>-</td>
<td>Локальный путь (обязателен, если нетrepo_url)</td>
</tr>
<tr>
<td>branch</td>
<td>строка</td>
<td>&ldquo;main&rdquo;</td>
<td>Ветка Git для клонирования</td>
</tr>
<tr>
<td>shallow_clone</td>
<td>boolean</td>
<td>true</td>
<td>Использовать неглубокое клонирование</td>
</tr>
<tr>
<td>shallow_depth</td>
<td>int</td>
<td>1</td>
<td>Глубина неглубокого клонирования</td>
</tr>
<tr>
<td>language</td>
<td>строка</td>
<td>null</td>
<td>ID языка (автоопределение, если null)</td>
</tr>
<tr>
<td>mode</td>
<td>строка</td>
<td>&ldquo;full&rdquo;</td>
<td>Режим импорта:full,selective,incremental</td>
</tr>
<tr>
<td>include_paths</td>
<td>список</td>
<td>[]</td>
<td>Включаемые пути</td>
</tr>
<tr>
<td>exclude_paths</td>
<td>список</td>
<td>[]</td>
<td>Исключаемые пути</td>
</tr>
<tr>
<td>create_domain_plugin</td>
<td>boolean</td>
<td>true</td>
<td>Генерировать Domain Plugin</td>
</tr>
<tr>
<td>domain_name</td>
<td>строка</td>
<td>null</td>
<td>Пользовательское имя домена</td>
</tr>
<tr>
<td>import_docs</td>
<td>boolean</td>
<td>true</td>
<td>Импортировать документацию</td>
</tr>
<tr>
<td>import_readme</td>
<td>boolean</td>
<td>true</td>
<td>Индексировать файлы README</td>
</tr>
<tr>
<td>import_comments</td>
<td>boolean</td>
<td>true</td>
<td>Импортировать комментарии в коде</td>
</tr>
<tr>
<td>joern_memory_gb</td>
<td>int</td>
<td>16</td>
<td>Память для Joern (ГБ)</td>
</tr>
<tr>
<td>batch_size</td>
<td>int</td>
<td>10000</td>
<td>Размер пакета для DuckDB</td>
</tr>
</tbody>
</table></div>
<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;job_id&quot;: &quot;550e8400-e29b-41d4-a716-446655440000&quot;,
  &quot;status&quot;: &quot;pending&quot;,
  &quot;message&quot;: &quot;Импорт запущен. Используйте job_id для отслеживания прогресса.&quot;
}
</code></pre></div>

<h4 id="get-apiv1importstatusjob-id">GET /api/v1/import/status/{job_id}<a class="heading-anchor" href="#get-apiv1importstatusjob-id" title="Link to this section">&para;</a></h4>
<p>Получение текущего статуса задачи импорта.</p>
<p><strong>Ответ:</strong></p>
<div class="highlight"><pre><span></span><code>{
  &quot;job_id&quot;: &quot;550e8400-e29b-41d4-a716-446655440000&quot;,
  &quot;project_name&quot;: &quot;llvm-project&quot;,
  &quot;status&quot;: &quot;in_progress&quot;,
  &quot;steps&quot;: [
    {&quot;name&quot;: &quot;Clone Repository&quot;, &quot;status&quot;: &quot;completed&quot;, &quot;progress&quot;: 100},
    {&quot;name&quot;: &quot;Detect Language&quot;, &quot;status&quot;: &quot;completed&quot;, &quot;progress&quot;: 100},
    {&quot;name&quot;: &quot;Create CPG&quot;, &quot;status&quot;: &quot;in_progress&quot;, &quot;progress&quot;: 45, &quot;message&quot;: &quot;Создание узлов CPG...&quot;},
    {&quot;name&quot;: &quot;Export to DuckDB&quot;, &quot;status&quot;: &quot;pending&quot;, &quot;progress&quot;: 0},
    {&quot;name&quot;: &quot;Validate CPG&quot;, &quot;status&quot;: &quot;pending&quot;, &quot;progress&quot;: 0},
    {&quot;name&quot;: &quot;Import Documentation&quot;, &quot;status&quot;: &quot;pending&quot;, &quot;progress&quot;: 0},
    {&quot;name&quot;: &quot;Setup Domain Plugin&quot;, &quot;status&quot;: &quot;pending&quot;, &quot;progress&quot;: 0}
  ],
  &quot;current_step&quot;: &quot;joern_import&quot;,
  &quot;overall_progress&quot;: 35,
  &quot;created_at&quot;: &quot;2024-12-09T10:00:00Z&quot;,
  &quot;updated_at&quot;: &quot;2024-12-09T10:05:00Z&quot;
}
</code></pre></div>

<p><strong>Статусы импорта:</strong>
- <code>pending</code> — Ожидание запуска
- <code>in_progress</code> — Выполняется
- <code>completed</code> — Успешно завершено
- <code>failed</code> — Произошла ошибка
- <code>cancelled</code> — Отменено пользователем</p>
<h4 id="get-apiv1importjobs">GET /api/v1/import/jobs<a class="heading-anchor" href="#get-apiv1importjobs" title="Link to this section">&para;</a></h4>
<p>Список всех задач импорта.</p>
<p><strong>Параметры запроса:</strong>
- <code>status_filter</code> — фильтрация по статусу (например, <code>in_progress</code>, <code>completed</code>)
- <code>limit</code> — максимальное количество задач (по умолчанию: 20)</p>
<p><strong>Ответ:</strong> М</p>
<h2 id="websocket-endpoints">Конечные точки WebSocket<a class="heading-anchor" href="#websocket-endpoints" title="Link to this section">&para;</a></h2>
<h3 id="wschat">/ws/chat<a class="heading-anchor" href="#wschat" title="Link to this section">&para;</a></h3>
<p>Соединение для чата в реальном времени.</p>
<p><strong>Подключение:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://localhost:8000/ws/chat?token=&lt;jwt_token&gt;&#39;</span><span class="p">);</span>

<span class="n">ws</span><span class="o">.</span><span class="n">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Получено:&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span>
<span class="w">  </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Найти уязвимости к SQL-инъекциям&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n">scenario_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;security&#39;</span>
<span class="p">}));</span>
</code></pre></div>

<h3 id="wsjobsjob_id">/ws/jobs/{job_id}<a class="heading-anchor" href="#wsjobsjob_id" title="Link to this section">&para;</a></h3>
<p>Мониторинг хода выполнения фоновой задачи.</p>
<h3 id="wsnotifications">/ws/notifications<a class="heading-anchor" href="#wsnotifications" title="Link to this section">&para;</a></h3>
<p>Получение уведомлений в реальном времени.</p>
<hr />
<h2 id="ogranichenie-chastoty-zaprosov">Ограничение частоты запросов<a class="heading-anchor" href="#ogranichenie-chastoty-zaprosov" title="Link to this section">&para;</a></h2>
<h3 id="ogranicheniya-po-umolchaniyu">Ограничения по умолчанию<a class="heading-anchor" href="#ogranicheniya-po-umolchaniyu" title="Link to this section">&para;</a></h3>
<ul>
<li><strong>Глобальные:</strong> 100 запросов/минуту, 1000 запросов/час</li>
</ul>
<h3 id="ogranicheniya-dlya-konkretnyh-konechnyh-tochek">Ограничения для конкретных конечных точек<a class="heading-anchor" href="#ogranicheniya-dlya-konkretnyh-konechnyh-tochek" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Конечная точка</th>
<th>Ограничение</th>
</tr>
</thead>
<tbody>
<tr>
<td>/api/v1/review/*</td>
<td>10/минуту</td>
</tr>
<tr>
<td>/api/v1/chat</td>
<td>60/минуту</td>
</tr>
<tr>
<td>/api/v1/chat/stream</td>
<td>30/минуту</td>
</tr>
<tr>
<td>/api/v1/query/execute</td>
<td>30/минуту</td>
</tr>
<tr>
<td>/api/v1/demo/chat</td>
<td>30/минуту на один IP</td>
</tr>
</tbody>
</table></div>
<h3 id="rate-limit-headers">Заголовки ограничения частоты<a class="heading-anchor" href="#rate-limit-headers" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>X-RateLimit-Limit: 60
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1702123456
</code></pre></div>

<h3 id="using-redis-for-rate-limiting">Использование Redis для ограничения частоты запросов<a class="heading-anchor" href="#using-redis-for-rate-limiting" title="Link to this section">&para;</a></h3>
<p>Для продакшена с несколькими экземплярами используйте Redis:</p>
<div class="highlight"><pre><span></span><code>RATE_LIMIT_STORAGE=redis://localhost:6379
</code></pre></div>

<hr />
<h2 id="rbac-roles">Роли RBAC<a class="heading-anchor" href="#rbac-roles" title="Link to this section">&para;</a></h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Роль</th>
<th>Разрешения</th>
</tr>
</thead>
<tbody>
<tr>
<td>viewer</td>
<td>Просмотр сценариев, просмотр истории</td>
</tr>
<tr>
<td>analyst</td>
<td>Все разрешения viewer + выполнение запросов, создание сессий</td>
</tr>
<tr>
<td>reviewer</td>
<td>Все разрешения analyst + проверка кода, проверка патчей</td>
</tr>
<tr>
<td>admin</td>
<td>Полный доступ, включая управление пользователями</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="database-setup">Настройка базы данных<a class="heading-anchor" href="#database-setup" title="Link to this section">&para;</a></h2>
<h3 id="postgresql-connection">Подключение PostgreSQL<a class="heading-anchor" href="#postgresql-connection" title="Link to this section">&para;</a></h3>
<p>Требуется PostgreSQL 12+ с поддержкой асинхронных операций.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Создание базы данных {#create-database}</span>
<span class="n">createdb</span><span class="w"> </span><span class="n">codegraph</span>

<span class="c1"># Установка строки подключения {#set-connection-string}</span>
<span class="k">export</span><span class="w"> </span><span class="n">DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;postgresql+asyncpg://postgres:password@localhost:5432/codegraph&quot;</span>
</code></pre></div>

<h3 id="alembic-migrations">Миграции Alembic<a class="heading-anchor" href="#alembic-migrations" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code># Применить все миграции {#apply-all-migrations}
python -m src.api.cli migrate

# Перейти к определённой ревизии {#migrate-to-specific-revision}
python -m src.api.cli migrate --revision abc123
</code></pre></div>

<h3 id="database-schema">Схема базы данных<a class="heading-anchor" href="#database-schema" title="Link to this section">&para;</a></h3>
<p>Основные таблицы:
- <code>users</code> — учетные записи пользователей
- <code>api_keys</code> — хранение API-ключей
- <code>sessions</code> — сессии чата
- <code>messages</code> — история сообщений
- <code>jobs</code> — статус фоновых задач</p>
<hr />
<h2 id="cli-commands">Команды CLI<a class="heading-anchor" href="#cli-commands" title="Link to this section">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Запустить сервер API {#run-api-server}</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">host</span><span class="w"> </span><span class="n">HOST</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="n">PORT</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">workers</span><span class="w"> </span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">reload</span><span class="p">]</span>

<span class="c1"># Инициализировать базу данных {#initialize-database}</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">init</span><span class="o">-</span><span class="n">db</span>

<span class="c1"># Выполнить миграции {#run-migrations}</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">migrate</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">revision</span><span class="w"> </span><span class="n">REV</span><span class="p">]</span>

<span class="c1"># Создать учётную запись администратора {#create-admin-user}</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">create</span><span class="o">-</span><span class="n">admin</span><span class="w"> </span><span class="o">--</span><span class="n">username</span><span class="w"> </span><span class="n">USER</span><span class="w"> </span><span class="o">--</span><span class="n">password</span><span class="w"> </span><span class="n">PASS</span><span class="w"> </span><span class="p">[</span><span class="o">--</span><span class="n">email</span><span class="w"> </span><span class="n">EMAIL</span><span class="p">]</span>
</code></pre></div>

<h2 id="example-usage-curl">Пример использования (curl)<a class="heading-anchor" href="#example-usage-curl" title="Link to this section">&para;</a></h2>
<h3 id="demo-endpoint-no-auth">Демо-эндпоинт (без аутентификации)<a class="heading-anchor" href="#demo-endpoint-no-auth" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl -X POST http://localhost:8000/api/v1/demo/chat \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;query&quot;: &quot;Как работает MVCC?&quot;, &quot;language&quot;: &quot;ru&quot;}&#39;
</code></pre></div>

<h3 id="login">Вход в систему<a class="heading-anchor" href="#login" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl -X POST http://localhost:8000/api/v1/auth/token \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;secret&quot;}&#39;
</code></pre></div>

<h3 id="chat-with-jwt">Чат с использованием JWT<a class="heading-anchor" href="#chat-with-jwt" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">TOKEN</span><span class="o">=</span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIs...&quot;</span>

<span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">chat</span><span class="w"> </span>\
<span class="w">  </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s2">&quot;Authorization: Bearer $TOKEN&quot;</span><span class="w"> </span>\
<span class="w">  </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>\
<span class="w">  </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="s1">&#39;{&quot;query&quot;: &quot;Find SQL injection vulnerabilities&quot;, &quot;scenario_id&quot;: &quot;security&quot;}&#39;</span>
</code></pre></div>

<h3 id="spisok-stsenariev">Список сценариев<a class="heading-anchor" href="#spisok-stsenariev" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl http://localhost:8000/api/v1/scenarios \
  -H &quot;Authorization: Bearer $TOKEN&quot;
</code></pre></div>

<h3 id="sozdanie-api-klyucha">Создание API-ключа<a class="heading-anchor" href="#sozdanie-api-klyucha" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl -X POST http://localhost:8000/api/v1/auth/api-keys \
  -H &quot;Authorization: Bearer $TOKEN&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;name&quot;: &quot;my-integration&quot;, &quot;expires_days&quot;: 365}&#39;
</code></pre></div>

<h3 id="ispolzovanie-api-klyucha">Использование API-ключа<a class="heading-anchor" href="#ispolzovanie-api-klyucha" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl http://localhost:8000/api/v1/scenarios \
  -H &quot;X-API-Key: rak_xxxxxxxxxxxxxxxxxxxx&quot;
</code></pre></div>

<h3 id="proverka-patcha">Проверка патча<a class="heading-anchor" href="#proverka-patcha" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl -X POST http://localhost:8000/api/v1/review/patch \
  -H &quot;Authorization: Bearer $TOKEN&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{
    &quot;patch_content&quot;: &quot;diff --git a/src/file.c ...&quot;,
    &quot;task_description&quot;: &quot;Fix memory leak&quot;,
    &quot;output_format&quot;: &quot;json&quot;
  }&#39;
</code></pre></div>

<h2 id="otvety-s-oshibkami">Ответы с ошибками<a class="heading-anchor" href="#otvety-s-oshibkami" title="Link to this section">&para;</a></h2>
<p>Все ошибки возвращают JSON следующей структуры:</p>
<div class="highlight"><pre><span></span><code>{
  &quot;detail&quot;: &quot;Текст ошибки здесь&quot;,
  &quot;error_code&quot;: &quot;VALIDATION_ERROR&quot;,
  &quot;request_id&quot;: &quot;req_abc123&quot;
}
</code></pre></div>

<h3 id="obschie-kody-sostoyaniya-http">Общие коды состояния HTTP<a class="heading-anchor" href="#obschie-kody-sostoyaniya-http" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Код</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Неверный запрос — некорректные входные данные</td>
</tr>
<tr>
<td>401</td>
<td>Неавторизованный доступ — отсутствует или неверна аутентификация</td>
</tr>
<tr>
<td>403</td>
<td>Доступ запрещён — недостаточно прав</td>
</tr>
<tr>
<td>404</td>
<td>Не найдено</td>
</tr>
<tr>
<td>429</td>
<td>Слишком много запросов — превышен лимит запросов</td>
</tr>
<tr>
<td>500</td>
<td>Ошибка внутреннего сервера</td>
</tr>
<tr>
<td>503</td>
<td>Сервис недоступен</td>
</tr>
</tbody>
</table></div>
<hr />
<h2 id="svyazannaya-dokumentatsiya">Связанная документация<a class="heading-anchor" href="#svyazannaya-dokumentatsiya" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя TUI</a></li>
<li><a href="../guides/SCENARIOS.html">Руководство по сценариям</a></li>
<li><a href="../guides/PROJECT_IMPORT.html">Руководство по импорту проекта</a></li>
<li><a href="../reference/API.html">Справочник API (внутренний)</a></li>
<li><a href="../guides/TROUBLESHOOTING.html">Устранение неполадок</a></li>
</ul>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="index.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Назад</span>
        <span class="doc-page-nav-title">Обзор</span>
      </a>

      <a href="WEBSOCKET_API.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Вперед</span>
        <span class="doc-page-nav-title">Справочная документация по WebSocket API</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Обновлено: 2025-12-25</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/api/REST_API.md" target="_blank" rel="noopener">Редактировать на GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">На этой странице</div>
      <ul class="doc-toc-list">
        <li><a href="#dokumentatsiya-po-rest-api-codegraph" class="level-1">Документация по REST API CodeGraph</a></li>
<li><a href="#soderzhanie" class="level-2">Содержание</a></li>
<li><a href="#obzor" class="level-2">Обзор</a></li>
<li><a href="#bystryy-start" class="level-2">Быстрый старт</a></li>
<li><a href="#1-ustanovka-zavisimostey" class="level-3">1. Установка зависимостей</a></li>
<li><a href="#2-nastroyka-okruzheniya" class="level-3">2. Настройка окружения</a></li>
<li><a href="#otredaktiruyte-env-pod-svoi-nastroyki" class="level-1">Отредактируйте .env под свои настройки</a></li>
<li><a href="#3-initsializatsiya-bazy-dannyh" class="level-3">3. Инициализация базы данных</a></li>
<li><a href="#sozdanie-tablits" class="level-1">Создание таблиц</a></li>
<li><a href="#vypolnenie-migratsiy" class="level-1">Выполнение миграций</a></li>
<li><a href="#4-sozdanie-administratora" class="level-3">4. Создание администратора</a></li>
<li><a href="#5-zapusk-servera" class="level-3">5. Запуск сервера</a></li>
<li><a href="#peremennye-okruzheniya" class="level-2">Переменные окружения</a></li>
<li><a href="#obyazatelnye" class="level-3">Обязательные</a></li>
<li><a href="#nastroyki-servera" class="level-3">Настройки сервера</a></li>
<li><a href="#autentifikatsiya" class="level-3">Аутентификация</a></li>
<li><a href="#provaydery-oauth2" class="level-3">Провайдеры OAuth2</a></li>
<li><a href="#ldapactive-directory" class="level-3">LDAP/Active Directory</a></li>
<li><a href="#ogranichenie-chastoty-zaprosov" class="level-3">Ограничение частоты запросов</a></li>
<li><a href="#demo-endpoint" class="level-3">Демо-эндпоинт</a></li>
<li><a href="#autentifikatsiya" class="level-2">Аутентификация</a></li>
<li><a href="#autentifikatsiya-po-jwt-tokenu" class="level-3">Аутентификация по JWT-токену</a></li>
<li><a href="#autentifikatsiya-po-api-klyuchu" class="level-3">Аутентификация по API-ключу</a></li>
<li><a href="#autentifikatsiya-cherez-oauth2" class="level-3">Аутентификация через OAuth2</a></li>
<li><a href="#autentifikatsiya-cherez-ldap" class="level-3">Аутентификация через LDAP</a></li>
<li><a href="#konechnye-tochki-api" class="level-2">Конечные точки API</a></li>
<li><a href="#demo-publichnyy-bez-autentifikatsii" class="level-3">Демо (Публичный - Без аутентификации)</a></li>
<li><a href="#chat" class="level-3">Чат</a></li>
<li><a href="#stsenarii" class="level-3">Сценарии</a></li>
<li><a href="#dostupnye-stsenarii-vsego-16" class="level-3">Доступные сценарии (всего 16)</a></li>
<li><a href="#kod-revyu" class="level-3">Код-ревью</a></li>
<li><a href="#sessii" class="level-3">Сессии</a></li>
<li><a href="#istoriya" class="level-3">История</a></li>
<li><a href="#zapros-sql" class="level-3">Запрос (SQL)</a></li>
<li><a href="#import-proekta" class="level-3">Импорт проекта</a></li>
<li><a href="#konechnye-tochki-websocket" class="level-2">Конечные точки WebSocket</a></li>
<li><a href="#wschat" class="level-3">/ws/chat</a></li>
<li><a href="#wsjobs" class="level-3">/ws/jobs/</a></li>
<li><a href="#wsnotifications" class="level-3">/ws/notifications</a></li>
<li><a href="#ogranichenie-chastoty-zaprosov" class="level-2">Ограничение частоты запросов</a></li>
<li><a href="#ogranicheniya-po-umolchaniyu" class="level-3">Ограничения по умолчанию</a></li>
<li><a href="#ogranicheniya-dlya-konkretnyh-konechnyh-tochek" class="level-3">Ограничения для конкретных конечных точек</a></li>
<li><a href="#zagolovki-ogranicheniya-chastoty" class="level-3">Заголовки ограничения частоты</a></li>
<li><a href="#ispolzovanie-redis-dlya-ogranicheniya-chastoty-zaprosov" class="level-3">Использование Redis для ограничения частоты запросов</a></li>
<li><a href="#roli-rbac" class="level-2">Роли RBAC</a></li>
<li><a href="#nastroyka-bazy-dannyh" class="level-2">Настройка базы данных</a></li>
<li><a href="#podklyuchenie-postgresql" class="level-3">Подключение PostgreSQL</a></li>
<li><a href="#sozdanie-bazy-dannyh" class="level-1">Создание базы данных</a></li>
<li><a href="#ustanovka-stroki-podklyucheniya" class="level-1">Установка строки подключения</a></li>
<li><a href="#migratsii-alembic" class="level-3">Миграции Alembic</a></li>
<li><a href="#primenit-vse-migratsii" class="level-1">Применить все миграции</a></li>
<li><a href="#pereyti-k-opredelyonnoy-revizii" class="level-1">Перейти к определённой ревизии</a></li>
<li><a href="#shema-bazy-dannyh" class="level-3">Схема базы данных</a></li>
<li><a href="#komandy-cli" class="level-2">Команды CLI</a></li>
<li><a href="#zapustit-server-api" class="level-1">Запустить сервер API</a></li>
<li><a href="#initsializirovat-bazu-dannyh" class="level-1">Инициализировать базу данных</a></li>
<li><a href="#vypolnit-migratsii" class="level-1">Выполнить миграции</a></li>
<li><a href="#sozdat-uchyotnuyu-zapis-administratora" class="level-1">Создать учётную запись администратора</a></li>
<li><a href="#primer-ispolzovaniya-curl" class="level-2">Пример использования (curl)</a></li>
<li><a href="#demo-endpoint-bez-autentifikatsii" class="level-3">Демо-эндпоинт (без аутентификации)</a></li>
<li><a href="#vhod-v-sistemu" class="level-3">Вход в систему</a></li>
<li><a href="#chat-s-ispolzovaniem-jwt" class="level-3">Чат с использованием JWT</a></li>
<li><a href="#spisok-stsenariev" class="level-3">Список сценариев</a></li>
<li><a href="#sozdanie-api-klyucha" class="level-3">Создание API-ключа</a></li>
<li><a href="#ispolzovanie-api-klyucha" class="level-3">Использование API-ключа</a></li>
<li><a href="#proverka-patcha" class="level-3">Проверка патча</a></li>
<li><a href="#otvety-s-oshibkami" class="level-2">Ответы с ошибками</a></li>
<li><a href="#obschie-kody-sostoyaniya-http" class="level-3">Общие коды состояния HTTP</a></li>
<li><a href="#svyazannaya-dokumentatsiya" class="level-2">Связанная документация</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI-копилот для анализа исходного кода</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Продукт</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Возможности</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Интеграции</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Документация</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Начало работы</a></li>
              <li><a href="../guides/index.html" class="footer-link">Руководства</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Ресурсы</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Контакты</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
