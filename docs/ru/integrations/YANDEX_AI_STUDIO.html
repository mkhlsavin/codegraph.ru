<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: Руководство по интеграции Yandex AI Studio">
  <meta name="keywords" content="CodeGraph, documentation, integrations">

  <meta property="og:title" content="Руководство по интеграции Yandex AI Studio - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: Руководство по интеграции Yandex AI Studio">
  <meta property="og:type" content="article">

  <title>Руководство по интеграции Yandex AI Studio - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="nav-link active">Документация</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/integrations/YANDEX_AI_STUDIO.html" class="">EN</a>
          <a href="../../ru/integrations/YANDEX_AI_STUDIO.html" class="active">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Переключить тему">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Запросить демо</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Документация</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Запросить демо</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Начало работы</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../getting-started/index.html">Обзор</a></li>
        <li><a href="../getting-started/CONFIGURATION.html">Руководство по настройке</a></li>
        <li><a href="../getting-started/INSTALLATION.html">Руководство по установке</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Руководства</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Обзор</a></li>
        <li><a href="../guides/BENCHMARK_GUIDE.html">Руководство по тестовой платформе</a></li>
        <li><a href="../guides/CLI_GUIDE.html">Руководство по CLI</a></li>
        <li><a href="../guides/CODE_REVIEW.html">Автоматический код-ревью</a></li>
        <li><a href="../guides/CPG_EXPORT.html">Руководство по экспорту CPG</a></li>
        <li><a href="../guides/MONITORING.html">Руководство по мониторингу</a></li>
        <li><a href="../guides/PROGRAMMATIC_GUIDE.html">Руководство пользователя</a></li>
        <li><a href="../guides/PROJECT_IMPORT.html">Импорт новой кодовой базы</a></li>
        <li><a href="../guides/QUICK_REFERENCE.html">Краткое руководство по CodeGraph</a></li>
        <li><a href="../guides/REFACTORING.html">Руководство по анализу рефакторинга</a></li>
        <li><a href="../guides/SCENARIOS.html">Руководство по сценариям рабочих процессов</a></li>
        <li><a href="../guides/TROUBLESHOOTING.html">Руководство по устранению неполадок</a></li>
        <li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя CodeGraph</a></li>
        <li><a href="../guides/01-onboarding.html">Сценарий 01: Ввод нового разработчика</a></li>
        <li><a href="../guides/02-security-audit.html">Сценарий 02: Аудит безопасности</a></li>
        <li><a href="../guides/03-documentation.html">Сценарий 03: Генерация документации</a></li>
        <li><a href="../guides/04-feature-development.html">Сценарий 04: Разработка функций</a></li>
        <li><a href="../guides/05-refactoring.html">Сценарий 05: Рефакторинг</a></li>
        <li><a href="../guides/06-performance.html">Сценарий 06: Анализ производительности</a></li>
        <li><a href="../guides/07-test-coverage.html">Сценарий 07: Покрытие тестами</a></li>
        <li><a href="../guides/08-compliance.html">Сценарий 08: Проверка соответствия требованиям</a></li>
        <li><a href="../guides/09-code-review.html">Сценарий 09: Код-ревью</a></li>
        <li><a href="../guides/10-cross-repo.html">Сценарий 10: Анализ между репозиториями</a></li>
        <li><a href="../guides/11-architecture.html">Сценарий 11: Анализ архитектуры</a></li>
        <li><a href="../guides/12-tech-debt.html">Сценарий 12: Оценка технического долга</a></li>
        <li><a href="../guides/13-mass-refactoring.html">Сценарий 13: Массовая рефакторизация</a></li>
        <li><a href="../guides/14-incident-response.html">Сценарий 14: Реагирование на инциденты безопасности</a></li>
        <li><a href="../guides/15-debugging.html">Сценарий 15: Помощь в отладке</a></li>
        <li><a href="../guides/16-entry-points.html">Сценарий 16: Обнаружение точки входа</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Документация</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../api/index.html">Обзор</a></li>
        <li><a href="../api/REST_API.html">Документация по REST API CodeGraph</a></li>
        <li><a href="../api/WEBSOCKET_API.html">Справочная документация по WebSocket API</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Интеграции</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Обзор</a></li>
        <li><a href="GIGACHAT.html">Руководство по интеграции GigaChat</a></li>
        <li><a href="YANDEX_AI_STUDIO.html" class="active">Руководство по интеграции Yandex AI Studio</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Справочник</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../reference/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../enterprise/index.html">Обзор</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Документация</a>
        <span>/</span>
        <a href="index.html">Интеграции</a>
        <span>/</span>
        <span>Руководство по интеграции Yandex AI Studio</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>Руководство по интеграции Yandex AI Studio</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="rukovodstvo-po-integratsii-yandex-ai-studio">Руководство по интеграции Yandex AI Studio<a class="heading-anchor" href="#rukovodstvo-po-integratsii-yandex-ai-studio" title="Link to this section">&para;</a></h1>
<p>Руководство по интеграции Yandex Cloud AI Studio с CodeGraph с использованием API, совместимого с OpenAI.</p>
<h2 id="soderzhanie">Содержание<a class="heading-anchor" href="#soderzhanie" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="#overview">Обзор</a></li>
<li><a href="#quick-setup-3-steps">Быстрое начало (3 шага)</a></li>
<li><a href="#step-1-create-api-key">Шаг 1: Создание API-ключа</a></li>
<li><a href="#step-2-set-environment-variables">Шаг 2: Настройка переменных окружения</a></li>
<li><a href="#step-3-configure-configyaml">Шаг 3: Настройка config.yaml</a></li>
<li><a href="#available-models">Доступные модели</a></li>
<li><a href="#text-generation-models">Модели генерации текста</a></li>
<li><a href="#embedding-models">Модели эмбеддингов</a></li>
<li><a href="#model-uri-format">Формат URI модели</a></li>
<li><a href="#usage-in-code">Использование в коде</a></li>
<li><a href="#basic-usage">Базовое использование</a></li>
<li><a href="#streaming">Потоковая передача (Streaming)</a></li>
<li><a href="#embeddings">Эмбеддинги</a></li>
<li><a href="#with-codegraph-workflow">Совместно с CodeGraph Workflow</a></li>
<li><a href="#configuration-reference">Справочник по настройке</a></li>
<li><a href="#full-configyaml-example">Пример полного config.yaml</a></li>
<li><a href="#environment-variables">Переменные окружения</a></li>
<li><a href="#provider-parameters">Параметры провайдера</a></li>
<li><a href="#privacy-and-compliance">Конфиденциальность и соответствие требованиям</a></li>
<li><a href="#error-handling">Обработка ошибок</a></li>
<li><a href="#authentication-error-401">Ошибка аутентификации (401)</a></li>
<li><a href="#rate-limit-exceeded-429">Превышение лимита запросов (429)</a></li>
<li><a href="#connection-timeout">Таймаут соединения</a></li>
<li><a href="#folder-id-error">Ошибка идентификатора папки</a></li>
<li><a href="#retry-logic">Логика повторных попыток</a></li>
<li><a href="#best-practices">Рекомендации</a></li>
<li><a href="#comparison-with-other-providers">Сравнение с другими провайдерами</a></li>
<li><a href="#resources">Ресурсы</a></li>
<li><a href="#next-steps">Дальнейшие шаги</a></li>
</ul>
<h2 id="overview">Обзор<a class="heading-anchor" href="#overview" title="Link to this section">&para;</a></h2>
<p>Yandex Cloud AI Studio — это комплексная платформа ИИ, предоставляющая доступ к:
- Моделям семейства <strong>YandexGPT</strong> (YandexGPT, YandexGPT-Lite, YandexGPT-32k)
- <strong>Открытым моделям</strong> (Qwen3, DeepSeek, OpenAI OSS)
- <strong>Моделям эмбеддингов</strong> для семантического поиска</p>
<p>CodeGraph интегрируется с Yandex AI Studio через API, совместимый с OpenAI, что позволяет использовать стандартную библиотеку <code>openai</code> на Python.</p>
<p><strong>Основные возможности:</strong>
- Совместимость с API OpenAI (используйте привычную библиотеку <code>openai</code>)
- Фокус на конфиденциальности: логирование отключено по умолчанию через заголовок <code>x-data-logging-enabled: false</code>
- Разнообразие моделей с параметрами от 20 млрд до 235 млрд
- Встроенная повторная отправка запросов с экспоненциальной задержкой</p>
<h2 id="bystraya-nastroyka-3-shaga">Быстрая настройка (3 шага)<a class="heading-anchor" href="#bystraya-nastroyka-3-shaga" title="Link to this section">&para;</a></h2>
<h3 id="step-1-create-api-key">Шаг 1: Создание API-ключа<a class="heading-anchor" href="#step-1-create-api-key" title="Link to this section">&para;</a></h3>
<ol>
<li>Перейдите в <a href="https://console.yandex.cloud/">консоль Yandex Cloud</a></li>
<li>В левом меню выберите <strong>AI Studio</strong></li>
<li>Нажмите <strong>Создать новый ключ</strong> в верхней панели</li>
<li>Выберите <strong>Создать API-ключ</strong></li>
<li>В поле <strong>Область доступа (Scope)</strong> выберите <code>yc.ai.languageModels.execute</code></li>
<li>Нажмите <strong>Создать</strong> и сохраните идентификатор (ID) и секретный ключ</li>
<li>Запишите ваш <strong>ID папки</strong>, который можно найти в селекторе папок в верхней панели</li>
</ol>
<h3 id="step-2-set-environment-variables">Шаг 2: Установка переменных окружения<a class="heading-anchor" href="#step-2-set-environment-variables" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Windows PowerShell {#windows-powershell}
$env:YANDEX_API_KEY = &quot;AQVNxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
$env:YANDEX_FOLDER_ID = &quot;b1gxxxxxxxxxxxxxxxxx&quot;

<span class="gh">#</span> Постоянная настройка (сохраняется после перезагрузки) {#permanent-survives-restart}
[System.Environment]::SetEnvironmentVariable(&#39;YANDEX_API_KEY&#39;, &#39;AQVNxxx...&#39;, &#39;User&#39;)
[System.Environment]::SetEnvironmentVariable(&#39;YANDEX_FOLDER_ID&#39;, &#39;b1gxxx...&#39;, &#39;User&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Linux/Mac {#linuxmac}</span>
<span class="k">export</span><span class="w"> </span><span class="n">YANDEX_API_KEY</span><span class="o">=</span><span class="s2">&quot;AQVNxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">YANDEX_FOLDER_ID</span><span class="o">=</span><span class="s2">&quot;b1gxxxxxxxxxxxxxxxxx&quot;</span>

<span class="c1"># Добавьте в ~/.bashrc для постоянного эффекта {#add-to-bashrc-for-permanent}</span>
<span class="n">echo</span><span class="w"> </span><span class="s1">&#39;export YANDEX_API_KEY=&quot;your_key&quot;&#39;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">~/.</span><span class="n">bashrc</span>
<span class="n">echo</span><span class="w"> </span><span class="s1">&#39;export YANDEX_FOLDER_ID=&quot;your_folder&quot;&#39;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">~/.</span><span class="n">bashrc</span>
</code></pre></div>

<h3 id="step-3-configure-configyaml">Шаг 3: Настройка config.yaml<a class="heading-anchor" href="#step-3-configure-configyaml" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">llm</span><span class="o">:</span>
<span class="w">  </span><span class="n">provider</span><span class="o">:</span><span class="w"> </span><span class="n">yandex</span>

<span class="w">  </span><span class="n">yandex</span><span class="o">:</span>
<span class="w">    </span><span class="n">api_key</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="o">{</span><span class="n">YANDEX_API_KEY</span><span class="o">}</span>
<span class="w">    </span><span class="n">folder_id</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="o">{</span><span class="n">YANDEX_FOLDER_ID</span><span class="o">}</span>
<span class="w">    </span><span class="n">model</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;qwen3-235b-a22b-fp8/latest&quot;</span>
<span class="w">    </span><span class="n">temperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.7</span>
<span class="w">    </span><span class="n">max_tokens</span><span class="o">:</span><span class="w"> </span><span class="mi">2000</span>
<span class="w">    </span><span class="n">timeout</span><span class="o">:</span><span class="w"> </span><span class="mi">180</span>
</code></pre></div>

<p>Проверка конфигурации:</p>
<div class="highlight"><pre><span></span><code><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.llm.yandex_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">YandexProvider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.llm.base_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">LLMConfig</span><span class="p">(</span><span class="n">provider_type</span><span class="o">=</span><span class="s1">&#39;yandex&#39;</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">YandexProvider</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Поставщик: </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Подключение успешно!&#39;</span><span class="p">)</span>
<span class="s2">&quot;</span>
</code></pre></div>

<h2 id="available-models">Доступные модели<a class="heading-anchor" href="#available-models" title="Link to this section">&para;</a></h2>
<h3 id="text-generation-models">Модели генерации текста<a class="heading-anchor" href="#text-generation-models" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Модель</th>
<th>URI</th>
<th>Контекст</th>
<th>Рекомендуется для</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen3 235B</td>
<td>qwen3-235b-a22b-fp8/latest</td>
<td>262K</td>
<td>Сложный анализ кода, проверка безопасности (по умолчанию)</td>
</tr>
<tr>
<td>gpt-oss-120b</td>
<td>gpt-oss-120b/latest</td>
<td>131K</td>
<td>Модель OpenAI OSS для логических задач, сложные задания</td>
</tr>
<tr>
<td>gpt-oss-20b</td>
<td>gpt-oss-20b/latest</td>
<td>131K</td>
<td>Модель OpenAI OSS, сбалансированная производительность</td>
</tr>
<tr>
<td>Gemma 3 27B</td>
<td>gemma-3-27b-it/latest</td>
<td>131K</td>
<td>Открытая модель Google, оптимизирована под инструкции</td>
</tr>
<tr>
<td>YandexGPT Pro 5</td>
<td>yandexgpt/latest</td>
<td>32K</td>
<td>Универсальное применение, отличная поддержка русского языка</td>
</tr>
<tr>
<td>YandexGPT Pro 5.1</td>
<td>yandexgpt/rc</td>
<td>32K</td>
<td>Новейшие функции, улучшенные логические способности</td>
</tr>
<tr>
<td>YandexGPT Lite 5</td>
<td>yandexgpt-lite</td>
<td>32K</td>
<td>Быстрые ответы, простые запросы</td>
</tr>
<tr>
<td>Alice AI LLM</td>
<td>aliceai-llm</td>
<td>32K</td>
<td>Диалоговые системы, разговорный ИИ</td>
</tr>
<tr>
<td>Тонко настроенная YandexGPT Lite</td>
<td>yandexgpt-lite/latest@<suffix></td>
<td>32K</td>
<td>Пользовательские тонко настроенные модели</td>
</tr>
</tbody>
</table></div>
<p><strong>Рекомендации:</strong>
- <strong>Анализ кода</strong>: Используйте <code>qwen3-235b-a22b-fp8/latest</code> (контекст 262K, наилучшее качество)
- <strong>Проверка безопасности</strong>: Используйте <code>gpt-oss-120b/latest</code> (возможности логического анализа)
- <strong>Быстрые запросы</strong>: Используйте <code>yandexgpt-lite</code> для скорости
- <strong>Русский язык</strong>: Используйте <code>yandexgpt/latest</code> для родной поддержки русского
- <strong>Большие файлы</strong>: Используйте модели с контекстом 131K и выше (Qwen3, gpt-oss, Gemma)</p>
<h3 id="embedding-models">Модели эмбеддингов<a class="heading-anchor" href="#embedding-models" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Модель</th>
<th>Размерность</th>
<th>Применение</th>
</tr>
</thead>
<tbody>
<tr>
<td>text-search-doc/latest</td>
<td>256</td>
<td>Эмбеддинги документов (по умолчанию)</td>
</tr>
<tr>
<td>text-search-query/latest</td>
<td>256</td>
<td>Эмбеддинги запросов</td>
</tr>
</tbody>
</table></div>
<h2 id="model-uri-format">Формат URI модели<a class="heading-anchor" href="#model-uri-format" title="Link to this section">&para;</a></h2>
<p>Yandex требует использования определённого формата URI модели:</p>
<div class="highlight"><pre><span></span><code>gpt://&lt;folder_id&gt;/&lt;model_name&gt;
emb://&lt;folder_id&gt;/&lt;embedding_model&gt;
</code></pre></div>

<p>Примеры:</p>
<div class="highlight"><pre><span></span><code>gpt://b1g123456789/qwen3-235b-a22b-fp8/latest
gpt://b1g123456789/yandexgpt/latest
emb://b1g123456789/text-search-doc/latest
</code></pre></div>

<p>Поставщик CodeGraph автоматически формирует такой URI на основе ваших параметров <code>folder_id</code> и <code>model</code>.</p>
<h2 id="usage-in-code">Использование в коде<a class="heading-anchor" href="#usage-in-code" title="Link to this section">&para;</a></h2>
<h3 id="basic-usage">Базовое использование<a class="heading-anchor" href="#basic-usage" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Инициализация клиента с использованием эндпоинта Yandex {#initialize-client-with-yandex-endpoint}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;YANDEX_API_KEY&quot;</span><span class="p">),</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://llm.api.cloud.yandex.net/v1&quot;</span><span class="p">,</span>
    <span class="n">default_headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;x-data-logging-enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>  <span class="c1"># Приватность</span>
        <span class="s2">&quot;x-folder-id&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;YANDEX_FOLDER_ID&quot;</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Формирование URI модели {#construct-model-uri}</span>
<span class="n">folder_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;YANDEX_FOLDER_ID&quot;</span><span class="p">)</span>
<span class="n">model_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gpt://</span><span class="si">{</span><span class="n">folder_id</span><span class="si">}</span><span class="s2">/qwen3-235b-a22b-fp8/latest&quot;</span>

<span class="c1"># Отправка запроса {#make-request}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Вы — эксперт по анализу кода.&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Объясните, что такое MVCC в PostgreSQL.&quot;</span><span class="p">},</span>
    <span class="p">],</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>

<h3 id="streaming">Потоковая передача<a class="heading-anchor" href="#streaming" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">Потоковая</span><span class="w"> </span><span class="nx">передача</span><span class="w"> </span><span class="nx">ответа</span><span class="w"> </span><span class="p">{</span><span class="err">#</span><span class="nx">stream</span><span class="o">-</span><span class="nx">response</span><span class="p">}</span>
<span class="nx">stream</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">completions</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
<span class="w">    </span><span class="nx">model</span><span class="p">=</span><span class="nx">model_uri</span><span class="p">,</span>
<span class="w">    </span><span class="nx">messages</span><span class="p">=[</span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Перечислите рекомендации по обеспечению безопасности в C-коде.&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nx">stream</span><span class="p">=</span><span class="nx">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span><span class="w"> </span><span class="nx">chunk</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">stream</span><span class="p">:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">chunk</span><span class="p">.</span><span class="nx">choices</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">chunk</span><span class="p">.</span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">delta</span><span class="p">.</span><span class="nx">content</span><span class="p">:</span>
<span class="w">        </span><span class="nx">print</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">delta</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">end</span><span class="p">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">flush</span><span class="p">=</span><span class="nx">True</span><span class="p">)</span>
</code></pre></div>

<h3 id="embeddings">Эмбеддинги<a class="heading-anchor" href="#embeddings" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Получение эмбеддингов {#get-embeddings}
embedding_uri = f&quot;emb://{folder_id}/text-search-doc/latest&quot;

response = client.embeddings.create(
    model=embedding_uri,
    input=&quot;Найти уязвимости переполнения буфера&quot;,
    encoding_format=&quot;float&quot;,
)

embedding = response.data[0].embedding
print(f&quot;Размерность эмбеддинга: {len(embedding)}&quot;)  # 256
</code></pre></div>

<h3 id="ispolzovanie-s-rabochim-protsessom-codegraph">Использование с рабочим процессом CodeGraph<a class="heading-anchor" href="#ispolzovanie-s-rabochim-protsessom-codegraph" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.llm.yandex_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">YandexProvider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.llm.base_provider</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMConfig</span>

<span class="c1"># Инициализация провайдера (считывает данные из config.yaml) {#initialize-provider-reads-from-configyaml}</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">LLMConfig</span><span class="p">(</span>
    <span class="n">provider_type</span><span class="o">=</span><span class="s1">&#39;yandex&#39;</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">max_tokens</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;api_key&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;YANDEX_API_KEY&#39;</span><span class="p">),</span>
        <span class="s1">&#39;folder_id&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;YANDEX_FOLDER_ID&#39;</span><span class="p">),</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;qwen3-235b-a22b-fp8/latest&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">YandexProvider</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Генерация ответа {#generate-response}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="n">system_prompt</span><span class="o">=</span><span class="s2">&quot;Вы — эксперт по безопасности PostgreSQL.&quot;</span><span class="p">,</span>
    <span class="n">user_prompt</span><span class="o">=</span><span class="s2">&quot;Найдите уязвимости SQL-инъекций в модуле исполнителя.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Использовано токенов: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;tokens_used&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Задержка: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;latency_ms&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> мс&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Использование в рабочем процессе:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">src.workflow.orchestration.copilot</span><span class="w"> </span><span class="kn">import</span> <span class="n">Copilot</span>

<span class="c1"># Copilot автоматически использует настроенный провайдер {#copilot-automatically-uses-configured-provider}</span>
<span class="n">copilot</span> <span class="o">=</span> <span class="n">Copilot</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">copilot</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="s2">&quot;Найдите функции выделения памяти в PostgreSQL&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">])</span>
</code></pre></div>

<h2 id="spravochnik-po-konfiguratsii">Справочник по конфигурации<a class="heading-anchor" href="#spravochnik-po-konfiguratsii" title="Link to this section">&para;</a></h2>
<h3 id="full-configyaml-example">Пример полного файла config.yaml<a class="heading-anchor" href="#full-configyaml-example" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>llm:
<span class="w">  </span>#<span class="w"> </span>Установить<span class="w"> </span>Yandex<span class="w"> </span>в<span class="w"> </span>качестве<span class="w"> </span>активного<span class="w"> </span>провайдера
<span class="w">  </span>provider:<span class="w"> </span>yandex

<span class="w">  </span>yandex:
<span class="w">    </span>#<span class="w"> </span>Обязательно:<span class="w"> </span>Аутентификация
<span class="w">    </span>api_key:<span class="w"> </span><span class="cp">${</span><span class="n">YANDEX_API_KEY</span><span class="cp">}</span><span class="w">      </span>#<span class="w"> </span>API-ключ<span class="w"> </span>сервисного<span class="w"> </span>аккаунта
<span class="w">    </span>folder_id:<span class="w"> </span><span class="cp">${</span><span class="n">YANDEX_FOLDER_ID</span><span class="cp">}</span><span class="w">  </span>#<span class="w"> </span>Идентификатор<span class="w"> </span>каталога<span class="w"> </span>Yandex<span class="w"> </span>Cloud

<span class="w">    </span>#<span class="w"> </span>Выбор<span class="w"> </span>модели
<span class="w">    </span>model:<span class="w"> </span>&quot;qwen3-235b-a22b-fp8/latest&quot;<span class="w">  </span>#<span class="w"> </span>Лучше<span class="w"> </span>всего<span class="w"> </span>подходит<span class="w"> </span>для<span class="w"> </span>анализа<span class="w"> </span>кода

<span class="w">    </span>#<span class="w"> </span>Конечная<span class="w"> </span>точка<span class="w"> </span>API<span class="w"> </span>(по<span class="w"> </span>умолчанию,<span class="w"> </span>обычно<span class="w"> </span>не<span class="w"> </span>меняется)
<span class="w">    </span>base_url:<span class="w"> </span>&quot;https://llm.api.cloud.yandex.net/v1&quot;

<span class="w">    </span>#<span class="w"> </span>Таймауты
<span class="w">    </span>timeout:<span class="w"> </span>180<span class="w">  </span>#<span class="w"> </span>секунд<span class="w"> </span>(увеличен<span class="w"> </span>для<span class="w"> </span>больших<span class="w"> </span>запросов)

<span class="w">    </span>#<span class="w"> </span>Параметры<span class="w"> </span>генерации
<span class="w">    </span>temperature:<span class="w"> </span>0.7<span class="w">       </span>#<span class="w"> </span>Уровень<span class="w"> </span>креативности<span class="w"> </span>(0.0–1.0)
<span class="w">    </span>max_tokens:<span class="w"> </span>2000<span class="w">       </span>#<span class="w"> </span>Максимальная<span class="w"> </span>длина<span class="w"> </span>ответа
<span class="w">    </span>top_p:<span class="w"> </span>null<span class="w">            </span>#<span class="w"> </span>Использовать<span class="w"> </span>значение<span class="w"> </span>по<span class="w"> </span>умолчанию<span class="w"> </span>от<span class="w"> </span>Yandex

<span class="w">    </span>#<span class="w"> </span>Модель<span class="w"> </span>эмбеддингов
<span class="w">    </span>embedding_model:<span class="w"> </span>&quot;text-search-doc/latest&quot;
</code></pre></div>

<h3 id="environment-variables">Переменные окружения<a class="heading-anchor" href="#environment-variables" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Переменная</th>
<th>Обязательно</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>YANDEX_API_KEY</td>
<td>Да</td>
<td>API-ключ из консоли Yandex Cloud</td>
</tr>
<tr>
<td>YANDEX_FOLDER_ID</td>
<td>Да</td>
<td>Идентификатор каталога, в котором включён AI Studio</td>
</tr>
</tbody>
</table></div>
<h3 id="provider-parameters">Параметры провайдера<a class="heading-anchor" href="#provider-parameters" title="Link to this section">&para;</a></h3>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Параметр</th>
<th>Тип</th>
<th>По умолчанию</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>api_key</td>
<td>строка</td>
<td>-</td>
<td>API-ключ Yandex Cloud (обязательный)</td>
</tr>
<tr>
<td>folder_id</td>
<td>строка</td>
<td>-</td>
<td>Идентификатор каталога Yandex Cloud (обязательный)</td>
</tr>
<tr>
<td>model</td>
<td>строка</td>
<td>qwen3-235b-a22b-fp8/latest</td>
<td>Модель генерации текста</td>
</tr>
<tr>
<td>base_url</td>
<td>строка</td>
<td>https://llm.api.cloud.yandex.net/v1</td>
<td>Конечная точка API</td>
</tr>
<tr>
<td>timeout</td>
<td>целое</td>
<td>60</td>
<td>Таймаут запроса в секундах</td>
</tr>
<tr>
<td>temperature</td>
<td>число с плавающей точкой</td>
<td>0.7</td>
<td>Степень случайности ответа (0.0–1.0)</td>
</tr>
<tr>
<td>max_tokens</td>
<td>целое</td>
<td>2000</td>
<td>Максимальное количество токенов в ответе</td>
</tr>
<tr>
<td>top_p</td>
<td>число с плавающей точкой</td>
<td>null</td>
<td>Параметр выборки ядра (nucleus sampling)</td>
</tr>
<tr>
<td>embedding_model</td>
<td>строка</td>
<td>text-search-doc/latest</td>
<td>Модель для эмбеддингов</td>
</tr>
</tbody>
</table></div>
<h2 id="privacy-and-compliance">Конфиденциальность и соответствие требованиям<a class="heading-anchor" href="#privacy-and-compliance" title="Link to this section">&para;</a></h2>
<p>CodeGraph автоматически отключает логирование на стороне Яндекса в целях соблюдения требований конфиденциальности и GDPR:</p>
<div class="highlight"><pre><span></span><code>default_headers={
    &quot;x-data-logging-enabled&quot;: &quot;false&quot;,  # Отключает логирование на стороне Яндекса
    &quot;x-folder-id&quot;: folder_id,
}
</code></pre></div>

<p>Это гарантирует:
- Ваши запросы не сохраняются в логах Яндекса
- Данные ответов не хранятся
- Соответствие требованиям защиты данных</p>
<h2 id="error-handling">Обработка ошибок<a class="heading-anchor" href="#error-handling" title="Link to this section">&para;</a></h2>
<h3 id="authentication-error-401">Ошибка аутентификации (401)<a class="heading-anchor" href="#authentication-error-401" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="mi">401</span><span class="w"> </span><span class="n">Unauthorized</span>
</code></pre></div>

<p><strong>Решения:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Проверьте, установлены ли переменные {#check-if-variables-are-set}</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">YANDEX_API_KEY</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">YANDEX_FOLDER_ID</span>

<span class="c1"># Проверьте формат API-ключа (должен начинаться с AQVNw, AQVN_ или аналогичного) {#verify-api-key-format-should-start-with-aqvnw-aqvn-or-similar}</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import os; key = os.getenv(&#39;YANDEX_API_KEY&#39;, &#39;&#39;); print(f&#39;Префикс ключа: </span><span class="si">{key[:5]}</span><span class="s2">...&#39; if key else &#39;НЕ УСТАНОВЛЕН&#39;)&quot;</span>

<span class="c1"># Убедитесь, что область действия API-ключа включает yc.ai.languageModels.execute {#verify-api-key-scope-includes-ycailanguagemodelsexecute}</span>
</code></pre></div>

<h3 id="rate-limit-exceeded-429">Превышено ограничение по частоте запросов (429)<a class="heading-anchor" href="#rate-limit-exceeded-429" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="mi">429</span><span class="w"> </span><span class="n">Too</span><span class="w"> </span><span class="n">Many</span><span class="w"> </span><span class="n">Requests</span>
</code></pre></div>

<p><strong>Решения:</strong></p>
<div class="highlight"><pre><span></span><code>#<span class="w"> </span>Встроенная<span class="w"> </span>повторная<span class="w"> </span>попытка<span class="w"> </span>автоматически<span class="w"> </span>обрабатывает<span class="w"> </span>эту<span class="w"> </span>ситуацию<span class="w"> </span>{#<span class="nv">built</span><span class="o">-</span><span class="nv">in</span><span class="o">-</span><span class="nv">retry</span><span class="o">-</span><span class="nv">handles</span><span class="o">-</span><span class="nv">this</span><span class="o">-</span><span class="nv">automatically</span>}
#<span class="w"> </span>Но<span class="w"> </span>вы<span class="w"> </span>можете<span class="w"> </span>увеличить<span class="w"> </span>таймаут<span class="w"> </span>для<span class="w"> </span>сложных<span class="w"> </span>запросов<span class="w"> </span>{#<span class="nv">but</span><span class="o">-</span><span class="nv">you</span><span class="o">-</span><span class="nv">can</span><span class="o">-</span><span class="nv">increase</span><span class="o">-</span><span class="nb">timeout</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">complex</span><span class="o">-</span><span class="nv">requests</span>}
<span class="nv">yandex</span>:
<span class="w">  </span><span class="nb">timeout</span>:<span class="w"> </span><span class="mi">300</span><span class="w">  </span>#<span class="w"> </span><span class="mi">5</span><span class="w"> </span>минут
</code></pre></div>

<p>Или реализуйте собственную логику повторных попыток:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="n">user_prompt</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">except</span> <span class="n">YandexRateLimitError</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>  <span class="c1"># Экспоненциальная задержка</span>
</code></pre></div>

<h3 id="connection-timeout">Таймаут соединения<a class="heading-anchor" href="#connection-timeout" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">timeout</span>
</code></pre></div>

<p><strong>Решения:</strong></p>
<div class="highlight"><pre><span></span><code>#<span class="w"> </span>Увеличьте<span class="w"> </span>таймаут<span class="w"> </span>для<span class="w"> </span>больших<span class="w"> </span>запросов<span class="w"> </span>или<span class="w"> </span>ответов<span class="w"> </span>{#<span class="nv">increase</span><span class="o">-</span><span class="nb">timeout</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">large</span><span class="o">-</span><span class="nv">promptsresponses</span>}
<span class="nv">yandex</span>:
<span class="w">  </span><span class="nb">timeout</span>:<span class="w"> </span><span class="mi">300</span><span class="w">  </span>#<span class="w"> </span>секунд
</code></pre></div>

<h3 id="oshibka-identifikatora-kataloga">Ошибка идентификатора каталога<a class="heading-anchor" href="#oshibka-identifikatora-kataloga" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Folder</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">denied</span>
</code></pre></div>

<p><strong>Решения:</strong>
1. Убедитесь, что идентификатор каталога указан верно (выпадающий список в верхней панели консоли Yandex Cloud)
2. Убедитесь, что AI Studio включён в этом каталоге
3. Проверьте, что у API-ключа есть доступ к данному каталогу</p>
<h2 id="retry-logic">Логика повторных попыток<a class="heading-anchor" href="#retry-logic" title="Link to this section">&para;</a></h2>
<p>Поставщик Yandex включает встроенную поддержку повторных попыток с экспоненциальной задержкой:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Автоматические повторные попытки для: {#automatic-retry-for}
<span class="gh">#</span> - APITimeoutError (истекло время ожидания) {#apitimeouterror-timeout}
<span class="gh">#</span> - APIConnectionError (проблемы с подключением) {#apiconnectionerror-connection-issues}

<span class="gh">#</span> Параметры повтора: {#retry-parameters}
<span class="gh">#</span> - max_retries: 3 {#max-retries-3}
<span class="gh">#</span> - initial_delay: 2.0 секунды {#initial-delay-20-seconds}
<span class="gh">#</span> - max_delay: 30.0 секунд {#max-delay-300-seconds}
<span class="gh">#</span> - backoff_factor: 2.0 {#backoff-factor-20}
</code></pre></div>

<p>Пример последовательности повторных попыток:
1. Первая попытка не удалась -&gt; ожидание 2 с
2. Вторая попытка не удалась -&gt; ожидание 4 с
3. Третья попытка не удалась -&gt; возникновение исключения</p>
<h2 id="best-practices">Рекомендации<a class="heading-anchor" href="#best-practices" title="Link to this section">&para;</a></h2>
<ol>
<li><strong>Используйте Qwen3-235B для анализа кода</strong> — наилучшее качество для сложных запросов</li>
<li><strong>Используйте YandexGPT-Lite для простых запросов</strong> — более быстрый отклик</li>
<li><strong>Устанавливайте подходящий таймаут</strong> — 180 с для анализа безопасности, 60 с для простых запросов</li>
<li><strong>Контролируйте использование токенов</strong> — в служебных данных ответа указано количество токенов</li>
<li><strong>Используйте потоковую передачу для длинных ответов</strong> — улучшенный пользовательский опыт в интерактивных приложениях</li>
<li><strong>Храните учетные данные в переменных окружения</strong> — никогда не сохраняйте ключи API в git</li>
</ol>
<h2 id="comparison-with-other-providers">Сравнение с другими провайдерами<a class="heading-anchor" href="#comparison-with-other-providers" title="Link to this section">&para;</a></h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Возможность</th>
<th>Yandex AI Studio</th>
<th>GigaChat</th>
<th>OpenAI</th>
</tr>
</thead>
<tbody>
<tr>
<td>Совместимость с API</td>
<td>Совместимо с OpenAI</td>
<td>Собственный SDK</td>
<td>Родной формат</td>
</tr>
<tr>
<td>Лучшая модель</td>
<td>Qwen3 235B</td>
<td>GigaChat-2-Pro</td>
<td>GPT-4</td>
</tr>
<tr>
<td>Заголовок конфиденциальности</td>
<td>Да (x-data-logging-enabled)</td>
<td>Нет</td>
<td>Нет</td>
</tr>
<tr>
<td>Поддержка русского языка</td>
<td>Отличная</td>
<td>Отличная</td>
<td>Хорошая</td>
</tr>
<tr>
<td>Тарифы</td>
<td>Плата за токен</td>
<td>Плата за токен</td>
<td>Плата за токен</td>
</tr>
<tr>
<td>Макс. контекст</td>
<td>262K (Qwen3)</td>
<td>32K</td>
<td>128K (GPT-4)</td>
</tr>
<tr>
<td>Открытые модели</td>
<td>Qwen3, Gemma, gpt-oss</td>
<td>Нет</td>
<td>Нет</td>
</tr>
</tbody>
</table></div>
<h2 id="resources">Ресурсы<a class="heading-anchor" href="#resources" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="https://yandex.cloud/ru/services/ai-studio">Обзор Yandex AI Studio</a></li>
<li><a href="https://yandex.cloud/ru/docs/ai-studio/concepts/openai-compatibility">Документация по совместимости с OpenAI</a></li>
<li><a href="https://yandex.cloud/ru/docs/ai-studio/concepts/generation/">Доступные модели</a></li>
<li><a href="https://github.com/yandex-cloud/yandex-cloud-ml-sdk">Yandex Cloud ML SDK</a></li>
<li><a href="https://yandex.cloud/ru/docs/ai-studio/tutorials/qwen-vsc-integration">Руководство по интеграции с VS Code</a></li>
</ul>
<h2 id="next-steps">Дальнейшие шаги<a class="heading-anchor" href="#next-steps" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="../getting-started/INSTALLATION.html">Установка</a> — Полное руководство по настройке</li>
<li><a href="../getting-started/CONFIGURATION.html">Конфигурация</a> — Все параметры</li>
<li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя TUI</a> — Работа с системой</li>
<li><a href="./GIGACHAT.html">Интеграция GigaChat</a> — Альтернативный провайдер LLM</li>
</ul>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="GIGACHAT.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Назад</span>
        <span class="doc-page-nav-title">Руководство по интеграции GigaChat</span>
      </a>

      <a href="../reference/index.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Вперед</span>
        <span class="doc-page-nav-title">Справочник</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Обновлено: 2025-12-27</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/integrations/YANDEX_AI_STUDIO.md" target="_blank" rel="noopener">Редактировать на GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">На этой странице</div>
      <ul class="doc-toc-list">
        <li><a href="#rukovodstvo-po-integratsii-yandex-ai-studio" class="level-1">Руководство по интеграции Yandex AI Studio</a></li>
<li><a href="#soderzhanie" class="level-2">Содержание</a></li>
<li><a href="#obzor" class="level-2">Обзор</a></li>
<li><a href="#bystraya-nastroyka-3-shaga" class="level-2">Быстрая настройка (3 шага)</a></li>
<li><a href="#shag-1-sozdanie-api-klyucha" class="level-3">Шаг 1: Создание API-ключа</a></li>
<li><a href="#shag-2-ustanovka-peremennyh-okruzheniya" class="level-3">Шаг 2: Установка переменных окружения</a></li>
<li><a href="#windows-powershell" class="level-1">Windows PowerShell</a></li>
<li><a href="#postoyannaya-nastroyka-sohranyaetsya-posle-perezagruzki" class="level-1">Постоянная настройка (сохраняется после перезагрузки)</a></li>
<li><a href="#linuxmac" class="level-1">Linux/Mac</a></li>
<li><a href="#dobavte-v-bashrc-dlya-postoyannogo-effekta" class="level-1">Добавьте в ~/.bashrc для постоянного эффекта</a></li>
<li><a href="#shag-3-nastroyka-configyaml" class="level-3">Шаг 3: Настройка config.yaml</a></li>
<li><a href="#dostupnye-modeli" class="level-2">Доступные модели</a></li>
<li><a href="#modeli-generatsii-teksta" class="level-3">Модели генерации текста</a></li>
<li><a href="#modeli-embeddingov" class="level-3">Модели эмбеддингов</a></li>
<li><a href="#format-uri-modeli" class="level-2">Формат URI модели</a></li>
<li><a href="#ispolzovanie-v-kode" class="level-2">Использование в коде</a></li>
<li><a href="#bazovoe-ispolzovanie" class="level-3">Базовое использование</a></li>
<li><a href="#initsializatsiya-klienta-s-ispolzovaniem-endpointa-yandex" class="level-1">Инициализация клиента с использованием эндпоинта Yandex</a></li>
<li><a href="#formirovanie-uri-modeli" class="level-1">Формирование URI модели</a></li>
<li><a href="#otpravka-zaprosa" class="level-1">Отправка запроса</a></li>
<li><a href="#potokovaya-peredacha" class="level-3">Потоковая передача</a></li>
<li><a href="#potokovaya-peredacha-otveta" class="level-1">Потоковая передача ответа</a></li>
<li><a href="#embeddingi" class="level-3">Эмбеддинги</a></li>
<li><a href="#poluchenie-embeddingov" class="level-1">Получение эмбеддингов</a></li>
<li><a href="#ispolzovanie-s-rabochim-protsessom-codegraph" class="level-3">Использование с рабочим процессом CodeGraph</a></li>
<li><a href="#initsializatsiya-provaydera-schityvaet-dannye-iz-configyaml" class="level-1">Инициализация провайдера (считывает данные из config.yaml)</a></li>
<li><a href="#generatsiya-otveta" class="level-1">Генерация ответа</a></li>
<li><a href="#copilot-avtomaticheski-ispolzuet-nastroennyy-provayder" class="level-1">Copilot автоматически использует настроенный провайдер</a></li>
<li><a href="#spravochnik-po-konfiguratsii" class="level-2">Справочник по конфигурации</a></li>
<li><a href="#primer-polnogo-fayla-configyaml" class="level-3">Пример полного файла config.yaml</a></li>
<li><a href="#peremennye-okruzheniya" class="level-3">Переменные окружения</a></li>
<li><a href="#parametry-provaydera" class="level-3">Параметры провайдера</a></li>
<li><a href="#konfidentsialnost-i-sootvetstvie-trebovaniyam" class="level-2">Конфиденциальность и соответствие требованиям</a></li>
<li><a href="#obrabotka-oshibok" class="level-2">Обработка ошибок</a></li>
<li><a href="#oshibka-autentifikatsii-401" class="level-3">Ошибка аутентификации (401)</a></li>
<li><a href="#proverte-ustanovleny-li-peremennye" class="level-1">Проверьте, установлены ли переменные</a></li>
<li><a href="#proverte-format-api-klyucha-dolzhen-nachinatsya-s-aqvnw-aqvn-ili-analogichnogo" class="level-1">Проверьте формат API-ключа (должен начинаться с AQVNw, AQVN_ или аналогичного)</a></li>
<li><a href="#ubedites-chto-oblast-deystviya-api-klyucha-vklyuchaet-ycailanguagemodelsexecute" class="level-1">Убедитесь, что область действия API-ключа включает yc.ai.languageModels.execute</a></li>
<li><a href="#prevysheno-ogranichenie-po-chastote-zaprosov-429" class="level-3">Превышено ограничение по частоте запросов (429)</a></li>
<li><a href="#vstroennaya-povtornaya-popytka-avtomaticheski-obrabatyvaet-etu-situatsiyu" class="level-1">Встроенная повторная попытка автоматически обрабатывает эту ситуацию</a></li>
<li><a href="#no-vy-mozhete-uvelichit-taymaut-dlya-slozhnyh-zaprosov" class="level-1">Но вы можете увеличить таймаут для сложных запросов</a></li>
<li><a href="#taymaut-soedineniya" class="level-3">Таймаут соединения</a></li>
<li><a href="#uvelichte-taymaut-dlya-bolshih-zaprosov-ili-otvetov" class="level-1">Увеличьте таймаут для больших запросов или ответов</a></li>
<li><a href="#oshibka-identifikatora-kataloga" class="level-3">Ошибка идентификатора каталога</a></li>
<li><a href="#logika-povtornyh-popytok" class="level-2">Логика повторных попыток</a></li>
<li><a href="#avtomaticheskie-povtornye-popytki-dlya" class="level-1">Автоматические повторные попытки для:</a></li>
<li><a href="#apitimeouterror-isteklo-vremya-ozhidaniya" class="level-1">- APITimeoutError (истекло время ожидания)</a></li>
<li><a href="#apiconnectionerror-problemy-s-podklyucheniem" class="level-1">- APIConnectionError (проблемы с подключением)</a></li>
<li><a href="#parametry-povtora" class="level-1">Параметры повтора:</a></li>
<li><a href="#max-retries-3" class="level-1">- max_retries: 3</a></li>
<li><a href="#initial-delay-20-sekundy" class="level-1">- initial_delay: 2.0 секунды</a></li>
<li><a href="#max-delay-300-sekund" class="level-1">- max_delay: 30.0 секунд</a></li>
<li><a href="#backoff-factor-20" class="level-1">- backoff_factor: 2.0</a></li>
<li><a href="#rekomendatsii" class="level-2">Рекомендации</a></li>
<li><a href="#sravnenie-s-drugimi-provayderami" class="level-2">Сравнение с другими провайдерами</a></li>
<li><a href="#resursy" class="level-2">Ресурсы</a></li>
<li><a href="#dalneyshie-shagi" class="level-2">Дальнейшие шаги</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI-копилот для анализа исходного кода</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Продукт</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Возможности</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Интеграции</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Документация</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Начало работы</a></li>
              <li><a href="../guides/index.html" class="footer-link">Руководства</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Ресурсы</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Контакты</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
