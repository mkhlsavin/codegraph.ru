<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: Руководство по настройке">
  <meta name="keywords" content="CodeGraph, documentation, getting-started">

  <meta property="og:title" content="Руководство по настройке - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: Руководство по настройке">
  <meta property="og:type" content="article">

  <title>Руководство по настройке - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="nav-link active">Документация</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/getting-started/CONFIGURATION.html" class="">EN</a>
          <a href="../../ru/getting-started/CONFIGURATION.html" class="active">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Переключить тему">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Запросить демо</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Документация</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Запросить демо</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Начало работы</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Обзор</a></li>
        <li><a href="CONFIGURATION.html" class="active">Руководство по настройке</a></li>
        <li><a href="INSTALLATION.html">Руководство по установке</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Руководства</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Документация</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../api/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Интеграции</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../integrations/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Справочник</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../reference/index.html">Обзор</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../enterprise/index.html">Обзор</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Документация</a>
        <span>/</span>
        <a href="index.html">Начало работы</a>
        <span>/</span>
        <span>Руководство по настройке</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>Руководство по настройке</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="rukovodstvo-po-nastroyke">Руководство по настройке<a class="heading-anchor" href="#rukovodstvo-po-nastroyke" title="Link to this section">&para;</a></h1>
<p>Настройте CodeGraph для вашей среды.</p>
<h2 id="soderzhanie">Содержание<a class="heading-anchor" href="#soderzhanie" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="#fayly-konfiguratsii">Файлы конфигурации</a></li>
<li><a href="#konfiguratsiya-servera-api">Конфигурация сервера API</a></li>
<li><a href="#nastroyki-servera">Настройки сервера</a></li>
<li><a href="#konfiguratsiya-bazy-dannyh">Конфигурация базы данных</a></li>
<li><a href="#konfiguratsiya-autentifikatsii">Конфигурация аутентификации</a></li>
<li><a href="#konfiguratsiya-ogranicheniya-chastoty-zaprosov">Конфигурация ограничения частоты запросов</a></li>
<li><a href="#konfiguratsiya-cors">Конфигурация CORS</a></li>
<li><a href="#konfiguratsiya-demo-endpointa">Конфигурация демо-эндпоинта</a></li>
<li><a href="#konfiguratsiya-postavschika-llm">Конфигурация поставщика LLM</a></li>
<li><a href="#gigachat">GigaChat</a></li>
<li><a href="#lokalnaya-llm-llama-cpp-python">Локальная LLM (llama-cpp-python)</a></li>
<li><a href="#openai">OpenAI</a></li>
<li><a href="#yandex-cloud-ai-studio-yandexgpt">Yandex Cloud AI Studio (YandexGPT)</a></li>
<li><a href="#konfiguratsiya-domena">Конфигурация домена</a></li>
<li><a href="#konfiguratsiya-bazy-dannyh-cpg">Конфигурация базы данных CPG</a></li>
<li><a href="#nastroyki-poiska">Настройки поиска</a></li>
<li><a href="#ogranicheniya-zaprosov">Ограничения запросов</a></li>
<li><a href="#nastroyki-analiza">Настройки анализа</a></li>
<li><a href="#spravochnik-peremennyh-okruzheniya">Справочник переменных окружения</a></li>
<li><a href="#optimizatsiya-proizvoditelnosti">Оптимизация производительности</a></li>
<li><a href="#dlya-prodakshena-neskolko-vorkerov">Для продакшена (несколько воркеров)</a></li>
<li><a href="#dlya-razrabotki-bystraya-perezagruzka">Для разработки (быстрая перезагрузка)</a></li>
<li><a href="#dlya-ogranichennyh-resursov">Для ограниченных ресурсов</a></li>
<li><a href="#rekomendatsii-po-bezopasnosti">Рекомендации по безопасности</a></li>
<li><a href="#proverka-konfiguratsii">Проверка конфигурации</a></li>
<li><a href="#dalneyshie-shagi">Дальнейшие шаги</a></li>
</ul>
<h2 id="fayly-konfiguratsii">Файлы конфигурации<a class="heading-anchor" href="#fayly-konfiguratsii" title="Link to this section">&para;</a></h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Файл</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr>
<td>.env</td>
<td>Переменные окружения (ключи API, URL баз данных)</td>
</tr>
<tr>
<td>config.yaml</td>
<td>Основная конфигурация (LLM, поиск, анализ)</td>
</tr>
<tr>
<td>src/api/config.py</td>
<td>Конфигурация сервера API</td>
</tr>
<tr>
<td>config/prompts/*.yaml</td>
<td>Шаблоны промптов</td>
</tr>
</tbody>
</table></div>
<h2 id="konfiguratsiya-servera-api">Конфигурация сервера API<a class="heading-anchor" href="#konfiguratsiya-servera-api" title="Link to this section">&para;</a></h2>
<h3 id="nastroyki-servera">Настройки сервера<a class="heading-anchor" href="#nastroyki-servera" title="Link to this section">&para;</a></h3>
<p>Настройте хост, порт и количество воркеров через переменные окружения или аргументы командной строки:</p>
<p><strong>Через переменные окружения:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">API_HOST</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w">        </span><span class="c1"># Привязка ко всем интерфейсам</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_PORT</span><span class="o">=</span><span class="s2">&quot;8000&quot;</span><span class="w">            </span><span class="c1"># Номер порта</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_WORKERS</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="w">            </span><span class="c1"># Количество процессов-воркеров</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_DEBUG</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="w">          </span><span class="c1"># Режим отладки (автоперезагрузка)</span>
</code></pre></div>

<p><strong>Через аргументы командной строки:</strong></p>
<div class="highlight"><pre><span></span><code>python -m src.api.cli run --host 0.0.0.0 --port 8000 --workers 4
</code></pre></div>

<h3 id="konfiguratsiya-bazy-dannyh">Конфигурация базы данных<a class="heading-anchor" href="#konfiguratsiya-bazy-dannyh" title="Link to this section">&para;</a></h3>
<p>API требует PostgreSQL для управления пользователями, сессиями и журналами аудита.</p>
<p><strong>Формат строки подключения:</strong></p>
<div class="highlight"><pre><span></span><code>postgresql+asyncpg://имя_пользователя:пароль@хост:порт/база_данных
</code></pre></div>

<p><strong>Конфигурация через переменную окружения:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;postgresql+asyncpg://postgres:your_password@localhost:5432/codegraph&quot;</span>
</code></pre></div>

<p><strong>Настройки пула соединений:</strong></p>
<p>Измените <code>src/api/config.py</code>, чтобы настроить пул соединений:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">DatabaseConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;postgresql+asyncpg://postgres:postgres@localhost:5432/codegraph&quot;</span>
<span class="w">    </span><span class="nl">pool_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="n">Количество</span><span class="w"> </span><span class="n">поддерживаемых</span><span class="w"> </span><span class="n">соединений</span>
<span class="w">    </span><span class="nl">max_overflow</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Дополнительные</span><span class="w"> </span><span class="n">соединения</span><span class="w"> </span><span class="n">при</span><span class="w"> </span><span class="n">заполнении</span><span class="w"> </span><span class="n">пула</span>
<span class="w">    </span><span class="nl">pool_timeout</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Время</span><span class="w"> </span><span class="n">ожидания</span><span class="w"> </span><span class="n">соединения</span><span class="w"> </span><span class="p">(</span><span class="n">в</span><span class="w"> </span><span class="n">секундах</span><span class="p">)</span>
<span class="w">    </span><span class="nl">pool_recycle</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1800</span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">Пересоздание</span><span class="w"> </span><span class="n">соединений</span><span class="w"> </span><span class="n">после</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">минут</span>
<span class="w">    </span><span class="nl">echo</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Логирование</span><span class="w"> </span><span class="n">всех</span><span class="w"> </span><span class="k">SQL</span><span class="o">-</span><span class="n">запросов</span><span class="w"> </span><span class="p">(</span><span class="n">только</span><span class="w"> </span><span class="n">для</span><span class="w"> </span><span class="n">отладки</span><span class="p">)</span>
</code></pre></div>

<h3 id="konfiguratsiya-autentifikatsii">Конфигурация аутентификации<a class="heading-anchor" href="#konfiguratsiya-autentifikatsii" title="Link to this section">&para;</a></h3>
<h4 id="jwt-autentifikatsiya">JWT-аутентификация<a class="heading-anchor" href="#jwt-autentifikatsiya" title="Link to this section">&para;</a></h4>
<p>Настройте параметры JWT-токенов:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Секретный ключ для подписи токенов (ОБЯЗАТЕЛЬНО ИЗМЕНИТЬ В ПРОДАКШЕНЕ!)</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_JWT_SECRET</span><span class="o">=</span><span class="s2">&quot;ваш-секретный-ключ-минимум-64-символа-рекомендуется&quot;</span>

<span class="c1"># Время жизни токена (по умолчанию: 30 минут для доступа, 7 дней для обновления)</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_JWT_ACCESS_EXPIRE_MINUTES</span><span class="o">=</span><span class="s2">&quot;30&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">API_JWT_REFRESH_EXPIRE_DAYS</span><span class="o">=</span><span class="s2">&quot;7&quot;</span>
</code></pre></div>

<p><strong>В config.py:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="n">JWTConfig</span>(<span class="n">BaseModel</span>):
    <span class="n">secret_key:</span> <span class="n">str</span> = <span class="s">&quot;замените-в-продакшене-минимум-64-символа&quot;</span>
    <span class="n">algorithm:</span> <span class="n">str</span> = <span class="s">&quot;HS256&quot;</span>
    <span class="n">access_token_expire_minutes:</span> <span class="n">int</span> = <span class="mi">30</span>
    <span class="n">refresh_token_expire_days:</span> <span class="n">int</span> = <span class="mi">7</span>
</code></pre></div>

<p><strong>Сгенерируйте надёжный секретный ключ:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import secrets; print(secrets.token_urlsafe(64))&quot;</span>
</code></pre></div>

<h4 id="api-klyuchi">API-ключи<a class="heading-anchor" href="#api-klyuchi" title="Link to this section">&para;</a></h4>
<p>Включите аутентификацию по API-ключам для программного доступа:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="n">AuthConfig</span>(<span class="n">BaseModel</span>):
    <span class="n">api_keys_enabled:</span> <span class="n">bool</span> = <span class="nb">True</span>  <span class="c1"># Включить аутентификацию по API-ключам</span>
</code></pre></div>

<p>Создание API-ключей через API:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Требуется JWT-токен
curl -X POST http://localhost:8000/api/v1/auth/api-keys \
  -H &quot;Authorization: Bearer YOUR_TOKEN&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{
    &quot;name&quot;: &quot;Мой API-ключ&quot;,
    &quot;expires_days&quot;: 365,
    &quot;scopes&quot;: [&quot;scenarios:read&quot;, &quot;query:execute&quot;]
  }&#39;
</code></pre></div>

<h4 id="provaydery-oauth">Провайдеры OAuth<a class="heading-anchor" href="#provaydery-oauth" title="Link to this section">&para;</a></h4>
<p>Настройте провайдеров OAuth 2.0 (GitHub, Google, GitLab, Keycloak):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># OAuth для GitHub</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_GITHUB_CLIENT_ID</span><span class="o">=</span><span class="s2">&quot;ваш_client_id_для_github&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_GITHUB_CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;ваш_client_secret_для_github&quot;</span>

<span class="c1"># OAuth для Google</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_GOOGLE_CLIENT_ID</span><span class="o">=</span><span class="s2">&quot;ваш_client_id_для_google&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_GOOGLE_CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;ваш_client_secret_для_google&quot;</span>

<span class="c1"># Keycloak</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_KEYCLOAK_SERVER_URL</span><span class="o">=</span><span class="s2">&quot;https://keycloak.example.com&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_KEYCLOAK_REALM</span><span class="o">=</span><span class="s2">&quot;ваш_realm&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_KEYCLOAK_CLIENT_ID</span><span class="o">=</span><span class="s2">&quot;ваш_client_id&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">OAUTH_KEYCLOAK_CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;ваш_client_secret&quot;</span>
</code></pre></div>

<h4 id="ldapactive-directory">LDAP/Active Directory<a class="heading-anchor" href="#ldapactive-directory" title="Link to this section">&para;</a></h4>
<p>Настройте LDAP для корпоративной аутентификации:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">LDAP_SERVER</span><span class="o">=</span><span class="s2">&quot;ldap.example.com&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LDAP_BASE_DN</span><span class="o">=</span><span class="s2">&quot;dc=example,dc=com&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LDAP_BIND_USER</span><span class="o">=</span><span class="s2">&quot;cn=admin,dc=example,dc=com&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LDAP_BIND_PASSWORD</span><span class="o">=</span><span class="s2">&quot;admin_password&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LDAP_USER_SEARCH_BASE</span><span class="o">=</span><span class="s2">&quot;ou=users,dc=example,dc=com&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">LDAP_GROUP_SEARCH_BASE</span><span class="o">=</span><span class="s2">&quot;ou=groups,dc=example,dc=com&quot;</span>
</code></pre></div>

<h3 id="nastroyka-ogranicheniya-chastoty-zaprosov-rate-limiting">Настройка ограничения частоты запросов (Rate Limiting)<a class="heading-anchor" href="#nastroyka-ogranicheniya-chastoty-zaprosov-rate-limiting" title="Link to this section">&para;</a></h3>
<p>Защитите ваш API с помощью ограничения частоты запросов:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">RateLimitConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nl">enabled</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>
<span class="w">    </span><span class="nl">storage</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;memory&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="ss">&quot;memory&quot;</span><span class="w"> </span><span class="n">или</span><span class="w"> </span><span class="ss">&quot;redis://localhost:6379&quot;</span>
<span class="w">    </span><span class="nl">default_limits</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;100/minute&quot;, &quot;1000/hour&quot;</span><span class="o">]</span>

<span class="w">    </span><span class="nl">endpoint_limits</span><span class="p">:</span><span class="w"> </span><span class="n">Dict</span><span class="o">[</span><span class="n">str, str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="ss">&quot;/api/v1/review/*&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;10/minute&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;/api/v1/chat&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;60/minute&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;/api/v1/chat/stream&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;30/minute&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;/api/v1/query/execute&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;30/minute&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;/api/v1/demo/chat&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;30/minute&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="err">}</span>
</code></pre></div>

<p><strong>Используйте Redis в продакшене</strong> (для общего доступа между воркерами):</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">RATE_LIMIT_STORAGE</span><span class="o">=</span><span class="s2">&quot;redis://localhost:6379&quot;</span>
</code></pre></div>

<h3 id="nastroyka-cors">Настройка CORS<a class="heading-anchor" href="#nastroyka-cors" title="Link to this section">&para;</a></h3>
<p>Настройте обмен ресурсами между источниками (CORS) для веб-интерфейсов:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">CORSConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nl">allowed_origins</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="n">        &quot;http://localhost:8080&quot;,</span>
<span class="n">        &quot;http://127.0.0.1:8080&quot;,</span>
<span class="n">        &quot;http://localhost:3000&quot;,</span>
<span class="n">        &quot;http://127.0.0.1:3000&quot;,</span>
<span class="n">    </span><span class="o">]</span>
<span class="w">    </span><span class="nl">allowed_methods</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;</span><span class="o">]</span>
<span class="w">    </span><span class="nl">allowed_headers</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;*&quot;</span><span class="o">]</span>
<span class="w">    </span><span class="nl">allow_credentials</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>
<span class="w">    </span><span class="nl">max_age</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Время</span><span class="w"> </span><span class="n">кэширования</span><span class="w"> </span><span class="n">preflight</span><span class="o">-</span><span class="n">запросов</span><span class="w"> </span><span class="p">(</span><span class="n">в</span><span class="w"> </span><span class="n">секундах</span><span class="p">)</span>
</code></pre></div>

<h3 id="konfiguratsiya-demo-endpointa">Конфигурация демо-эндпоинта<a class="heading-anchor" href="#konfiguratsiya-demo-endpointa" title="Link to this section">&para;</a></h3>
<p>Настройте публичный демо-эндпоинт:</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">DEMO_ENABLED</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">DEMO_RATE_LIMIT</span><span class="o">=</span><span class="s2">&quot;30/minute&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">DemoConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nl">enabled</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>
<span class="w">    </span><span class="nl">rate_limit</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;30/minute&quot;</span>
<span class="w">    </span><span class="nl">allowed_scenarios</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;onboarding&quot;</span><span class="o">]</span>
<span class="w">    </span><span class="nl">max_query_length</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span>
</code></pre></div>

<h2 id="nastroyka-provaydera-llm">Настройка провайдера LLM<a class="heading-anchor" href="#nastroyka-provaydera-llm" title="Link to this section">&para;</a></h2>
<p>Настройте провайдера LLM, используемого для анализа кода и генерации запросов.</p>
<h3 id="gigachat">GigaChat<a class="heading-anchor" href="#gigachat" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">GIGACHAT_AUTH_KEY</span><span class="o">=</span><span class="s2">&quot;ваш_ключ_gigachat&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
llm:
  provider: gigachat
  model: GigaChat-2-Pro
  temperature: 0.1
  max_tokens: 4096
</code></pre></div>

<h3 id="lokalnyy-llm-llama-cpp-python">Локальный LLM (llama-cpp-python)<a class="heading-anchor" href="#lokalnyy-llm-llama-cpp-python" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">LLMXCPG_MODEL_PATH</span><span class="o">=</span><span class="s2">&quot;/путь/к/модели/llmxcpg/model.gguf&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>#<span class="w"> </span>config.yaml
llm:
<span class="w">  </span>provider:<span class="w"> </span>local
<span class="w">  </span>model_path:<span class="w"> </span><span class="cp">${</span><span class="n">LLMXCPG_MODEL_PATH</span><span class="cp">}</span>
<span class="w">  </span>n_gpu_layers:<span class="w"> </span>-1<span class="w">   </span>#<span class="w"> </span>Использовать<span class="w"> </span>все<span class="w"> </span>GPU-слои<span class="w"> </span>(-1)
<span class="w">  </span>n_ctx:<span class="w"> </span>8192<span class="w">        </span>#<span class="w"> </span>Размер<span class="w"> </span>окна<span class="w"> </span>контекста
<span class="w">  </span>n_threads:<span class="w"> </span>8<span class="w">       </span>#<span class="w"> </span>Количество<span class="w"> </span>CPU-потоков<span class="w"> </span>для<span class="w"> </span>инференса
<span class="w">  </span>temperature:<span class="w"> </span>0.1
<span class="w">  </span>max_tokens:<span class="w"> </span>4096
</code></pre></div>

<h3 id="openai">OpenAI<a class="heading-anchor" href="#openai" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">&quot;ваш_ключ_openai&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
llm:
  provider: openai
  model: gpt-4
  temperature: 0.1
  max_tokens: 4096
  api_base: https://api.openai.com/v1
</code></pre></div>

<h3 id="yandex-cloud-ai-studio-yandexgpt">Yandex Cloud AI Studio (YandexGPT)<a class="heading-anchor" href="#yandex-cloud-ai-studio-yandexgpt" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">YANDEX_API_KEY</span><span class="o">=</span><span class="s2">&quot;ваш_ключ_api_yandex&quot;</span>
<span class="k">export</span><span class="w"> </span><span class="n">YANDEX_FOLDER_ID</span><span class="o">=</span><span class="s2">&quot;ваш_id_папки&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>#<span class="w"> </span>config.yaml
llm:
<span class="w">  </span>provider:<span class="w"> </span>yandex
<span class="w">  </span>yandex:
<span class="w">    </span>api_key:<span class="w"> </span><span class="cp">${</span><span class="n">YANDEX_API_KEY</span><span class="cp">}</span>
<span class="w">    </span>folder_id:<span class="w"> </span><span class="cp">${</span><span class="n">YANDEX_FOLDER_ID</span><span class="cp">}</span>
<span class="w">    </span>model:<span class="w"> </span>yandexgpt/latest<span class="w">      </span>#<span class="w"> </span>или:<span class="w"> </span>yandexgpt-lite/latest,<span class="w"> </span>yandexgpt/rc
<span class="w">    </span>base_url:<span class="w"> </span>https://llm.api.cloud.yandex.net/v1
<span class="w">    </span>temperature:<span class="w"> </span>0.7
<span class="w">    </span>max_tokens:<span class="w"> </span>2000
<span class="w">    </span>timeout:<span class="w"> </span>60
<span class="w">    </span>embedding_model:<span class="w"> </span>text-search-doc/latest
</code></pre></div>

<p>Доступные модели:
- <code>yandexgpt/latest</code> — YandexGPT (основная модель)
- <code>yandexgpt-lite/latest</code> — YandexGPT Lite (быстрее, меньше по размеру)
- <code>yandexgpt/rc</code> — Кандидат в релиз с возможностью логического вывода
- <code>yandexgpt-32k/latest</code> — Расширенный контекст (32K токенов)</p>
<h2 id="konfiguratsiya-domena">Конфигурация домена<a class="heading-anchor" href="#konfiguratsiya-domena" title="Link to this section">&para;</a></h2>
<p>Переключение между различными кодовыми базами для анализа:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
domain:
  name: postgresql  # postgresql, linux_kernel, llvm, generic
  auto_activate: true
</code></pre></div>

<p>Доступные домены:
- <code>postgresql</code> — база данных PostgreSQL 17.6
- <code>linux_kernel</code> — ядро Linux 6.x
- <code>llvm</code> — инфраструктура компилятора LLVM 18.x
- <code>generic</code> — универсальная кодовая база C/C++</p>
<h2 id="konfiguratsiya-bazy-dannyh-cpg">Конфигурация базы данных CPG<a class="heading-anchor" href="#konfiguratsiya-bazy-dannyh-cpg" title="Link to this section">&para;</a></h2>
<p>Настройка базы данных Code Property Graph (для анализа кода):</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">yaml</span>
<span class="nx">cpg</span><span class="p">:</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">postgresql</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Тип</span><span class="w"> </span><span class="nx">базы</span><span class="w"> </span><span class="nx">данных</span><span class="w"> </span><span class="nx">для</span><span class="w"> </span><span class="nx">хранения</span><span class="w"> </span><span class="nx">CPG</span>
<span class="w">  </span><span class="nx">db_path</span><span class="p">:</span><span class="w"> </span><span class="nx">cpg</span><span class="p">.</span><span class="nx">duckdb</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Устаревшее</span><span class="p">:</span><span class="w"> </span><span class="nx">путь</span><span class="w"> </span><span class="nx">к</span><span class="w"> </span><span class="nx">DuckDB</span><span class="w"> </span><span class="p">(</span><span class="nx">если</span><span class="w"> </span><span class="nx">используется</span><span class="w"> </span><span class="nx">DuckDB</span><span class="p">)</span>
</code></pre></div>

<h2 id="nastroyki-poiska">Настройки поиска<a class="heading-anchor" href="#nastroyki-poiska" title="Link to this section">&para;</a></h2>
<p>Настройка семантического поиска и извлечения:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
retrieval:
  embedding_model: all-MiniLM-L6-v2  # Модель sentence transformer
  embedding_dimension: 384            # Размерность вектора
  top_k_qa: 3                         # Количество лучших результатов для поиска по вопросам и ответам
  top_k_graph: 5                      # Количество лучших результатов для поиска по графу (SQL)
  max_results: 50                     # Максимальное количество результатов поиска
  chunk_size: 512                     # Размер фрагмента текста для создания эмбеддингов

  # Гибридный поиск (векторный + графовый)
  hybrid:
    enabled: true
    vector_weight: 0.6      # Вес семантического поиска
    graph_weight: 0.4       # Вес структурного поиска
    rrf_k: 60               # Константа Reciprocal Rank Fusion
</code></pre></div>

<h3 id="ogranicheniya-zaprosov">Ограничения запросов<a class="heading-anchor" href="#ogranicheniya-zaprosov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
query:
  default_limit: 100   # Значение LIMIT по умолчанию для SQL-запросов
  max_limit: 1000      # Максимально допустимое значение LIMIT
</code></pre></div>

<h2 id="nastroyki-analiza">Настройки анализа<a class="heading-anchor" href="#nastroyki-analiza" title="Link to this section">&para;</a></h2>
<p>Настройте пороговые значения анализа:</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
analysis:
  sanitization_confidence_threshold: 0.7  # Уровень уверенности для обнаружения очистки данных
  similarity_threshold: 0.8                # Порог семантического сходства
  complexity_threshold: 10                 # Порог цикломатической сложности
</code></pre></div>

<h2 id="spravochnik-peremennyh-okruzheniya">Справочник переменных окружения<a class="heading-anchor" href="#spravochnik-peremennyh-okruzheniya" title="Link to this section">&para;</a></h2>
<p>Создайте файл <code>.env</code> в корне проекта:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Конфигурация</span><span class="w"> </span><span class="n">API</span><span class="o">-</span><span class="n">сервера</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">API_HOST</span><span class="o">=</span><span class="mf">0.0.0.0</span>
<span class="n">API_PORT</span><span class="o">=</span><span class="mi">8000</span>
<span class="n">API_WORKERS</span><span class="o">=</span><span class="mi">4</span>
<span class="n">API_DEBUG</span><span class="o">=</span><span class="k">false</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Конфигурация</span><span class="w"> </span><span class="n">базы</span><span class="w"> </span><span class="n">данных</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">DATABASE_URL</span><span class="o">=</span><span class="n">postgresql</span><span class="o">+</span><span class="nl">asyncpg</span><span class="p">:</span><span class="o">//</span><span class="nl">postgres</span><span class="p">:</span><span class="n">your_password</span><span class="nv">@localhost</span><span class="err">:</span><span class="mi">5432</span><span class="o">/</span><span class="n">codegraph</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Аутентификация</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">API_JWT_SECRET</span><span class="o">=</span><span class="n">ваш</span><span class="o">-</span><span class="n">секретный</span><span class="o">-</span><span class="n">ключ</span><span class="o">-</span><span class="n">минимум</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">символа</span><span class="o">-</span><span class="n">измените</span><span class="o">-</span><span class="n">в</span><span class="o">-</span><span class="n">продакшене</span>
<span class="n">API_JWT_ALGORITHM</span><span class="o">=</span><span class="n">HS256</span>

<span class="err">#</span><span class="w"> </span><span class="n">Пользователь</span><span class="o">-</span><span class="n">администратор</span><span class="w"> </span><span class="p">(</span><span class="n">для</span><span class="w"> </span><span class="n">первоначальной</span><span class="w"> </span><span class="n">настройки</span><span class="p">)</span>
<span class="n">API_ADMIN_USERNAME</span><span class="o">=</span><span class="k">admin</span>
<span class="n">API_ADMIN_PASSWORD</span><span class="o">=</span><span class="n">замените</span><span class="o">-</span><span class="n">этот</span><span class="o">-</span><span class="n">пароль</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Поставщики</span><span class="w"> </span><span class="n">LLM</span><span class="w"> </span><span class="n">API</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">GIGACHAT_AUTH_KEY</span><span class="o">=</span><span class="n">ваш_ключ_gigachat</span>
<span class="n">OPENAI_API_KEY</span><span class="o">=</span><span class="n">ваш_ключ_openai</span>
<span class="n">YANDEX_API_KEY</span><span class="o">=</span><span class="n">ваш_ключ_yandex_api</span>
<span class="n">YANDEX_FOLDER_ID</span><span class="o">=</span><span class="n">ваш_идентификатор_папки_yandex</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Пути</span><span class="w"> </span><span class="n">к</span><span class="w"> </span><span class="n">локальным</span><span class="w"> </span><span class="n">моделям</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">LLMXCPG_MODEL_PATH</span><span class="o">=/</span><span class="n">путь</span><span class="o">/</span><span class="n">к</span><span class="o">/</span><span class="n">llmxcpg</span><span class="o">/</span><span class="n">model</span><span class="p">.</span><span class="n">gguf</span>
<span class="n">QWEN3_MODEL_PATH</span><span class="o">=/</span><span class="n">путь</span><span class="o">/</span><span class="n">к</span><span class="o">/</span><span class="n">qwen3</span><span class="o">/</span><span class="n">model</span><span class="p">.</span><span class="n">gguf</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Поставщики</span><span class="w"> </span><span class="n">OAuth</span><span class="w"> </span><span class="p">(</span><span class="n">опционально</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">OAUTH_GITHUB_CLIENT_ID</span><span class="o">=</span><span class="n">ваш_id_клиента_github</span>
<span class="n">OAUTH_GITHUB_CLIENT_SECRET</span><span class="o">=</span><span class="n">ваш_секрет_клиента_github</span>
<span class="n">OAUTH_GOOGLE_CLIENT_ID</span><span class="o">=</span><span class="n">ваш_id_клиента_google</span>
<span class="n">OAUTH_GOOGLE_CLIENT_SECRET</span><span class="o">=</span><span class="n">ваш_секрет_клиента_google</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Конфигурация</span><span class="w"> </span><span class="n">LDAP</span><span class="w"> </span><span class="p">(</span><span class="n">опционально</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">LDAP_SERVER</span><span class="o">=</span><span class="n">ldap</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="n">LDAP_BASE_DN</span><span class="o">=</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">LDAP_BIND_USER</span><span class="o">=</span><span class="n">cn</span><span class="o">=</span><span class="k">admin</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">LDAP_BIND_PASSWORD</span><span class="o">=</span><span class="n">admin_password</span>
<span class="n">LDAP_USER_SEARCH_BASE</span><span class="o">=</span><span class="n">ou</span><span class="o">=</span><span class="n">users</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">LDAP_GROUP_SEARCH_BASE</span><span class="o">=</span><span class="n">ou</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Ограничение</span><span class="w"> </span><span class="n">частоты</span><span class="w"> </span><span class="n">запросов</span><span class="w"> </span><span class="p">(</span><span class="n">Rate</span><span class="w"> </span><span class="n">Limiting</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">RATE_LIMIT_STORAGE</span><span class="o">=</span><span class="n">memory</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">или</span><span class="w"> </span><span class="nl">redis</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">6379</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Демонстрационный</span><span class="w"> </span><span class="n">эндпоинт</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">DEMO_ENABLED</span><span class="o">=</span><span class="k">true</span>
<span class="n">DEMO_RATE_LIMIT</span><span class="o">=</span><span class="mi">30</span><span class="o">/</span><span class="k">minute</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Настройки</span><span class="w"> </span><span class="n">базы</span><span class="w"> </span><span class="n">данных</span><span class="w"> </span><span class="n">CPG</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">CPG_DB_PATH</span><span class="o">=</span><span class="n">cpg</span><span class="p">.</span><span class="n">duckdb</span>
<span class="err">#</span><span class="w"> </span><span class="n">CPG_TYPE</span><span class="o">=</span><span class="n">postgresql</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Тип</span><span class="w"> </span><span class="n">домена</span><span class="w"> </span><span class="n">для</span><span class="w"> </span><span class="n">анализа</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Логирование</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">LOG_LEVEL</span><span class="o">=</span><span class="n">INFO</span>
<span class="n">LLM_VERBOSE</span><span class="o">=</span><span class="k">false</span>

<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="err">#</span><span class="w"> </span><span class="n">Производительность</span>
<span class="err">#</span><span class="w"> </span><span class="o">=============================================================================</span>
<span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span>
<span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">8</span>
</code></pre></div>

<h2 id="optimizatsiya-proizvoditelnosti">Оптимизация производительности<a class="heading-anchor" href="#optimizatsiya-proizvoditelnosti" title="Link to this section">&para;</a></h2>
<h3 id="dlya-promyshlennoy-ekspluatatsii-neskolko-vorkerov">Для промышленной эксплуатации (несколько воркеров)<a class="heading-anchor" href="#dlya-promyshlennoy-ekspluatatsii-neskolko-vorkerov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Используйте несколько воркеров для лучшей пропускной способности</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">host</span><span class="w"> </span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="mi">8000</span><span class="w"> </span><span class="o">--</span><span class="n">workers</span><span class="w"> </span><span class="mi">4</span>

<span class="c1"># Используйте Redis для ограничения частоты запросов (общий доступ между воркерами)</span>
<span class="k">export</span><span class="w"> </span><span class="n">RATE_LIMIT_STORAGE</span><span class="o">=</span><span class="s2">&quot;redis://localhost:6379&quot;</span>

<span class="c1"># Увеличьте размер пула соединений с базой данных</span>
<span class="c1"># Отредактируйте src/api/config.py:</span>
<span class="c1"># pool_size: 20</span>
<span class="c1"># max_overflow: 40</span>
</code></pre></div>

<h3 id="dlya-razrabotki-avtomaticheskaya-perezagruzka">Для разработки (автоматическая перезагрузка)<a class="heading-anchor" href="#dlya-razrabotki-avtomaticheskaya-perezagruzka" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Один воркер с автоматической перезагрузкой</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cli</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">host</span><span class="w"> </span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="w"> </span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="mi">8000</span><span class="w"> </span><span class="o">--</span><span class="n">reload</span><span class="w"> </span><span class="o">--</span><span class="nb">log</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">debug</span>

<span class="c1"># Включите логирование SQL-запросов</span>
<span class="c1"># Отредактируйте src/api/config.py:</span>
<span class="c1"># echo: True</span>
</code></pre></div>

<h3 id="pri-ogranichennyh-resursah">При ограниченных ресурсах<a class="heading-anchor" href="#pri-ogranichennyh-resursah" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> config.yaml
retrieval:
  batch_size: 50    # Уменьшено с 100
  top_k_qa: 3       # Уменьшено с 10
  top_k_graph: 3

llm:
  max_tokens: 2048  # Уменьшено с 4096
</code></pre></div>

<h2 id="rekomendatsii-po-obespecheniyu-bezopasnosti">Рекомендации по обеспечению безопасности<a class="heading-anchor" href="#rekomendatsii-po-obespecheniyu-bezopasnosti" title="Link to this section">&para;</a></h2>
<ol>
<li><strong>Измените пароли по умолчанию:</strong>
   ```bash
   # Сгенерируйте надежный секретный ключ JWT
   python -c “import secrets; print(secrets.token_urlsafe(64))”</li>
</ol>
<h1 id="ustanovite-nadezhnyy-parol-administratora">Установите надежный пароль администратора<a class="heading-anchor" href="#ustanovite-nadezhnyy-parol-administratora" title="Link to this section">&para;</a></h1>
<p>python -m src.api.cli create-admin –username admin –password &lt;надежный_пароль&gt;
   ```</p>
<ol>
<li><strong>Используйте переменные окружения для хранения секретов:</strong>
   - Никогда не добавляйте файлы <code>.env</code> в систему контроля версий
   - Добавьте <code>.env</code> в файл <code>.gitignore</code></li>
<li><strong>Включите HTTPS в продакшене:</strong>
   - Используйте обратный прокси (nginx, Caddy, Traefik)
   - Либо настройте uvicorn с SSL-сертификатами</li>
<li><strong>Ограничьте источники CORS:</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">python</span>
<span class="w">   </span><span class="nl">allowed_origins</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="n">       &quot;https://yourapp.example.com&quot;,  # Только фронтенд продакшена</span>
<span class="n">   </span><span class="o">]</span>
</code></pre></div>

<ol start="4">
<li><strong>Настройте ограничение частоты запросов (rate limiting):</strong>
   - Используйте Redis для распределенного ограничения частоты запросов
   - Настройте лимиты в соответствии с возможностями вашей системы</li>
</ol>
<h2 id="proverka">Проверка<a class="heading-anchor" href="#proverka" title="Link to this section">&para;</a></h2>
<p>Проверьте свою конфигурацию:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Проверка подключения к базе данных</span>
<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.database.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_db_connection</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;База данных ОК&#39;</span> <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">check_db_connection</span><span class="p">())</span> <span class="k">else</span> <span class="s1">&#39;Ошибка базы данных&#39;</span><span class="p">)</span>
<span class="s2">&quot;</span>

<span class="c1"># Проверка работоспособности API</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">health</span>
</code></pre></div>

<h2 id="dalneyshie-shagi">Дальнейшие шаги<a class="heading-anchor" href="#dalneyshie-shagi" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="INSTALLATION.html">Руководство по установке</a> — Настройка системы</li>
<li><a href="README.html">Краткое руководство</a> — Быстрый старт</li>
<li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя TUI</a> — Изучение использования системы</li>
<li><a href="../api/REST_API.html">Справка по API</a> — Обзор конечных точек API</li>
</ul>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="INSTALLATION.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Назад</span>
        <span class="doc-page-nav-title">Руководство по установке</span>
      </a>

      <a href="../guides/index.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Вперед</span>
        <span class="doc-page-nav-title">Руководства</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Обновлено: 2025-12-25</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/getting-started/CONFIGURATION.md" target="_blank" rel="noopener">Редактировать на GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">На этой странице</div>
      <ul class="doc-toc-list">
        <li><a href="#rukovodstvo-po-nastroyke" class="level-1">Руководство по настройке</a></li>
<li><a href="#soderzhanie" class="level-2">Содержание</a></li>
<li><a href="#fayly-konfiguratsii" class="level-2">Файлы конфигурации</a></li>
<li><a href="#konfiguratsiya-servera-api" class="level-2">Конфигурация сервера API</a></li>
<li><a href="#nastroyki-servera" class="level-3">Настройки сервера</a></li>
<li><a href="#konfiguratsiya-bazy-dannyh" class="level-3">Конфигурация базы данных</a></li>
<li><a href="#konfiguratsiya-autentifikatsii" class="level-3">Конфигурация аутентификации</a></li>
<li><a href="#sekretnyy-klyuch-dlya-podpisi-tokenov-obyazatelno-izmenit-v-prodakshene" class="level-1">Секретный ключ для подписи токенов (ОБЯЗАТЕЛЬНО ИЗМЕНИТЬ В ПРОДАКШЕНЕ!)</a></li>
<li><a href="#vremya-zhizni-tokena-po-umolchaniyu-30-minut-dlya-dostupa-7-dney-dlya-obnovleniya" class="level-1">Время жизни токена (по умолчанию: 30 минут для доступа, 7 дней для обновления)</a></li>
<li><a href="#trebuetsya-jwt-token" class="level-1">Требуется JWT-токен</a></li>
<li><a href="#oauth-dlya-github" class="level-1">OAuth для GitHub</a></li>
<li><a href="#oauth-dlya-google" class="level-1">OAuth для Google</a></li>
<li><a href="#keycloak" class="level-1">Keycloak</a></li>
<li><a href="#nastroyka-ogranicheniya-chastoty-zaprosov-rate-limiting" class="level-3">Настройка ограничения частоты запросов (Rate Limiting)</a></li>
<li><a href="#nastroyka-cors" class="level-3">Настройка CORS</a></li>
<li><a href="#konfiguratsiya-demo-endpointa" class="level-3">Конфигурация демо-эндпоинта</a></li>
<li><a href="#nastroyka-provaydera-llm" class="level-2">Настройка провайдера LLM</a></li>
<li><a href="#gigachat" class="level-3">GigaChat</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#lokalnyy-llm-llama-cpp-python" class="level-3">Локальный LLM (llama-cpp-python)</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#openai" class="level-3">OpenAI</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#yandex-cloud-ai-studio-yandexgpt" class="level-3">Yandex Cloud AI Studio (YandexGPT)</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#konfiguratsiya-domena" class="level-2">Конфигурация домена</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#konfiguratsiya-bazy-dannyh-cpg" class="level-2">Конфигурация базы данных CPG</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#nastroyki-poiska" class="level-2">Настройки поиска</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#ogranicheniya-zaprosov" class="level-3">Ограничения запросов</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#nastroyki-analiza" class="level-2">Настройки анализа</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#spravochnik-peremennyh-okruzheniya" class="level-2">Справочник переменных окружения</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#konfiguratsiya-api-servera" class="level-1">Конфигурация API-сервера</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#konfiguratsiya-bazy-dannyh" class="level-1">Конфигурация базы данных</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#autentifikatsiya" class="level-1">Аутентификация</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#polzovatel-administrator-dlya-pervonachalnoy-nastroyki" class="level-1">Пользователь-администратор (для первоначальной настройки)</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#postavschiki-llm-api" class="level-1">Поставщики LLM API</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#puti-k-lokalnym-modelyam" class="level-1">Пути к локальным моделям</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#postavschiki-oauth-optsionalno" class="level-1">Поставщики OAuth (опционально)</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#konfiguratsiya-ldap-optsionalno" class="level-1">Конфигурация LDAP (опционально)</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#ogranichenie-chastoty-zaprosov-rate-limiting" class="level-1">Ограничение частоты запросов (Rate Limiting)</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#demonstratsionnyy-endpoint" class="level-1">Демонстрационный эндпоинт</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#nastroyki-bazy-dannyh-cpg" class="level-1">Настройки базы данных CPG</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#cpg-typepostgresql-tip-domena-dlya-analiza" class="level-1">CPG_TYPE=postgresql  # Тип домена для анализа</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#logirovanie" class="level-1">Логирование</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#proizvoditelnost" class="level-1">Производительность</a></li>
<li><a href="#" class="level-1">=============================================================================</a></li>
<li><a href="#optimizatsiya-proizvoditelnosti" class="level-2">Оптимизация производительности</a></li>
<li><a href="#dlya-promyshlennoy-ekspluatatsii-neskolko-vorkerov" class="level-3">Для промышленной эксплуатации (несколько воркеров)</a></li>
<li><a href="#ispolzuyte-neskolko-vorkerov-dlya-luchshey-propusknoy-sposobnosti" class="level-1">Используйте несколько воркеров для лучшей пропускной способности</a></li>
<li><a href="#ispolzuyte-redis-dlya-ogranicheniya-chastoty-zaprosov-obschiy-dostup-mezhdu-vorkerami" class="level-1">Используйте Redis для ограничения частоты запросов (общий доступ между воркерами)</a></li>
<li><a href="#uvelichte-razmer-pula-soedineniy-s-bazoy-dannyh" class="level-1">Увеличьте размер пула соединений с базой данных</a></li>
<li><a href="#otredaktiruyte-srcapiconfigpy" class="level-1">Отредактируйте src/api/config.py:</a></li>
<li><a href="#pool-size-20" class="level-1">pool_size: 20</a></li>
<li><a href="#max-overflow-40" class="level-1">max_overflow: 40</a></li>
<li><a href="#dlya-razrabotki-avtomaticheskaya-perezagruzka" class="level-3">Для разработки (автоматическая перезагрузка)</a></li>
<li><a href="#odin-vorker-s-avtomaticheskoy-perezagruzkoy" class="level-1">Один воркер с автоматической перезагрузкой</a></li>
<li><a href="#vklyuchite-logirovanie-sql-zaprosov" class="level-1">Включите логирование SQL-запросов</a></li>
<li><a href="#otredaktiruyte-srcapiconfigpy" class="level-1">Отредактируйте src/api/config.py:</a></li>
<li><a href="#echo-true" class="level-1">echo: True</a></li>
<li><a href="#pri-ogranichennyh-resursah" class="level-3">При ограниченных ресурсах</a></li>
<li><a href="#configyaml" class="level-1">config.yaml</a></li>
<li><a href="#rekomendatsii-po-obespecheniyu-bezopasnosti" class="level-2">Рекомендации по обеспечению безопасности</a></li>
<li><a href="#ustanovite-nadezhnyy-parol-administratora" class="level-1">Установите надежный пароль администратора</a></li>
<li><a href="#proverka" class="level-2">Проверка</a></li>
<li><a href="#proverka-podklyucheniya-k-baze-dannyh" class="level-1">Проверка подключения к базе данных</a></li>
<li><a href="#proverka-rabotosposobnosti-api" class="level-1">Проверка работоспособности API</a></li>
<li><a href="#dalneyshie-shagi" class="level-2">Дальнейшие шаги</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI-копилот для анализа исходного кода</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Продукт</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Возможности</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Интеграции</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Документация</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Начало работы</a></li>
              <li><a href="../guides/index.html" class="footer-link">Руководства</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Ресурсы</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Контакты</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
