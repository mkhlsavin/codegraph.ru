<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CodeGraph documentation: Кулинарная книга SQL-запросов для DuckDB CPG">
  <meta name="keywords" content="CodeGraph, documentation, reference">

  <meta property="og:title" content="Кулинарная книга SQL-запросов для DuckDB CPG - CodeGraph">
  <meta property="og:description" content="CodeGraph documentation: Кулинарная книга SQL-запросов для DuckDB CPG">
  <meta property="og:type" content="article">

  <title>Кулинарная книга SQL-запросов для DuckDB CPG - CodeGraph Documentation</title>

  <link rel="icon" type="image/svg+xml" href="../../../assets/svg/logo-compact.svg">
  <link rel="stylesheet" href="../../../css/styles.css?v=2">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <nav class="nav container">
      <a href="../../../" class="logo">
        <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
      </a>

      <ul class="nav-list">
        <li><a href="../../../index.html#problems" class="nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="nav-link active">Документация</a></li>
        <li><a href="../../../index.html#faq" class="nav-link">FAQ</a></li>
      </ul>

      <div class="header-actions">
        <div class="lang-switcher">
          <a href="../../en/reference/SQL_QUERY_COOKBOOK.html" class="">EN</a>
          <a href="../../ru/reference/SQL_QUERY_COOKBOOK.html" class="active">RU</a>
        </div>
        <button class="theme-toggle" aria-label="Переключить тему">
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="../../../index.html#demo" class="btn btn-primary">Запросить демо</a>
      </div>

      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </nav>
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        <li><a href="../../../index.html#problems" class="mobile-nav-link">Проблемы</a></li>
        <li><a href="../../../index.html#solution" class="mobile-nav-link">Решение</a></li>
        <li><a href="../../../index.html#features" class="mobile-nav-link">Возможности</a></li>
        <li><a href="../../../index.html#integrations" class="mobile-nav-link">Интеграции</a></li>
        <li><a href="../index.html" class="mobile-nav-link">Документация</a></li>
        <li><a href="../../../index.html#faq" class="mobile-nav-link">FAQ</a></li>
        <li><a href="../../../index.html#demo" class="btn btn-primary mobile-nav-demo-btn">Запросить демо</a></li>
      </ul>
    </nav>
  </header>

  <div class="doc-layout">
    <!-- Sidebar Navigation -->
    <aside class="doc-sidebar">
      
    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Начало работы</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../getting-started/index.html">Обзор</a></li>
        <li><a href="../getting-started/CONFIGURATION.html">Руководство по настройке</a></li>
        <li><a href="../getting-started/INSTALLATION.html">Руководство по установке</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Руководства</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../guides/index.html">Обзор</a></li>
        <li><a href="../guides/BENCHMARK_GUIDE.html">Руководство по тестовой платформе</a></li>
        <li><a href="../guides/CLI_GUIDE.html">Руководство по CLI</a></li>
        <li><a href="../guides/CODE_REVIEW.html">Система автоматического код-ревью на основе патчей</a></li>
        <li><a href="../guides/CPG_EXPORT.html">Руководство по экспорту CPG</a></li>
        <li><a href="../guides/MONITORING.html">Руководство по мониторингу</a></li>
        <li><a href="../guides/PROGRAMMATIC_GUIDE.html">Руководство пользователя</a></li>
        <li><a href="../guides/PROJECT_IMPORT.html">Импорт новой кодовой базы</a></li>
        <li><a href="../guides/QUICK_REFERENCE.html">Краткое руководство по CodeGraph</a></li>
        <li><a href="../guides/REFACTORING.html">Руководство по анализу рефакторинга</a></li>
        <li><a href="../guides/SCENARIOS.html">Руководство по сценариям рабочих процессов</a></li>
        <li><a href="../guides/TROUBLESHOOTING.html">Руководство по устранению неполадок</a></li>
        <li><a href="../guides/TUI_USER_GUIDE.html">Руководство пользователя CodeGraph</a></li>
        <li><a href="../guides/01-onboarding.html">Сценарий 01: Ввод нового разработчика</a></li>
        <li><a href="../guides/02-security-audit.html">Сценарий 02: Аудит безопасности</a></li>
        <li><a href="../guides/03-documentation.html">Сценарий 03: Генерация документации</a></li>
        <li><a href="../guides/04-feature-development.html">Сценарий 04: Разработка функций</a></li>
        <li><a href="../guides/05-refactoring.html">Сценарий 05: Рефакторинг</a></li>
        <li><a href="../guides/06-performance.html">Сценарий 06: Анализ производительности</a></li>
        <li><a href="../guides/07-test-coverage.html">Сценарий 07: Покрытие тестами</a></li>
        <li><a href="../guides/08-compliance.html">Сценарий 08: Проверка соответствия требованиям</a></li>
        <li><a href="../guides/09-code-review.html">Сценарий 09: Код-ревью</a></li>
        <li><a href="../guides/10-cross-repo.html">Сценарий 10: Анализ между репозиториями</a></li>
        <li><a href="../guides/11-architecture.html">Сценарий 11: Анализ архитектуры</a></li>
        <li><a href="../guides/12-tech-debt.html">Сценарий 12: Оценка технического долга</a></li>
        <li><a href="../guides/13-mass-refactoring.html">Сценарий 13: Массовая рефакторизация</a></li>
        <li><a href="../guides/14-incident-response.html">Сценарий 14: Реагирование на инциденты безопасности</a></li>
        <li><a href="../guides/15-debugging.html">Сценарий 15: Помощь в отладке</a></li>
        <li><a href="../guides/16-entry-points.html">Сценарий 16: Обнаружение точки входа</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">API Документация</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../api/index.html">Обзор</a></li>
        <li><a href="../api/REST_API.html">Документация по REST API CodeGraph</a></li>
        <li><a href="../api/WEBSOCKET_API.html">Справочная документация по WebSocket API</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Интеграции</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../integrations/index.html">Обзор</a></li>
        <li><a href="../integrations/GIGACHAT.html">Руководство по интеграции GigaChat</a></li>
        <li><a href="../integrations/YANDEX_AI_STUDIO.html">Руководство по интеграции Yandex AI Studio</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Справочник</div>
      <ul class="doc-sidebar-nav">
        <li><a href="index.html">Обзор</a></li>
        <li><a href="AGENTS.html">Справочник агентов</a></li>
        <li><a href="ANALYSIS_MODULES.html">Справочник модулей анализа</a></li>
        <li><a href="API.html">Справочник API</a></li>
        <li><a href="HYPOTHESIS_SYSTEM.html">Справочная система гипотез</a></li>
        <li><a href="SCHEMA.html">Дизайн схемы DuckDB CPG (CPG Spec v1.1)</a></li>
        <li><a href="SECURITY.html">Модуль корпоративной безопасности</a></li>
        <li><a href="SQL_QUERY_COOKBOOK.html" class="active">Кулинарная книга SQL-запросов для DuckDB CPG</a></li>
        <li><a href="WORKFLOWS.html">Справочник по рабочим процессам</a></li>
      </ul>
    </div>

    <div class="doc-sidebar-section">
      <div class="doc-sidebar-title">Enterprise</div>
      <ul class="doc-sidebar-nav">
        <li><a href="../enterprise/index.html">Обзор</a></li>
      </ul>
    </div>
    </aside>

    <!-- Main Content -->
    <main class="doc-main">
      <!-- Breadcrumb -->
      <nav class="doc-breadcrumb">
        <a href="../index.html">Документация</a>
        <span>/</span>
        <a href="index.html">Справочник</a>
        <span>/</span>
        <span>Кулинарная книга SQL-запросов для DuckDB CPG</span>
      </nav>

      <!-- Hero -->
      <div class="doc-hero">
        <h1>Кулинарная книга SQL-запросов для DuckDB CPG</h1>
        
      </div>

      <!-- Content -->
      <article class="doc-content">
        <h1 id="kulinarnaya-kniga-sql-zaprosov-dlya-duckdb-cpg">Кулинарная книга SQL-запросов для DuckDB CPG<a class="heading-anchor" href="#kulinarnaya-kniga-sql-zaprosov-dlya-duckdb-cpg" title="Link to this section">&para;</a></h1>
<p>Практическая подборка SQL-запросов для типовых задач анализа кода на DuckDB CPG.</p>
<h2 id="soderzhanie">Содержание<a class="heading-anchor" href="#soderzhanie" title="Link to this section">&para;</a></h2>
<ol>
<li><a href="#method-queries">Запросы методов</a></li>
<li><a href="#call-analysis">Анализ вызовов</a></li>
<li><a href="#control-flow">Управление потоком выполнения</a></li>
<li><a href="#data-flow">Поток данных</a></li>
<li><a href="#file-analysis">Анализ файлов</a></li>
<li><a href="#security-patterns">Шаблоны безопасности</a></li>
<li><a href="#code-quality">Качество кода</a></li>
<li><a href="#statistics">Статистика</a></li>
<li><a href="#advanced-patterns">Расширенные шаблоны</a></li>
<li><a href="#sqlpgq-graph-queries">Графовые запросы SQL/PGQ</a></li>
<li><a href="#see-also">См. также</a></li>
</ol>
<h2 id="zaprosy-k-metodam">Запросы к методам<a class="heading-anchor" href="#zaprosy-k-metodam" title="Link to this section">&para;</a></h2>
<h3 id="nayti-metod-po-tochnomu-imeni">Найти метод по точному имени<a class="heading-anchor" href="#nayti-metod-po-tochnomu-imeni" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT id, name, full_name, filename, line_number, signature
FROM nodes_method
WHERE name = &#39;authenticate&#39;
LIMIT 10;
</code></pre></div>

<h3 id="nayti-metody-po-shablonu">Найти методы по шаблону<a class="heading-anchor" href="#nayti-metody-po-shablonu" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT id, name, full_name, filename, line_number
FROM nodes_method
WHERE name LIKE &#39;%process%&#39;
ORDER BY name
LIMIT 50;
</code></pre></div>

<h3 id="metody-po-shablonu-signatury">Методы по шаблону сигнатуры<a class="heading-anchor" href="#metody-po-shablonu-signatury" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT name, full_name, signature, filename
FROM nodes_method
WHERE signature LIKE &#39;%char*%&#39;  -- Методы, принимающие параметр char*
ORDER BY name
LIMIT 100;
</code></pre></div>

<h3 id="vneshnie-i-vnutrennie-metody">Внешние и внутренние методы<a class="heading-anchor" href="#vneshnie-i-vnutrennie-metody" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Внешние методы (из библиотек)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">full_name</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="err">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">true</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">full_name</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>

<span class="c1">-- Внутренние методы (ваш код)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="err">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">method_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">filename</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">method_count</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="metody-po-kolichestvu-strok">Методы по количеству строк<a class="heading-anchor" href="#metody-po-kolichestvu-strok" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">line_number</span><span class="p">,</span>
<span class="w">    </span><span class="n">line_number_end</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="n">line_number_end</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="n">line_number</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">lines_of_code</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">line_number_end</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">line_number_end</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="n">line_number</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w">  </span><span class="c1">-- Длинные методы</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">lines_of_code</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h2 id="call-analysis">Анализ вызовов<a class="heading-anchor" href="#call-analysis" title="Link to this section">&para;</a></h2>
<h3 id="pryamye-vyzyvaemye-funktsii-kakie-funktsii-vyzyvaet-x">Прямые вызываемые функции (Какие функции вызывает X?)<a class="heading-anchor" href="#pryamye-vyzyvaemye-funktsii-kakie-funktsii-vyzyvaet-x" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">    </span><span class="n">callee</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">callee</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">callee</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">callee</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">callee</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">callee</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">callee</span><span class="p">.</span><span class="k">name</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="pryamye-vyzyvayuschie-funktsii-kto-vyzyvaet-x">Прямые вызывающие функции (Кто вызывает X?)<a class="heading-anchor" href="#pryamye-vyzyvayuschie-funktsii-kto-vyzyvaet-x" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">    </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">caller</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">caller</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">caller</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">callee</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">callee</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">callee</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;malloc&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="tsepochka-vyzovov-tranzitivnye-vyzyvaemye-funktsii">Цепочка вызовов (транзитивные вызываемые функции)<a class="heading-anchor" href="#tsepochka-vyzovov-tranzitivnye-vyzyvaemye-funktsii" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">WITH</span><span class="w"> </span><span class="nt">RECURSIVE</span><span class="w"> </span><span class="nt">call_chain</span><span class="w"> </span><span class="nt">AS</span><span class="w"> </span><span class="o">(</span>
<span class="w">    </span><span class="nt">--</span><span class="w"> </span><span class="nt">Базовый</span><span class="w"> </span><span class="nt">случай</span><span class="o">:</span><span class="w"> </span><span class="nt">прямые</span><span class="w"> </span><span class="nt">вызовы</span><span class="w"> </span><span class="nt">из</span><span class="w"> </span><span class="nt">начальной</span><span class="w"> </span><span class="nt">функции</span>
<span class="w">    </span><span class="nt">SELECT</span>
<span class="w">        </span><span class="nt">ec</span><span class="p">.</span><span class="nc">dst</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">method_id</span><span class="o">,</span>
<span class="w">        </span><span class="nt">1</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">depth</span><span class="o">,</span>
<span class="w">        </span><span class="nt">m_start</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">start_method</span>
<span class="w">    </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">edges_call</span><span class="w"> </span><span class="nt">ec</span>
<span class="w">    </span><span class="nt">JOIN</span><span class="w"> </span><span class="nt">nodes_call</span><span class="w"> </span><span class="nt">c</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">ec</span><span class="p">.</span><span class="nc">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">c</span><span class="p">.</span><span class="nc">id</span>
<span class="w">    </span><span class="nt">JOIN</span><span class="w"> </span><span class="nt">nodes_method</span><span class="w"> </span><span class="nt">m_start</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">c</span><span class="p">.</span><span class="nc">method_full_name</span><span class="w"> </span><span class="nt">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nt">m_start</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">    </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">m_start</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>

<span class="w">    </span><span class="nt">UNION</span><span class="w"> </span><span class="nt">ALL</span>

<span class="w">    </span><span class="nt">--</span><span class="w"> </span><span class="nt">Рекурсивный</span><span class="w"> </span><span class="nt">случай</span><span class="o">:</span><span class="w"> </span><span class="nt">продолжаем</span><span class="w"> </span><span class="nt">цепочку</span>
<span class="w">    </span><span class="nt">SELECT</span>
<span class="w">        </span><span class="nt">ec2</span><span class="p">.</span><span class="nc">dst</span><span class="o">,</span>
<span class="w">        </span><span class="nt">cc</span><span class="p">.</span><span class="nc">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span>
<span class="w">        </span><span class="nt">cc</span><span class="p">.</span><span class="nc">start_method</span>
<span class="w">    </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">edges_call</span><span class="w"> </span><span class="nt">ec2</span>
<span class="w">    </span><span class="nt">JOIN</span><span class="w"> </span><span class="nt">nodes_call</span><span class="w"> </span><span class="nt">c2</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">ec2</span><span class="p">.</span><span class="nc">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">c2</span><span class="p">.</span><span class="nc">id</span>
<span class="w">    </span><span class="nt">JOIN</span><span class="w"> </span><span class="nt">nodes_method</span><span class="w"> </span><span class="nt">m2</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">c2</span><span class="p">.</span><span class="nc">method_full_name</span><span class="w"> </span><span class="nt">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nt">m2</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">    </span><span class="nt">JOIN</span><span class="w"> </span><span class="nt">call_chain</span><span class="w"> </span><span class="nt">cc</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">m2</span><span class="p">.</span><span class="nc">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">cc</span><span class="p">.</span><span class="nc">method_id</span>
<span class="w">    </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">cc</span><span class="p">.</span><span class="nc">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nt">5</span>
<span class="o">)</span>
<span class="nt">SELECT</span><span class="w"> </span><span class="nt">DISTINCT</span>
<span class="w">    </span><span class="nt">m</span><span class="p">.</span><span class="nc">name</span><span class="o">,</span>
<span class="w">    </span><span class="nt">m</span><span class="p">.</span><span class="nc">full_name</span><span class="o">,</span>
<span class="w">    </span><span class="nt">MIN</span><span class="o">(</span><span class="nt">cc</span><span class="p">.</span><span class="nc">depth</span><span class="o">)</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">min_depth</span>
<span class="nt">FROM</span><span class="w"> </span><span class="nt">call_chain</span><span class="w"> </span><span class="nt">cc</span>
<span class="nt">JOIN</span><span class="w"> </span><span class="nt">nodes_method</span><span class="w"> </span><span class="nt">m</span><span class="w"> </span><span class="nt">ON</span><span class="w"> </span><span class="nt">cc</span><span class="p">.</span><span class="nc">method_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">m</span><span class="p">.</span><span class="nc">id</span>
<span class="nt">GROUP</span><span class="w"> </span><span class="nt">BY</span><span class="w"> </span><span class="nt">m</span><span class="p">.</span><span class="nc">id</span><span class="o">,</span><span class="w"> </span><span class="nt">m</span><span class="p">.</span><span class="nc">name</span><span class="o">,</span><span class="w"> </span><span class="nt">m</span><span class="p">.</span><span class="nc">full_name</span>
<span class="nt">ORDER</span><span class="w"> </span><span class="nt">BY</span><span class="w"> </span><span class="nt">min_depth</span><span class="o">,</span><span class="w"> </span><span class="nt">m</span><span class="p">.</span><span class="nc">name</span>
<span class="nt">LIMIT</span><span class="w"> </span><span class="nt">100</span><span class="o">;</span>
</code></pre></div>

<h3 id="naibolee-aktivnye-vyzyvayuschie-funktsii-funktsii-sovershayuschie-naibolshee-chislo-vyzovov">Наиболее активные вызывающие функции (функции, совершающие наибольшее число вызовов)<a class="heading-anchor" href="#naibolee-aktivnye-vyzyvayuschie-funktsii-funktsii-sovershayuschie-naibolshee-chislo-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">outgoing_calls</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">outgoing_calls</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="naibolee-chasto-vyzyvaemye-funktsii">Наиболее часто вызываемые функции<a class="heading-anchor" href="#naibolee-chasto-vyzyvaemye-funktsii" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">incoming_calls</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">incoming_calls</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="pary-vyzovov-chastye-shablony-vyzyvayuschiy-vyzyvaemyy">Пары вызовов (частые шаблоны «вызывающий — вызываемый»)<a class="heading-anchor" href="#pary-vyzovov-chastye-shablony-vyzyvayuschiy-vyzyvaemyy" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT
    caller.name as caller,
    callee.name as callee,
    COUNT(*) as frequency
FROM edges_call ec
JOIN nodes_call c ON ec.src = c.id
JOIN nodes_method caller ON c.method_full_name LIKE &#39;%&#39; || caller.name || &#39;%&#39;
JOIN nodes_method callee ON ec.dst = callee.id
GROUP BY caller.name, callee.name
ORDER BY frequency DESC
LIMIT 50;
</code></pre></div>

<h3 id="listovye-funktsii-funktsii-bez-ishodyaschih-vyzovov">Листовые функции (функции без исходящих вызовов)<a class="heading-anchor" href="#listovye-funktsii-funktsii-bez-ishodyaschih-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="kornevye-funktsii-funktsii-kotorye-nikto-ne-vyzyvaet">Корневые функции (функции, которые никто не вызывает)<a class="heading-anchor" href="#kornevye-funktsii-funktsii-kotorye-nikto-ne-vyzyvaet" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h2 id="control-flow">Управление потоком выполнения<a class="heading-anchor" href="#control-flow" title="Link to this section">&para;</a></h2>
<h3 id="metody-s-vetvleniyami">Методы с ветвлениями<a class="heading-anchor" href="#metody-s-vetvleniyami" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Найти</span><span class="w"> </span><span class="nx">методы</span><span class="p">,</span><span class="w"> </span><span class="nx">содержащие</span><span class="w"> </span><span class="nx">структуры</span><span class="w"> </span><span class="nx">IF</span><span class="o">/</span><span class="nx">SWITCH</span><span class="p">,</span><span class="w"> </span><span class="nx">через</span><span class="w"> </span><span class="nx">AST</span>
<span class="nx">SELECT</span><span class="w"> </span><span class="nx">DISTINCT</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nx">COUNT</span><span class="p">(</span><span class="nx">DISTINCT</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">branch_count</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">nodes_method</span><span class="w"> </span><span class="nx">m</span>
<span class="nx">JOIN</span><span class="w"> </span><span class="nx">edges_ast</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="nx">ON</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ast</span><span class="p">.</span><span class="nx">src</span>
<span class="nx">JOIN</span><span class="w"> </span><span class="nx">nodes_control_structure</span><span class="w"> </span><span class="nx">cs</span><span class="w"> </span><span class="nx">ON</span><span class="w"> </span><span class="nx">ast</span><span class="p">.</span><span class="nx">dst</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">id</span>
<span class="nx">WHERE</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">control_structure_type</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="nx">IF</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">SWITCH</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">GROUP</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">filename</span>
<span class="nx">ORDER</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="nx">branch_count</span><span class="w"> </span><span class="nx">DESC</span>
<span class="nx">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="metody-s-tsiklami">Методы с циклами<a class="heading-anchor" href="#metody-s-tsiklami" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Найти</span><span class="w"> </span><span class="nx">методы</span><span class="p">,</span><span class="w"> </span><span class="nx">содержащие</span><span class="w"> </span><span class="nx">структуры</span><span class="w"> </span><span class="nx">циклов</span><span class="p">,</span><span class="w"> </span><span class="nx">через</span><span class="w"> </span><span class="nx">AST</span>
<span class="nx">SELECT</span><span class="w"> </span><span class="nx">DISTINCT</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nx">COUNT</span><span class="p">(</span><span class="nx">DISTINCT</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">loop_count</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">nodes_method</span><span class="w"> </span><span class="nx">m</span>
<span class="nx">JOIN</span><span class="w"> </span><span class="nx">edges_ast</span><span class="w"> </span><span class="nx">ast</span><span class="w"> </span><span class="nx">ON</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ast</span><span class="p">.</span><span class="nx">src</span>
<span class="nx">JOIN</span><span class="w"> </span><span class="nx">nodes_control_structure</span><span class="w"> </span><span class="nx">cs</span><span class="w"> </span><span class="nx">ON</span><span class="w"> </span><span class="nx">ast</span><span class="p">.</span><span class="nx">dst</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">id</span>
<span class="nx">WHERE</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">control_structure_type</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="nx">WHILE</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">FOR</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">DO</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">GROUP</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">filename</span>
<span class="nx">ORDER</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="nx">loop_count</span><span class="w"> </span><span class="nx">DESC</span>
<span class="nx">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="priblizhyonnaya-otsenka-tsiklomaticheskoy-slozhnosti">Приближённая оценка цикломатической сложности<a class="heading-anchor" href="#priblizhyonnaya-otsenka-tsiklomaticheskoy-slozhnosti" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Оценка сложности по количеству управляющих структур</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">cs</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">approx_complexity</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">edges_ast</span><span class="w"> </span><span class="n">ast</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">src</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_control_structure</span><span class="w"> </span><span class="n">cs</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ast</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">cs</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">approx_complexity</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
</code></pre></div>

<h3 id="obhod-grafa-potoka-upravleniya-sqlpgq">Обход графа потока управления (SQL/PGQ)<a class="heading-anchor" href="#obhod-grafa-potoka-upravleniya-sqlpgq" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Следование</span><span class="w"> </span><span class="nx">по</span><span class="w"> </span><span class="nx">рёбрам</span><span class="w"> </span><span class="nx">CFG</span><span class="w"> </span><span class="nx">с</span><span class="w"> </span><span class="nx">использованием</span><span class="w"> </span><span class="nx">графа</span><span class="w"> </span><span class="nx">свойств</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">GRAPH_TABLE</span><span class="p">(</span><span class="nx">cpg</span>
<span class="w">    </span><span class="nx">MATCH</span><span class="w"> </span><span class="p">(</span><span class="nx">start</span><span class="p">:</span><span class="nx">METHOD</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="nx">CFG</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="m m-Double">.10</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="nx">node</span><span class="p">:</span><span class="nx">CPG_NODE</span><span class="p">)</span>
<span class="w">    </span><span class="nx">WHERE</span><span class="w"> </span><span class="nx">start</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">process_request</span><span class="err">&#39;</span>
<span class="w">    </span><span class="nx">COLUMNS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nx">start</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">method_name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">node_id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">node</span><span class="p">.</span><span class="nx">node_type</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
<span class="nx">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h2 id="data-flow">Поток данных<a class="heading-anchor" href="#data-flow" title="Link to this section">&para;</a></h2>
<h3 id="puti-potoka-peremennyh">Пути потока переменных<a class="heading-anchor" href="#puti-potoka-peremennyh" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">WITH</span><span class="w"> </span><span class="n">RECURSIVE</span><span class="w"> </span><span class="n">var_flow</span><span class="w"> </span><span class="n">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="err">Базовый</span><span class="w"> </span><span class="err">случай</span><span class="p">:</span><span class="w"> </span><span class="err">начальные</span><span class="w"> </span><span class="err">определения</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">depth</span>
<span class="w">    </span><span class="n">FROM</span><span class="w"> </span><span class="n">edges_reaching_def</span>
<span class="w">    </span><span class="n">WHERE</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;password&#39;</span>

<span class="w">    </span><span class="n">UNION</span><span class="w"> </span><span class="n">ALL</span>

<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="err">Рекурсивный</span><span class="w"> </span><span class="err">случай</span><span class="p">:</span><span class="w"> </span><span class="err">продолжение</span><span class="w"> </span><span class="err">потока</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">erd</span><span class="o">.</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">erd</span><span class="o">.</span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">erd</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">vf</span><span class="o">.</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">FROM</span><span class="w"> </span><span class="n">edges_reaching_def</span><span class="w"> </span><span class="n">erd</span>
<span class="w">    </span><span class="n">JOIN</span><span class="w"> </span><span class="n">var_flow</span><span class="w"> </span><span class="n">vf</span><span class="w"> </span><span class="n">ON</span><span class="w"> </span><span class="n">erd</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vf</span><span class="o">.</span><span class="n">dst</span>
<span class="w">    </span><span class="n">WHERE</span><span class="w"> </span><span class="n">vf</span><span class="o">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">SELECT</span>
<span class="w">    </span><span class="n">variable</span><span class="p">,</span>
<span class="w">    </span><span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="w"> </span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">definition_points</span><span class="p">,</span>
<span class="w">    </span><span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="w"> </span><span class="n">dst</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">use_points</span><span class="p">,</span>
<span class="w">    </span><span class="n">MAX</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">max_depth</span>
<span class="n">FROM</span><span class="w"> </span><span class="n">var_flow</span>
<span class="n">GROUP</span><span class="w"> </span><span class="n">BY</span><span class="w"> </span><span class="n">variable</span><span class="p">;</span>
</code></pre></div>

<h3 id="zagryaznyonnye-parametry">Загрязнённые параметры<a class="heading-anchor" href="#zagryaznyonnye-parametry" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Методы</span><span class="p">,</span><span class="w"> </span><span class="nx">получающие</span><span class="w"> </span><span class="nx">загрязнённые</span><span class="w"> </span><span class="nx">входные</span><span class="w"> </span><span class="nx">данные</span>
<span class="nx">SELECT</span><span class="w"> </span><span class="nx">DISTINCT</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">parameter_name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">type_full_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">parameter_type</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">nodes_method</span><span class="w"> </span><span class="nx">m</span>
<span class="nx">JOIN</span><span class="w"> </span><span class="nx">nodes_param</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="nx">ON</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">method_full_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">full_name</span>
<span class="nx">WHERE</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="nx">userInput</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">request</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">input</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">data</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">ORDER</span><span class="w"> </span><span class="nx">BY</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">name</span>
<span class="nx">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</code></pre></div>

<h2 id="file-analysis">Анализ файлов<a class="heading-anchor" href="#file-analysis" title="Link to this section">&para;</a></h2>
<h3 id="metody-po-faylam">Методы по файлам<a class="heading-anchor" href="#metody-po-faylam" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">SELECT</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">as</span> <span class="n">method_count</span><span class="p">,</span>
    <span class="n">SUM</span><span class="p">(</span><span class="kr">CASE</span> <span class="n">WHEN</span> <span class="n">is_external</span> <span class="kr">THEN</span> <span class="mi">1</span> <span class="kr">ELSE</span> <span class="mi">0</span> <span class="kr">END</span><span class="p">)</span> <span class="n">as</span> <span class="n">external_methods</span><span class="p">,</span>
    <span class="n">SUM</span><span class="p">(</span><span class="kr">CASE</span> <span class="n">WHEN</span> <span class="n">is_external</span> <span class="kr">THEN</span> <span class="mi">0</span> <span class="kr">ELSE</span> <span class="mi">1</span> <span class="kr">END</span><span class="p">)</span> <span class="n">as</span> <span class="n">internal_methods</span>
<span class="n">FROM</span> <span class="n">nodes_method</span>
<span class="n">GROUP</span> <span class="kr">BY</span> <span class="n">filename</span>
<span class="n">ORDER</span> <span class="kr">BY</span> <span class="n">method_count</span> <span class="n">DESC</span>
<span class="n">LIMIT</span> <span class="mi">30</span><span class="p">;</span>
</code></pre></div>

<h3 id="fayly-po-aktivnosti-vyzovov">Файлы по активности вызовов<a class="heading-anchor" href="#fayly-po-aktivnosti-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_calls</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unique_calls</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_calls</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="vyzovy-mezhdu-faylami">Вызовы между файлами<a class="heading-anchor" href="#vyzovy-mezhdu-faylami" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT
    caller.filename as from_file,
    callee.filename as to_file,
    COUNT(*) as call_count
FROM edges_call ec
JOIN nodes_call c ON ec.src = c.id
JOIN nodes_method caller ON c.method_full_name LIKE &#39;%&#39; || caller.name || &#39;%&#39;
JOIN nodes_method callee ON ec.dst = callee.id
WHERE caller.filename != callee.filename
GROUP BY caller.filename, callee.filename
ORDER BY call_count DESC
LIMIT 50;
</code></pre></div>

<h2 id="security-patterns">Шаблоны безопасности<a class="heading-anchor" href="#security-patterns" title="Link to this section">&para;</a></h2>
<h3 id="problemy-upravleniya-pamyatyu">Проблемы управления памятью<a class="heading-anchor" href="#problemy-upravleniya-pamyatyu" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Методы, которые вызывают malloc, но не вызывают free</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;malloc&#39;</span>
<span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;free&#39;</span>
<span class="p">)</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</code></pre></div>

<h3 id="opasnye-vyzovy-funktsiy">Опасные вызовы функций<a class="heading-anchor" href="#opasnye-vyzovy-funktsiy" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">caller</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">dangerous_function</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;strcpy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sprintf&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;system&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eval&#39;</span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">line_number</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="kandidaty-na-sql-inektsiyu">Кандидаты на SQL-инъекцию<a class="heading-anchor" href="#kandidaty-na-sql-inektsiyu" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="c1">-- Есть вызовы, связанные с SQL</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%query%&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%execute%&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="c1">-- Получает пользовательский ввод</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_param</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%input%&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%request%&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</code></pre></div>

<h3 id="kandidaty-na-obhod-autentifikatsii">Кандидаты на обход аутентификации<a class="heading-anchor" href="#kandidaty-na-obhod-autentifikatsii" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%auth%&#39;</span>
<span class="w">  </span><span class="k">OR</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%login%&#39;</span>
<span class="w">  </span><span class="k">OR</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%verify%&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h2 id="code-quality">Качество кода<a class="heading-anchor" href="#code-quality" title="Link to this section">&para;</a></h2>
<h3 id="bogatye-metody-slishkom-dlinnye">Богатые методы (слишком длинные)<a class="heading-anchor" href="#bogatye-metody-slishkom-dlinnye" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="n">line_number</span><span class="p">,</span>
<span class="w">    </span><span class="n">line_number_end</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="n">line_number_end</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="n">line_number</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">loc</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">line_number_end</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">line_number_end</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="n">line_number</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="mi">100</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="vysokiy-fan-out-slishkom-mnogo-vyzovov">Высокий fan-out (слишком много вызовов)<a class="heading-anchor" href="#vysokiy-fan-out-slishkom-mnogo-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">fan_out</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">HAVING</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="mi">10</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">fan_out</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="vysokiy-fan-in-slishkom-mnogo-vyzyvayuschih">Высокий fan-in (слишком много вызывающих)<a class="heading-anchor" href="#vysokiy-fan-in-slishkom-mnogo-vyzyvayuschih" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">fan_in</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">HAVING</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="mi">10</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">fan_in</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>

<h3 id="neispolzuemye-metody-potentsialnyy-myortvyy-kod">Неиспользуемые методы (потенциальный мёртвый код)<a class="heading-anchor" href="#neispolzuemye-metody-potentsialnyy-myortvyy-kod" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;test%&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Исключаем точки входа</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h2 id="statistics">Статистика<a class="heading-anchor" href="#statistics" title="Link to this section">&para;</a></h2>
<h3 id="obzor-cpg">Обзор CPG<a class="heading-anchor" href="#obzor-cpg" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SELECT
    (SELECT COUNT(*) FROM nodes_method) as total_methods,
    (SELECT COUNT(*) FROM nodes_method WHERE is_external = false) as internal_methods,
    (SELECT COUNT(*) FROM nodes_call) as total_calls,
    (SELECT COUNT(*) FROM edges_call) as call_edges,
    (SELECT COUNT(DISTINCT filename) FROM nodes_method) as file_count;
</code></pre></div>

<h3 id="raspredelenie-vyzovov">Распределение вызовов<a class="heading-anchor" href="#raspredelenie-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">call_count_bucket</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="err">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">methods_in_bucket</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">call_count</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;0 вызовов&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">call_count</span><span class="w"> </span><span class="err">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;1-5 вызовов&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">call_count</span><span class="w"> </span><span class="err">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;6-10 вызовов&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">call_count</span><span class="w"> </span><span class="err">&lt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;11-20 вызовов&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;20+ вызовов&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">call_count_bucket</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">m2</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">call_count</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m2</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m2</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m2</span><span class="p">.</span><span class="n">id</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">counts</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">call_count_bucket</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="n">call_count_bucket</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;0 вызовов&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;1-5 вызовов&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;6-10 вызовов&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;11-20 вызовов&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="k">END</span><span class="p">;</span>
</code></pre></div>

<h3 id="raspredelenie-yazykov-po-rasshireniyu-fayla">Распределение языков (по расширению файла)<a class="heading-anchor" href="#raspredelenie-yazykov-po-rasshireniyu-fayla" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.c&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;C&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.cpp&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.cc&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;C++&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.java&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Java&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.py&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Python&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%.js&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;JavaScript&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Другое&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">language</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="err">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">method_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">language</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">method_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<h3 id="slozhnost-signatur-metodov">Сложность сигнатур методов<a class="heading-anchor" href="#slozhnost-signatur-metodov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">signature</span><span class="p">,</span>
<span class="w">    </span><span class="nf">LENGTH</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">signature</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sig_length</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="nf">LENGTH</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">signature</span><span class="p">)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="nf">LENGTH</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">signature</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)))</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">param_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">signature</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">is_external</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">false</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">param_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">sig_length</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
</code></pre></div>

<h2 id="advanced-patterns">Расширенные шаблоны<a class="heading-anchor" href="#advanced-patterns" title="Link to this section">&para;</a></h2>
<h3 id="poisk-tsepochek-vyzovov-metodov-a-b-c">Поиск цепочек вызовов методов (A → B → C)<a class="heading-anchor" href="#poisk-tsepochek-vyzovov-metodov-a-b-c" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">method_a</span><span class="p">,</span>
<span class="w">        </span><span class="n">intermediate</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">method_b</span><span class="p">,</span>
<span class="w">        </span><span class="n">callee</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">method_c</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec1</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec1</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">id</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec1</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">intermediate</span><span class="p">.</span><span class="n">id</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">intermediate</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ec2</span><span class="p">.</span><span class="n">src</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">callee</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec2</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">callee</span><span class="p">.</span><span class="n">id</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">method_a</span><span class="p">,</span><span class="w"> </span><span class="n">method_b</span><span class="p">,</span><span class="w"> </span><span class="n">method_c</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">chain</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="svyaznye-komponenty-klastery-metodov">Связные компоненты (кластеры методов)<a class="heading-anchor" href="#svyaznye-komponenty-klastery-metodov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Найти методы в одном графе вызовов</span>
<span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">root</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>

<span class="w">    </span><span class="k">UNION</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">root</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">edges_call</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">m2</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes_method</span><span class="w"> </span><span class="n">m2</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">nodes_call</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">nc</span><span class="p">.</span><span class="n">method_full_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">m2</span><span class="p">.</span><span class="k">name</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="s1">&#39;%&#39;</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">nc</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">dst</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">ec</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">root</span><span class="p">,</span>
<span class="w">    </span><span class="nf">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">component_size</span><span class="p">,</span>
<span class="w">    </span><span class="nf">STRING_AGG</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">methods</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">component</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">root</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component_size</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<h2 id="sovety-po-ispolzovaniyu">Советы по использованию<a class="heading-anchor" href="#sovety-po-ispolzovaniyu" title="Link to this section">&para;</a></h2>
<ol>
<li><strong>Всегда добавляйте LIMIT</strong>, чтобы избежать возврата миллионов строк</li>
<li><strong>Используйте конкретные столбцы</strong> вместо SELECT *</li>
<li><strong>Сначала тестируйте на небольших наборах данных</strong></li>
<li><strong>Добавляйте условия WHERE</strong>, чтобы отфильтровать нерелевантные результаты</li>
<li><strong>Используйте EXPLAIN</strong> для проверки планов выполнения запросов</li>
<li><strong>Контролируйте время выполнения</strong> (для большинства запросов должно быть &lt; 100 мс)</li>
</ol>
<h2 id="zametki-o-proizvoditelnosti">Заметки о производительности<a class="heading-anchor" href="#zametki-o-proizvoditelnosti" title="Link to this section">&para;</a></h2>
<ul>
<li>Простые запросы: 1–3 мс</li>
<li>JOIN’ы (1–2 таблицы): 2–5 мс</li>
<li>Агрегации: 4–8 мс</li>
<li>Рекурсивные CTE: 10–50 мс (зависит от глубины)</li>
</ul>
<p>Все запросы выполнялись на тестовой базе данных с 5 методами и 4 вызовами.</p>
<p>Производительность растёт сублинейно с увеличением объёма данных благодаря использованию индексов.</p>
<h2 id="sqlpgq-graph-queries">Графовые запросы на SQL/PGQ<a class="heading-anchor" href="#sqlpgq-graph-queries" title="Link to this section">&para;</a></h2>
<p>Расширение SQL/PGQ в DuckDB позволяет выполнять интуитивные запросы для обхода графов.</p>
<h3 id="obhod-grafa-vyzovov">Обход графа вызовов<a class="heading-anchor" href="#obhod-grafa-vyzovov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">--</span><span class="w"> </span><span class="nt">Найти</span><span class="w"> </span><span class="nt">все</span><span class="w"> </span><span class="nt">методы</span><span class="o">,</span><span class="w"> </span><span class="nt">вызываемые</span><span class="w"> </span><span class="nt">из</span><span class="w"> </span><span class="nt">main</span><span class="w"> </span><span class="o">(</span><span class="nt">прямые</span><span class="w"> </span><span class="nt">и</span><span class="w"> </span><span class="nt">косвенные</span><span class="o">)</span>
<span class="nt">FROM</span><span class="w"> </span><span class="nt">GRAPH_TABLE</span><span class="o">(</span><span class="nt">cpg</span>
<span class="w">    </span><span class="nt">MATCH</span><span class="w"> </span><span class="o">(</span><span class="nt">caller</span><span class="p">:</span><span class="nd">METHOD</span><span class="o">)</span><span class="nt">-</span><span class="cp">[</span><span class="p">:</span><span class="nx">CALLS</span><span class="o">*</span><span class="mi">1</span><span class="nx">..3</span><span class="cp">]</span><span class="nt">-</span><span class="o">&gt;(</span><span class="nt">callee</span><span class="p">:</span><span class="nd">METHOD</span><span class="o">)</span>
<span class="w">    </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">caller</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;main&#39;</span>
<span class="w">    </span><span class="nt">COLUMNS</span><span class="w"> </span><span class="o">(</span>
<span class="w">        </span><span class="nt">caller</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="nt">AS</span><span class="w"> </span><span class="nt">caller</span><span class="o">,</span>
<span class="w">        </span><span class="nt">callee</span><span class="p">.</span><span class="nc">name</span><span class="w"> </span><span class="nt">AS</span><span class="w"> </span><span class="nt">callee</span><span class="o">,</span>
<span class="w">        </span><span class="nt">callee</span><span class="p">.</span><span class="nc">filename</span>
<span class="w">    </span><span class="o">)</span>
<span class="o">)</span>
<span class="nt">LIMIT</span><span class="w"> </span><span class="nt">100</span><span class="o">;</span>
</code></pre></div>

<h3 id="analiz-potoka-dannyh">Анализ потока данных<a class="heading-anchor" href="#analiz-potoka-dannyh" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="err">Отслеживание</span><span class="w"> </span><span class="err">потока</span><span class="w"> </span><span class="err">данных</span><span class="w"> </span><span class="err">через</span><span class="w"> </span><span class="err">достижимые</span><span class="w"> </span><span class="err">определения</span>
<span class="n">FROM</span><span class="w"> </span><span class="n">GRAPH_TABLE</span><span class="p">(</span><span class="n">cpg</span>
<span class="w">    </span><span class="n">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">src</span><span class="p">:</span><span class="n">IDENTIFIER</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">REACHING_DEF</span><span class="o">*</span><span class="mf">1.</span><span class="o">.</span><span class="mi">5</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">sink</span><span class="p">:</span><span class="n">CALL_NODE</span><span class="p">)</span>
<span class="w">    </span><span class="n">WHERE</span><span class="w"> </span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user_input&#39;</span>
<span class="w">    </span><span class="n">COLUMNS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="n">AS</span><span class="w"> </span><span class="n">source_var</span><span class="p">,</span>
<span class="w">        </span><span class="n">sink</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="n">AS</span><span class="w"> </span><span class="n">sink_function</span><span class="p">,</span>
<span class="w">        </span><span class="n">sink</span><span class="o">.</span><span class="n">line_number</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
<span class="n">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="obhod-ast">Обход AST<a class="heading-anchor" href="#obhod-ast" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Найти</span><span class="w"> </span><span class="nx">все</span><span class="w"> </span><span class="nx">узлы</span><span class="p">,</span><span class="w"> </span><span class="nx">находящиеся</span><span class="w"> </span><span class="nx">под</span><span class="w"> </span><span class="nx">методом</span><span class="w"> </span><span class="nx">в</span><span class="w"> </span><span class="nx">AST</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">GRAPH_TABLE</span><span class="p">(</span><span class="nx">cpg</span>
<span class="w">    </span><span class="nx">MATCH</span><span class="w"> </span><span class="p">(</span><span class="nx">method</span><span class="p">:</span><span class="nx">METHOD</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="nx">AST</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="m m-Double">.5</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="nx">child</span><span class="p">:</span><span class="nx">CPG_NODE</span><span class="p">)</span>
<span class="w">    </span><span class="nx">WHERE</span><span class="w"> </span><span class="nx">method</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">authenticate</span><span class="err">&#39;</span>
<span class="w">    </span><span class="nx">COLUMNS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nx">method</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">method_name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">child</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">child_id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">child</span><span class="p">.</span><span class="nx">node_type</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
<span class="nx">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>

<h3 id="ierarhiya-tipov">Иерархия типов<a class="heading-anchor" href="#ierarhiya-tipov" title="Link to this section">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="nx">Найти</span><span class="w"> </span><span class="nx">отношения</span><span class="w"> </span><span class="nx">наследования</span>
<span class="nx">FROM</span><span class="w"> </span><span class="nx">GRAPH_TABLE</span><span class="p">(</span><span class="nx">cpg</span>
<span class="w">    </span><span class="nx">MATCH</span><span class="w"> </span><span class="p">(</span><span class="nx">derived</span><span class="p">:</span><span class="nx">TYPE_DECL</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="nx">INHERITS_FROM</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="kd">base</span><span class="p">:</span><span class="nx">TYPE_NODE</span><span class="p">)</span>
<span class="w">    </span><span class="nx">COLUMNS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nx">derived</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">derived_type</span><span class="p">,</span>
<span class="w">        </span><span class="kd">base</span><span class="p">.</span><span class="nx">full_name</span><span class="w"> </span><span class="nx">AS</span><span class="w"> </span><span class="nx">base_type</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="dalneyshie-deystviya">Дальнейшие действия<a class="heading-anchor" href="#dalneyshie-deystviya" title="Link to this section">&para;</a></h2>
<ul>
<li>Попробуйте эти запросы в своей базе данных CPG</li>
<li>Измените параметры в соответствии со своими требованиями</li>
<li>Комбинируйте шаблоны для сложного анализа</li>
<li>Контролируйте производительность и оптимизируйте при необходимости</li>
<li>Добавьте свои собственные шаблоны в эту книгу рецептов!</li>
</ul>
<hr />
<h2 id="smotrite-takzhe">Смотрите также<a class="heading-anchor" href="#smotrite-takzhe" title="Link to this section">&para;</a></h2>
<ul>
<li><a href="./ANALYSIS_MODULES.html">Модули анализа</a> — документация CFGAnalyzer, FieldSensitiveTracer</li>
<li><a href="../guides/CPG_EXPORT.html">Руководство по экспорту CPG</a> — экспорт CPG в DuckDB</li>
<li><a href="./HYPOTHESIS_SYSTEM.html">Система гипотез</a> — генерация гипотез безопасности</li>
<li><a href="https://duckdb.org/docs/extensions/duckpgq">Документация по DuckDB SQL/PGQ</a></li>
<li><a href="https://cpg.joern.io/">Спецификация CPG v1.1</a></li>
</ul>
      </article>

      <!-- Page Navigation -->
      <nav class="doc-page-nav">

      <a href="SCHEMA.html" class="doc-page-nav-prev">
        <span class="doc-page-nav-label">Назад</span>
        <span class="doc-page-nav-title">Дизайн схемы DuckDB CPG (CPG Spec v1.1)</span>
      </a>

      <a href="AGENTS.html" class="doc-page-nav-next">
        <span class="doc-page-nav-label">Вперед</span>
        <span class="doc-page-nav-title">Справочник агентов</span>
      </a>
    </nav>

      <!-- Footer -->
      <footer class="doc-footer">
        <span>Обновлено: 2025-12-25</span>
        <a href="https://github.com/your-org/codegraph/edit/main/docs/reference/SQL_QUERY_COOKBOOK.md" target="_blank" rel="noopener">Редактировать на GitHub</a>
      </footer>
    </main>

    <!-- Table of Contents -->
    <aside class="doc-toc">
      <div class="doc-toc-title">На этой странице</div>
      <ul class="doc-toc-list">
        <li><a href="#kulinarnaya-kniga-sql-zaprosov-dlya-duckdb-cpg" class="level-1">Кулинарная книга SQL-запросов для DuckDB CPG</a></li>
<li><a href="#soderzhanie" class="level-2">Содержание</a></li>
<li><a href="#zaprosy-k-metodam" class="level-2">Запросы к методам</a></li>
<li><a href="#nayti-metod-po-tochnomu-imeni" class="level-3">Найти метод по точному имени</a></li>
<li><a href="#nayti-metody-po-shablonu" class="level-3">Найти методы по шаблону</a></li>
<li><a href="#metody-po-shablonu-signatury" class="level-3">Методы по шаблону сигнатуры</a></li>
<li><a href="#vneshnie-i-vnutrennie-metody" class="level-3">Внешние и внутренние методы</a></li>
<li><a href="#metody-po-kolichestvu-strok" class="level-3">Методы по количеству строк</a></li>
<li><a href="#analiz-vyzovov" class="level-2">Анализ вызовов</a></li>
<li><a href="#pryamye-vyzyvaemye-funktsii-kakie-funktsii-vyzyvaet-x" class="level-3">Прямые вызываемые функции (Какие функции вызывает X?)</a></li>
<li><a href="#pryamye-vyzyvayuschie-funktsii-kto-vyzyvaet-x" class="level-3">Прямые вызывающие функции (Кто вызывает X?)</a></li>
<li><a href="#tsepochka-vyzovov-tranzitivnye-vyzyvaemye-funktsii" class="level-3">Цепочка вызовов (транзитивные вызываемые функции)</a></li>
<li><a href="#naibolee-aktivnye-vyzyvayuschie-funktsii-funktsii-sovershayuschie-naibolshee-chislo-vyzovov" class="level-3">Наиболее активные вызывающие функции (функции, совершающие наибольшее число вызовов)</a></li>
<li><a href="#naibolee-chasto-vyzyvaemye-funktsii" class="level-3">Наиболее часто вызываемые функции</a></li>
<li><a href="#pary-vyzovov-chastye-shablony-vyzyvayuschiy-vyzyvaemyy" class="level-3">Пары вызовов (частые шаблоны «вызывающий — вызываемый»)</a></li>
<li><a href="#listovye-funktsii-funktsii-bez-ishodyaschih-vyzovov" class="level-3">Листовые функции (функции без исходящих вызовов)</a></li>
<li><a href="#kornevye-funktsii-funktsii-kotorye-nikto-ne-vyzyvaet" class="level-3">Корневые функции (функции, которые никто не вызывает)</a></li>
<li><a href="#upravlenie-potokom-vypolneniya" class="level-2">Управление потоком выполнения</a></li>
<li><a href="#metody-s-vetvleniyami" class="level-3">Методы с ветвлениями</a></li>
<li><a href="#metody-s-tsiklami" class="level-3">Методы с циклами</a></li>
<li><a href="#priblizhyonnaya-otsenka-tsiklomaticheskoy-slozhnosti" class="level-3">Приближённая оценка цикломатической сложности</a></li>
<li><a href="#obhod-grafa-potoka-upravleniya-sqlpgq" class="level-3">Обход графа потока управления (SQL/PGQ)</a></li>
<li><a href="#potok-dannyh" class="level-2">Поток данных</a></li>
<li><a href="#puti-potoka-peremennyh" class="level-3">Пути потока переменных</a></li>
<li><a href="#zagryaznyonnye-parametry" class="level-3">Загрязнённые параметры</a></li>
<li><a href="#analiz-faylov" class="level-2">Анализ файлов</a></li>
<li><a href="#metody-po-faylam" class="level-3">Методы по файлам</a></li>
<li><a href="#fayly-po-aktivnosti-vyzovov" class="level-3">Файлы по активности вызовов</a></li>
<li><a href="#vyzovy-mezhdu-faylami" class="level-3">Вызовы между файлами</a></li>
<li><a href="#shablony-bezopasnosti" class="level-2">Шаблоны безопасности</a></li>
<li><a href="#problemy-upravleniya-pamyatyu" class="level-3">Проблемы управления памятью</a></li>
<li><a href="#opasnye-vyzovy-funktsiy" class="level-3">Опасные вызовы функций</a></li>
<li><a href="#kandidaty-na-sql-inektsiyu" class="level-3">Кандидаты на SQL-инъекцию</a></li>
<li><a href="#kandidaty-na-obhod-autentifikatsii" class="level-3">Кандидаты на обход аутентификации</a></li>
<li><a href="#kachestvo-koda" class="level-2">Качество кода</a></li>
<li><a href="#bogatye-metody-slishkom-dlinnye" class="level-3">Богатые методы (слишком длинные)</a></li>
<li><a href="#vysokiy-fan-out-slishkom-mnogo-vyzovov" class="level-3">Высокий fan-out (слишком много вызовов)</a></li>
<li><a href="#vysokiy-fan-in-slishkom-mnogo-vyzyvayuschih" class="level-3">Высокий fan-in (слишком много вызывающих)</a></li>
<li><a href="#neispolzuemye-metody-potentsialnyy-myortvyy-kod" class="level-3">Неиспользуемые методы (потенциальный мёртвый код)</a></li>
<li><a href="#statistika" class="level-2">Статистика</a></li>
<li><a href="#obzor-cpg" class="level-3">Обзор CPG</a></li>
<li><a href="#raspredelenie-vyzovov" class="level-3">Распределение вызовов</a></li>
<li><a href="#raspredelenie-yazykov-po-rasshireniyu-fayla" class="level-3">Распределение языков (по расширению файла)</a></li>
<li><a href="#slozhnost-signatur-metodov" class="level-3">Сложность сигнатур методов</a></li>
<li><a href="#rasshirennye-shablony" class="level-2">Расширенные шаблоны</a></li>
<li><a href="#poisk-tsepochek-vyzovov-metodov-a-b-c" class="level-3">Поиск цепочек вызовов методов (A → B → C)</a></li>
<li><a href="#svyaznye-komponenty-klastery-metodov" class="level-3">Связные компоненты (кластеры методов)</a></li>
<li><a href="#sovety-po-ispolzovaniyu" class="level-2">Советы по использованию</a></li>
<li><a href="#zametki-o-proizvoditelnosti" class="level-2">Заметки о производительности</a></li>
<li><a href="#grafovye-zaprosy-na-sqlpgq" class="level-2">Графовые запросы на SQL/PGQ</a></li>
<li><a href="#obhod-grafa-vyzovov" class="level-3">Обход графа вызовов</a></li>
<li><a href="#analiz-potoka-dannyh" class="level-3">Анализ потока данных</a></li>
<li><a href="#obhod-ast" class="level-3">Обход AST</a></li>
<li><a href="#ierarhiya-tipov" class="level-3">Иерархия типов</a></li>
<li><a href="#dalneyshie-deystviya" class="level-2">Дальнейшие действия</a></li>
<li><a href="#smotrite-takzhe" class="level-2">Смотрите также</a></li>
      </ul>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="../../../assets/svg/logo.svg" alt="CodeGraph" width="160" height="40">
          <p>AI-копилот для анализа исходного кода</p>
        </div>
        <div class="footer-links">
          <div class="footer-links-group">
            <h4>Продукт</h4>
            <ul class="footer-links-list">
              <li><a href="../../../index.html#features" class="footer-link">Возможности</a></li>
              <li><a href="../../../index.html#integrations" class="footer-link">Интеграции</a></li>
              <li><a href="../../../index.html#faq" class="footer-link">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Документация</h4>
            <ul class="footer-links-list">
              <li><a href="../getting-started/index.html" class="footer-link">Начало работы</a></li>
              <li><a href="../guides/index.html" class="footer-link">Руководства</a></li>
              <li><a href="../api/index.html" class="footer-link">API</a></li>
              <li><a href="../enterprise/index.html" class="footer-link">Enterprise</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Ресурсы</h4>
            <ul class="footer-links-list">
              <li><a href="../../../whitepaper.html" class="footer-link">Whitepaper</a></li>
            </ul>
          </div>
          <div class="footer-links-group">
            <h4>Контакты</h4>
            <ul class="footer-links-list">
              <li><a href="mailto:hello@codegraph.ru" class="footer-link">hello@codegraph.ru</a></li>
              <li><a href="https://t.me/codegraph" class="footer-link" target="_blank" rel="noopener">Telegram</a></li>
              <li><a href="https://github.com/codegraph" class="footer-link" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
            <div class="footer-social">
              <a href="https://t.me/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </a>
              <a href="https://github.com/codegraph" class="footer-social-link" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 CodeGraph. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <script src="../../../js/main.js"></script>
</body>
</html>
